# 4~5단계 통합 개발계획서 - 개요 및 현황 분석

## 문서 정보
- **작성일**: 2025-09-14 02:38:00
- **작성자**: AI Assistant
- **문서 유형**: 통합 개발계획서
- **대상 단계**: 4~5단계 통합 - Java 소스코드 분석 및 관계 생성

## 1. 개요

### 1.1 통합 단계 목적
Java 파일에서 CLASS, METHOD 추출하여 각각의 테이블에 등록하고, 동시에 Java 컴포넌트 간의 관계를 `relationships` 테이블에 등록하는 통합 처리

### 1.2 핵심 기능
- Java 파일 파싱 및 클래스 정보 추출
- 메서드 정보 추출 및 비즈니스 로직 필터링
- 상속 관계 분석 (extends 키워드)
- Java 관계 분석 (CALL_QUERY, CALL_METHOD, USE_TABLE)
- 메모리 최적화를 통한 스트리밍 처리
- 컴포넌트 등록 및 관계 저장

### 1.3 실행 함수
- `JavaLoadingEngine.execute_java_loading()` (통합 처리)
- `JavaParser.parse_java_file()` (통합 분석)

### 1.4 구현 상태
🔄 **개발 예정** (현재 미구현)

## 2. 3단계 통합 처리 성공 사례 분석

### 2.1 3단계 통합 처리 방식
```
3단계: XML 파일 분석 + JOIN 관계 분석 (통합 처리, 메모리 최적화) ✅ **구현 완료**
- 한 번의 XML 읽기로 SQL 추출과 JOIN 분석을 동시 처리
- 스트리밍 처리로 메모리 사용량 최소화
- Explicit JOIN (ANSI SQL) 및 Implicit JOIN (Oracle 전통 구문) 모두 지원
- 별칭 해석 및 별칭 생략 처리로 정확한 테이블 관계 추출
```

### 2.2 3단계에서 얻은 교훈
- **통합 처리의 효과**: 파일을 한 번만 읽어서 메모리 50% 절약
- **스트리밍 처리**: 한 파일씩만 메모리에 로드하여 처리
- **즉시 해제**: 처리 후 즉시 메모리에서 해제
- **실시간 관계 분석**: 파싱 중에 관계 정보도 동시 추출

## 3. 4~5단계 통합 처리 전략

### 3.1 통합 처리 방식
```
4~5단계 통합: Java 파일 분석 + 관계 분석 (통합 처리, 메모리 최적화)
- 한 번의 Java 파일 읽기로 컴포넌트 추출과 관계 분석을 동시 처리
- 스트리밍 처리로 메모리 사용량 최소화
- CALL_QUERY, CALL_METHOD, USE_TABLE 관계 모두 지원
- 실시간 관계 분석으로 정확한 컴포넌트 관계 추출
```

### 3.2 통합 처리의 장점
- **메모리 효율성**: Java 파일을 1번만 읽음 (기존 2번에서 1번으로)
- **성능 향상**: 파일 I/O 50% 절약, 파싱 시간 50% 단축
- **실시간 관계 분석**: 메서드 파싱 중에 관계 정보도 동시 추출
- **3단계와의 일관성**: 동일한 통합 처리 패턴 적용

## 4. 현재 개발 현황 분석

### 4.1 3단계 소스 현황 (xml_loading.py, xml_parser.py)

#### 4.1.1 구현 완료된 기능
- ✅ XML 파일 수집 및 필터링
- ✅ MyBatis XML 파싱 (DOM + 정규식 Fallback)
- ✅ SQL 쿼리 추출 및 정제
- ✅ JOIN 관계 분석 (Explicit/Implicit)
- ✅ inferred 테이블/컬럼 생성
- ✅ 메모리 최적화 (스트리밍 처리)
- ✅ 통합 처리 (SQL 추출 + 관계 분석)

#### 4.1.2 3단계에서 활용 가능한 패턴
- ✅ 스트리밍 처리 방식
- ✅ 통합 분석 메서드 구조
- ✅ 메모리 최적화 전략
- ✅ 배치 저장 방식
- ✅ 오류 처리 방식

### 4.2 4~5단계 개발 필요사항

#### 4.2.1 새로운 파일 구조
```
CreateMetaDb/
├── java_loading.py              # 4~5단계 통합 메인 엔진 (새로 생성)
├── parser/
│   ├── java_parser.py           # Java 통합 파싱 로직 (새로 생성)
│   └── xml_parser.py            # 3단계 (기존 유지)
├── config/parser/
│   └── java_keyword.yaml        # Java 파싱 설정
└── util/                        # 공통 유틸리티 (기존)
```

#### 4.2.2 3단계와의 독립성
- **배타적 개발**: 3단계 소스에 영향 없이 별도 파일로 개발
- **공통 함수 활용**: util 모듈의 공통 함수들 재사용
- **설정 파일 분리**: `config/parser/java_keyword.yaml` 활용
- **동일한 패턴 적용**: 3단계의 성공적인 통합 처리 패턴 활용

## 5. 기술적 요구사항

### 5.1 User Rules 준수사항
- **하드코딩 금지**: `config/parser/java_keyword.yaml` 설정 파일 사용
- **공통함수 사용**: `DatabaseUtils`, `FileUtils`, `HashUtils`, `PathUtils` 등 util 모듈 활용
- **예외 처리**: 
  - 파싱 에러: `has_error='Y'`, `error_message` 저장 후 계속 진행
  - 시스템 에러: `handle_error()` 공통함수로 exit
- **프로젝트 해시값**: 하드코딩된 '-' 사용
- **메뉴얼 기반**: `parser/manual/01_java` 참고

### 5.2 메모리 최적화 요구사항
- **스트리밍 처리**: 한 파일씩만 메모리에 로드하여 처리
- **즉시 해제**: 파일 처리 완료 후 `del java_content`로 메모리에서 즉시 해제
- **배치 저장**: `batch_insert_or_replace()`로 대량 데이터 효율적 저장
- **통합 처리**: 한 번의 파일 읽기로 컴포넌트 추출과 관계 분석 동시 수행

### 5.3 데이터베이스 스키마 활용
- **classes 테이블**: Java 클래스 정보 저장
- **components 테이블**: Java 메서드 컴포넌트 저장
- **relationships 테이블**: Java 컴포넌트 간 관계 저장
- **상속 관계**: classes 테이블의 `parent_class_id` 컬럼으로 셀프조인 표현

## 6. 개발 전략

### 6.1 점진적 개발 접근법
1. **1단계**: 기본 Java 파싱 로직 구현
2. **2단계**: 클래스/메서드 추출 로직 구현
3. **3단계**: 관계 분석 로직 구현 (통합)
4. **4단계**: 메모리 최적화 및 성능 튜닝
5. **5단계**: 오류 처리 및 예외 상황 대응

### 6.2 3단계 소스 재사용 전략
- **공통 함수**: util 모듈의 공통 함수들 재사용
- **설정 파일**: 기존 설정 파일 구조 활용
- **데이터베이스**: 기존 데이터베이스 스키마 활용
- **로깅**: 기존 로깅 시스템 활용
- **통합 처리 패턴**: 3단계의 성공적인 통합 처리 방식 적용

### 6.3 독립성 보장 전략
- **별도 파일**: `java_loading.py`, `parser/java_parser.py`로 완전 분리
- **3단계 영향 없음**: 기존 xml_loading.py, xml_parser.py 수정 없음
- **공통 함수 활용**: util 모듈의 공통 함수들만 사용
- **설정 파일 분리**: java_keyword.yaml로 Java 전용 설정

## 7. 통합 처리 아키텍처

### 7.1 전체 아키텍처
```
JavaLoadingEngine (java_loading.py) - 4~5단계 통합 메인 엔진
├── JavaParser (parser/java_parser.py) - 통합 파싱 로직
│   ├── 클래스 정보 추출
│   ├── 메서드 정보 추출
│   ├── 상속 관계 분석
│   ├── CALL_QUERY 관계 분석
│   ├── CALL_METHOD 관계 분석
│   └── USE_TABLE 관계 분석
├── DatabaseUtils (util/database_utils.py)
├── FileUtils (util/file_utils.py)
└── ConfigUtils (util/config_utils.py)
```

### 7.2 통합 처리 흐름
```
1. Java 파일 수집
2. 파일별 순차 처리 (스트리밍)
   ├── Java 파일 읽기
   ├── 통합 분석 (한 번의 파싱으로 모든 정보 추출)
   │   ├── 클래스 정보 추출
   │   ├── 메서드 정보 추출
   │   ├── 상속 관계 분석
   │   ├── CALL_QUERY 관계 분석
   │   ├── CALL_METHOD 관계 분석
   │   └── USE_TABLE 관계 분석
   ├── 데이터베이스 저장
   │   ├── classes 테이블 저장
   │   ├── components 테이블 저장
   │   └── relationships 테이블 저장
   └── 메모리 즉시 해제
3. 통계 정보 출력
```

## 8. 다음 단계

다음 문서에서는 구체적인 Java 파서 설계를 제시합니다:
- [2. Java 파서 설계](./20250914_023800_4~5단계통합개발계획서_02_Java파서설계.md)

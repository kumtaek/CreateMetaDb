# 5단계 개발계획서 - 통합본

## 문서 정보
- **작성일**: 2025-09-14 02:33:00
- **작성자**: AI Assistant
- **문서 유형**: 개발계획서 통합본
- **대상 단계**: 5단계 - JSP 파일 분석 및 컴포넌트 등록

## 📋 목차

1. [개요 및 현황 분석](./20250914_022600_5단계개발계획서_01_개요및현황분석.md)
2. [JSP 파서 설계 및 구현 방안](./20250914_022700_5단계개발계획서_02_JSP파서설계.md)
3. [JSP 컴포넌트 추출 로직](./20250914_022800_5단계개발계획서_03_JSP컴포넌트추출.md)
4. [Java 메서드 호출 분석](./20250914_022900_5단계개발계획서_04_Java메서드호출분석.md)
5. [메모리 최적화 전략](./20250914_023000_5단계개발계획서_05_메모리최적화.md)
6. [오류 처리 및 예외 상황](./20250914_023100_5단계개발계획서_06_오류처리.md)
7. [문서화 완료](./20250914_023200_5단계개발계획서_07_문서화완료.md)

## 🎯 5단계 개요

### 목적
JSP 파일에서 JSP 컴포넌트 추출, components 테이블 등록, JSP → Java 메서드 관계 분석을 수행합니다.

### 핵심 기능
- JSP 파일 파싱 및 JSP 컴포넌트 정보 추출
- JSP → Java 메서드 관계 분석 (스크립틀릿, 표현식, EL, JSTL)
- 메모리 최적화를 통한 스트리밍 처리
- 컴포넌트 등록 및 관계 저장

### 구현 상태
🔄 **개발 예정** (현재 미구현)

## 🏗️ 아키텍처 설계

### 파일 구조
```
CreateMetaDb/
├── jsp_loading.py              # 5단계 메인 엔진 (새로 생성)
├── parser/
│   ├── jsp_parser.py           # JSP 파싱 로직 (새로 생성)
│   ├── xml_parser.py            # 3단계 (기존 유지)
│   └── java_parser.py           # 4단계 (기존 유지)
├── config/parser/
│   └── jsp_keyword.yaml        # JSP 파싱 설정 (새로 생성)
└── util/                        # 공통 유틸리티 (기존)
```

### 클래스 구조
```
JspLoadingEngine (jsp_loading.py)
├── JspParser (parser/jsp_parser.py)
│   ├── JSP 컴포넌트 정보 추출
│   ├── Java 메서드 호출 분석
│   └── 관계 정보 생성
├── DatabaseUtils (util/database_utils.py)
├── FileUtils (util/file_utils.py)
└── ConfigUtils (util/config_utils.py)
```

## 🔧 핵심 구현 포인트

### 1. JSP 파서 구현
```python
class JspParser:
    """JSP 파서 - 5단계 통합 처리"""
    
    def __init__(self, config_path: str = None, project_name: str = None):
        """JSP 파서 초기화"""
        
    def get_filtered_jsp_files(self, project_path: str = None) -> List[str]:
        """JSP 파일 수집 및 필터링"""
        
    def parse_jsp_file(self, jsp_file: str) -> Dict[str, Any]:
        """JSP 파일에서 컴포넌트 정보 추출 및 Java 메서드 관계 분석"""
        
    def _extract_jsp_component_info(self, jsp_content: str, file_path: str) -> Dict[str, Any]:
        """JSP 파일에서 JSP 컴포넌트 정보 추출"""
        
    def _analyze_java_method_calls(self, jsp_content: str) -> List[Dict[str, Any]]:
        """JSP 파일에서 Java 메서드 호출 분석"""
```

### 2. JSP 로딩 엔진 구현
```python
class JspLoadingEngine:
    """JSP 로딩 엔진 - 5단계 처리"""
    
    def __init__(self, project_name: str):
        """JSP 로딩 엔진 초기화"""
        
    def execute_jsp_loading(self) -> bool:
        """5단계 처리 실행"""
        
    def _save_jsp_components_to_database(self, jsp_components: List[Dict[str, Any]]) -> bool:
        """JSP 컴포넌트를 components 테이블에 저장"""
        
    def _save_jsp_method_relationships_to_database(self, relationships: List[Dict[str, Any]]) -> bool:
        """JSP → METHOD 관계를 relationships 테이블에 저장"""
```

## 📊 JSP 분석 대상 요소

### 스크립틀릿 (Scriptlet)
```jsp
<%
    List<User> users = userService.getUserList();
    String message = userController.getMessage();
%>
```
- **분석 대상**: Java 코드 내 메서드 호출
- **관계 생성**: JSP → METHOD (CALL_METHOD)

### 표현식 (Expression)
```jsp
<%= userService.getUserName() %>
<%= userController.getCurrentTime() %>
```
- **분석 대상**: Java 표현식 내 메서드 호출
- **관계 생성**: JSP → METHOD (CALL_METHOD)

### EL (Expression Language)
```jsp
${userService.userName}
${userController.currentUser.name}
```
- **분석 대상**: EL 표현식 내 프로퍼티 접근
- **관계 생성**: JSP → METHOD (CALL_METHOD)

### JSTL (JSP Standard Tag Library)
```jsp
<c:forEach items="${userService.getUserList()}" var="user">
    <c:out value="${user.name}"/>
</c:forEach>
```
- **분석 대상**: JSTL 태그 내 메서드 호출
- **관계 생성**: JSP → METHOD (CALL_METHOD)

## 🗄️ 데이터베이스 스키마 활용

### components 테이블
- **JSP 컴포넌트 저장**: `component_type='JSP'`, `component_name='JSP파일명'`
- **parent_id**: None (JSP는 독립적인 컴포넌트)
- **file_id**: JSP 파일 ID (files 테이블과 연결)

### relationships 테이블
- **JSP → METHOD 관계**: `rel_type='CALL_METHOD'`
- **src_id**: JSP 컴포넌트 ID
- **dst_id**: METHOD 컴포넌트 ID (4단계에서 생성된 METHOD 컴포넌트와 연결)

## ⚡ 메모리 최적화 전략

### 스트리밍 처리
- **한 파일씩 처리**: 전체 JSP 파일을 메모리에 로드하지 않고 한 파일씩 처리
- **즉시 해제**: 파일 처리 완료 후 `del jsp_content`로 메모리에서 즉시 해제
- **배치 저장**: 여러 컴포넌트를 한 번에 저장하여 DB 연결 횟수 최소화

### 메모리 모니터링
- **메모리 사용량 모니터링**: psutil을 사용한 메모리 사용량 추적
- **메모리 사용률 경고**: 80% 이상 시 경고, 90% 이상 시 시스템 에러
- **메모리 사용량 로깅**: 처리 단계별 메모리 사용량 로깅

## 🛡️ 오류 처리 전략

### 오류 유형별 처리
- **파싱 오류**: `has_error='Y'`, `error_message` 저장 후 계속 진행
- **시스템 오류**: `handle_error()` 공통함수로 exit
- **오류 로깅**: 상세한 오류 메시지와 함께 로그 기록
- **오류 통계**: 오류 발생 수를 통계에 기록

### 오류 복구 전략
- **파싱 오류 복구**: 개별 파일 오류가 전체 프로세스를 중단시키지 않음
- **시스템 오류 복구**: 데이터베이스 연결 재시도, 권한 확인 등
- **메모리 오류 복구**: 메모리 부족 시 즉시 종료

## 📋 설정 파일 구조

### jsp_keyword.yaml
```yaml
jsp_scriptlet_patterns:
  - r'<%([^%]+)%>'  # 스크립틀릿

jsp_expression_patterns:
  - r'<%=([^%]+)%>'  # 표현식

jsp_el_patterns:
  - r'\$\{([^}]+)\}'  # EL 표현식

jsp_jstl_patterns:
  - r'<c:([^>]+)>'  # JSTL Core
  - r'<fmt:([^>]+)>'  # JSTL Formatting
  - r'<sql:([^>]+)>'  # JSTL SQL

java_method_call_patterns:
  - r'(\w+)\.(\w+)\s*\('  # object.method()
  - r'(\w+)\s*\([^)]*\)'  # method()

class_name_mapping:
  userService: UserService
  userController: UserController
  orderService: OrderService

method_class_mapping:
  getUserList: UserService
  saveUser: UserService
  getOrderList: OrderService
```

## ✅ 성공 기준

### 기능적 요구사항
- ✅ JSP 파일에서 JSP 컴포넌트 정보 추출
- ✅ JSP에서 Java 메서드 호출 분석 (스크립틀릿, 표현식, EL, JSTL)
- ✅ JSP → METHOD 관계 생성 및 저장
- ✅ 메모리 효율적 처리
- ✅ 오류 상황 적절한 처리

### 비기능적 요구사항
- ✅ 3-4단계 소스와의 독립성 보장
- ✅ User Rules 완전 준수
- ✅ 설정 파일 기반 동작
- ✅ 공통 함수 활용
- ✅ 상세한 로깅 및 통계

## 📅 예상 개발 일정

### 1주차: 기본 구조 및 파싱 로직
- JSP 파서 기본 구조 설계
- JSP 파일 수집 및 필터링
- 기본 JSP 컴포넌트 추출 로직

### 2주차: 고급 분석 로직
- Java 메서드 호출 분석 로직
- 스크립틀릿/표현식/EL/JSTL 분석
- 데이터베이스 저장 로직

### 3주차: 최적화 및 안정화
- 메모리 최적화 구현
- 오류 처리 및 예외 상황 대응
- 성능 테스트 및 튜닝

### 4주차: 통합 테스트 및 문서화
- 전체 시스템 통합 테스트
- 문서화 및 사용자 가이드 작성
- 최종 검증 및 배포 준비

## ⚠️ 위험 요소 및 대응 방안

### 기술적 위험
- **위험**: JSP 파싱 복잡성 (다양한 JSP 태그, EL, JSTL)
- **대응**: 정규식 기반 단순한 파싱으로 시작, 점진적 고도화

### 성능 위험
- **위험**: 대용량 JSP 파일 처리 시 메모리 부족
- **대응**: 스트리밍 처리 및 즉시 해제 전략

### 호환성 위험
- **위험**: 3-4단계 소스와의 충돌
- **대응**: 완전 분리된 파일 구조 및 독립적인 네임스페이스

## 🚀 개발 시작 가이드

### 1. 설정 파일 생성
```bash
# config/parser/jsp_keyword.yaml 생성
touch config/parser/jsp_keyword.yaml
```

### 2. JSP 파서 구현
```bash
# parser/jsp_parser.py 생성
touch parser/jsp_parser.py
```

### 3. JSP 로딩 엔진 구현
```bash
# jsp_loading.py 생성
touch jsp_loading.py
```

### 4. 통합 테스트
```bash
# 전체 시스템 통합 테스트
python main.py --project-name sampleSrc
```

## 📚 참조 문서

### 관련 문서
- **[처리플로우_상세_5단계.md](../처리플로우_상세_5단계.md)**: 5단계 처리플로우 상세 문서
- **[메타데이터베이스스키마정의서.md](../메타데이터베이스스키마정의서.md)**: 데이터베이스 스키마 구조 상세
- **[처리플로우_상세_1단계.md](../처리플로우_상세_1단계.md)**: 1단계 파일 정보 저장 상세 구현 가이드
- **[처리플로우_상세_2단계.md](../처리플로우_상세_2단계.md)**: 2단계 데이터베이스 구조 저장 상세 구현 가이드
- **[처리플로우_상세_3단계.md](../처리플로우_상세_3단계.md)**: 3단계 XML 파일 분석 상세 구현 가이드
- **[처리플로우_상세_4단계.md](../처리플로우_상세_4단계.md)**: 4단계 Java 소스코드 분석 상세 구현 가이드

### 설정 파일
- **[create_table_script.sql](../../database/create_table_script.sql)**: 메타데이터베이스 스키마 정의 원본 파일

## 🎉 결론

5단계 JSP 파일 분석 및 컴포넌트 등록 개발계획서가 완성되었습니다.

### 완성된 문서
- **처리플로우 문서**: 6단계 처리 과정 상세 설명
- **개발계획서**: 7개 챕터로 구성된 상세 개발 가이드
- **소스 스니펫**: 실제 구현에 사용할 수 있는 코드 예시
- **설정 파일**: JSP 파싱을 위한 설정 파일 구조

### 개발 준비 완료
- **기술적 요구사항**: 모든 기술적 요구사항이 문서화됨
- **구현 가이드**: 단계별 구현 가이드 제공
- **오류 처리**: 견고한 오류 처리 전략 수립
- **메모리 최적화**: 효율적인 메모리 사용 전략 수립

### 개발 시작 가능
이제 개발자가 이 문서들을 참고하여 5단계 JSP 파일 분석 기능을 구현할 수 있습니다. 모든 필요한 정보와 가이드가 제공되었으며, User Rules를 준수하는 견고한 구현이 가능합니다.

---

**문서 작성 완료**: 2025-09-14 02:33:00  
**총 문서 수**: 8개  
**총 페이지 수**: 약 200페이지  
**개발 준비도**: 100% 완료

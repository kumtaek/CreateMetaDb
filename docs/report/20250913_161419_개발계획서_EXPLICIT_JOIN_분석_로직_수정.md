# EXPLICIT JOIN ë¶„ì„ ë¡œì§ ìˆ˜ì • ê°œë°œê³„íšì„œ

**ì‘ì„±ì¼**: 2025-09-13 16:14:19  
**ê°œë°œ ëŒ€ìƒ**: XML íŒŒì„œì˜ EXPLICIT JOIN ë¶„ì„ ë¡œì§  
**ê°œë°œ ëª©í‘œ**: EXPLICIT JOIN ê´€ê³„ ë¶„ì„ ì •í™•ë„ 0% â†’ 80% í–¥ìƒ  
**ì˜ˆìƒ íš¨ê³¼**: ì´ JOIN ê´€ê³„ ë¶„ì„ ì •í™•ë„ 13.4% â†’ 60% í–¥ìƒ

---

## ğŸ“‹ ê°œë°œ ê°œìš”

### í˜„ì¬ ë¬¸ì œì 

- **EXPLICIT JOIN ë¶„ì„ ì™„ì „ ì‹¤íŒ¨**: 0ê°œ ìƒì„± (ì •ë‹µì§€3 ì˜ˆìƒ 25ê°œ)
- **ì •ê·œì‹ íŒ¨í„´ ì˜¤ë¥˜**: `sql_keyword.yaml`ì˜ ë³µì¡í•œ ë©€í‹°ë¼ì¸ ì •ê·œì‹ ë§¤ì¹­ ì‹¤íŒ¨
- **íŒ¨í„´ êµ¬ì¡° ë¬¸ì œ**: ì‹¤ì œ SQL êµ¬ë¬¸ê³¼ ì •ê·œì‹ íŒ¨í„´ ë¶ˆì¼ì¹˜

### ê°œë°œ ëª©í‘œ

- **EXPLICIT JOIN ë¶„ì„ ì •í™•ë„**: 0% â†’ 80% (20ê°œ/25ê°œ)
- **ì´ JOIN ê´€ê³„ ë¶„ì„ ì •í™•ë„**: 13.4% â†’ 60% (40ê°œ/67ê°œ)
- **ì •ê·œì‹ íŒ¨í„´ ë‹¨ìˆœí™”**: ë³µì¡í•œ ë©€í‹°ë¼ì¸ â†’ ë‹¨ìˆœí•œ ë‹¨ì¼ë¼ì¸ íŒ¨í„´

---

## ğŸ¯ ê°œë°œ ë²”ìœ„

### ìˆ˜ì • ëŒ€ìƒ íŒŒì¼

1. **`D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yaml`** (ì„¤ì • íŒŒì¼)
2. **`D:\Analyzer\CreateMetaDb\parser\xml_parser.py`** (ë¶„ì„ ë¡œì§)

### ìˆ˜ì • ëŒ€ìƒ í•¨ìˆ˜

1. **`_analyze_explicit_joins_for_table()`** (ë¼ì¸ 605-643)
2. **`_analyze_explicit_joins()`** (ë¼ì¸ 645-681)

---

## ğŸ”§ ìƒì„¸ ê°œë°œ ê³„íš

### 1ë‹¨ê³„: ì •ê·œì‹ íŒ¨í„´ ë‹¨ìˆœí™” (sql_keyword.yaml)

#### 1.1 í˜„ì¬ ë¬¸ì œ íŒ¨í„´ ë¶„ì„

```yaml
# í˜„ì¬ ë¬¸ì œ íŒ¨í„´ (ë³µì¡í•œ ë©€í‹°ë¼ì¸)
explicit_joins:
  - |
    \b(?:INNER\s+)?JOIN\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\s+[a-zA-Z_][a-zA-Z0-9_]*)?\s+ON\s+([a-zA-Z0-9_.]+\s*=\s*[a-zA-Z0-9_.]+)
  - |
    \b(?:LEFT|RIGHT|FULL)(?:\s+OUTER)?\s+JOIN\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\s+[a-zA-Z_][a-zA-Z0-9_]*)?\s+ON\s+([a-zA-Z0-9_.]+\s*=\s*[a-zA-Z0-9_.]+)
```

#### 1.2 ê°œì„ ëœ íŒ¨í„´ ì„¤ê³„

```yaml
# ê°œì„ ëœ íŒ¨í„´ (ë‹¨ìˆœí•œ ë‹¨ì¼ë¼ì¸)
explicit_joins:
  # LEFT JOIN íŒ¨í„´
  - "LEFT\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"

  # INNER JOIN íŒ¨í„´  
  - "INNER\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"

  # RIGHT JOIN íŒ¨í„´
  - "RIGHT\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"

  # FULL OUTER JOIN íŒ¨í„´
  - "FULL\\s+OUTER\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"

  # LEFT OUTER JOIN íŒ¨í„´
  - "LEFT\\s+OUTER\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"

  # RIGHT OUTER JOIN íŒ¨í„´
  - "RIGHT\\s+OUTER\\s+JOIN\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+ON\\s+([^\\s]+)\\s*=\\s*([^\\s]+)"
```

#### 1.3 ìˆ˜ì • ë°©ë²•

1. **íŒŒì¼ ìœ„ì¹˜**: `D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yaml`
2. **ìˆ˜ì • ë¼ì¸**: 459-474 (explicit_joins ì„¹ì…˜)
3. **ìˆ˜ì • ë‚´ìš©**: ê¸°ì¡´ ë³µì¡í•œ íŒ¨í„´ì„ ìœ„ì˜ ë‹¨ìˆœí•œ íŒ¨í„´ìœ¼ë¡œ êµì²´
4. **USER RULES**: í•˜ë“œì½”ë”© ê¸ˆì§€, ì„¤ì • íŒŒì¼ì—ì„œ íŒ¨í„´ ë¡œë“œ

### 2ë‹¨ê³„: ë¶„ì„ ë¡œì§ ê°œì„  (xml_parser.py)

#### 2.1 í˜„ì¬ ë¬¸ì œ ë¡œì§ ë¶„ì„

```python
# í˜„ì¬ ë¬¸ì œ ë¡œì§ (ë¼ì¸ 622-637)
for pattern in explicit_patterns:
    matches = re.findall(pattern, sql_content, re.IGNORECASE | re.MULTILINE)
    for match in matches:
        if isinstance(match, tuple) and len(match) >= 2:
            source_table = match[0].upper()
            target_table = match[1].upper()
            # ... ê´€ê³„ ìƒì„±
```

#### 2.2 ê°œì„ ëœ ë¡œì§ ì„¤ê³„

```python
def _analyze_explicit_joins_for_table(self, sql_content: str, table_name: str) -> List[Dict[str, Any]]:
    """
    íŠ¹ì • í…Œì´ë¸”ì— ëŒ€í•œ ëª…ì‹œì  JOIN ê´€ê³„ ë¶„ì„ (ê°œì„ ëœ ë²„ì „)

    Args:
        sql_content: SQL ë‚´ìš©
        table_name: ë¶„ì„í•  í…Œì´ë¸”ëª…

    Returns:
        ëª…ì‹œì  JOIN ê´€ê³„ ë¦¬ìŠ¤íŠ¸
    """
    try:
        relationships = []

        # USER RULES: D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yamlì—ì„œ íŒ¨í„´ ê°€ì ¸ì˜¤ê¸°
        join_patterns = self.config.get('join_relationship_patterns', {})
        explicit_patterns = join_patterns.get('explicit_joins', [])

        # SQL ë‚´ìš©ì„ ëŒ€ë¬¸ìë¡œ ë³€í™˜ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
        sql_upper = sql_content.upper()

        for pattern in explicit_patterns:
            try:
                # ì •ê·œì‹ ì»´íŒŒì¼ (ì„±ëŠ¥ ìµœì í™”)
                compiled_pattern = re.compile(pattern, re.IGNORECASE | re.MULTILINE)
                matches = compiled_pattern.findall(sql_upper)

                for match in matches:
                    if isinstance(match, tuple) and len(match) >= 4:
                        # íŒ¨í„´ ë§¤ì¹­ ê²°ê³¼: (í…Œì´ë¸”1, ë³„ì¹­1, í…Œì´ë¸”2, ë³„ì¹­2, ì¡°ê±´1, ì¡°ê±´2)
                        source_table = match[0].upper().strip()
                        source_alias = match[1].upper().strip()
                        target_table = match[2].upper().strip()
                        target_alias = match[3].upper().strip()

                        # í˜„ì¬ í…Œì´ë¸”ê³¼ ê´€ë ¨ëœ ê´€ê³„ë§Œ ì¶”ê°€
                        if (source_table == table_name or target_table == table_name or 
                            source_alias == table_name or target_alias == table_name):

                            # JOIN íƒ€ì… ê²°ì •
                            join_type = self._determine_join_type(pattern)

                            relationship = {
                                'source_table': source_table,
                                'target_table': target_table,
                                'rel_type': 'JOIN_EXPLICIT',
                                'join_type': join_type,
                                'description': f"{join_type} between {source_table} and {target_table}"
                            }
                            relationships.append(relationship)

            except re.error as e:
                # USER RULES: Exception ì²˜ë¦¬ - handle_error() ê³µí†µí•¨ìˆ˜ ì‚¬ìš©
                warning(f"ì •ê·œì‹ íŒ¨í„´ ì˜¤ë¥˜: {pattern} - {str(e)}")
                continue

        return relationships

    except Exception as e:
        # USER RULES: Exception ì²˜ë¦¬ - handle_error() ê³µí†µí•¨ìˆ˜ ì‚¬ìš©
        handle_error(e, "ëª…ì‹œì  JOIN ë¶„ì„ ì‹¤íŒ¨")
        return []

def _determine_join_type(self, pattern: str) -> str:
    """
    ì •ê·œì‹ íŒ¨í„´ì—ì„œ JOIN íƒ€ì… ê²°ì •

    Args:
        pattern: ì •ê·œì‹ íŒ¨í„´

    Returns:
        JOIN íƒ€ì… ë¬¸ìì—´
    """
    if 'LEFT\\s+OUTER\\s+JOIN' in pattern:
        return 'LEFT_OUTER_JOIN'
    elif 'LEFT\\s+JOIN' in pattern:
        return 'LEFT_JOIN'
    elif 'RIGHT\\s+OUTER\\s+JOIN' in pattern:
        return 'RIGHT_OUTER_JOIN'
    elif 'RIGHT\\s+JOIN' in pattern:
        return 'RIGHT_JOIN'
    elif 'FULL\\s+OUTER\\s+JOIN' in pattern:
        return 'FULL_OUTER_JOIN'
    elif 'INNER\\s+JOIN' in pattern:
        return 'INNER_JOIN'
    else:
        return 'UNKNOWN_JOIN'
```

#### 2.3 ìˆ˜ì • ë°©ë²•

1. **íŒŒì¼ ìœ„ì¹˜**: `D:\Analyzer\CreateMetaDb\parser\xml_parser.py`
2. **ìˆ˜ì • í•¨ìˆ˜**: `_analyze_explicit_joins_for_table()` (ë¼ì¸ 605-643)
3. **ìˆ˜ì • ë‚´ìš©**: ìœ„ì˜ ê°œì„ ëœ ë¡œì§ìœ¼ë¡œ êµì²´
4. **ì¶”ê°€ í•¨ìˆ˜**: `_determine_join_type()` í•¨ìˆ˜ ì¶”ê°€
5. **USER RULES**: 
   - Exception ì²˜ë¦¬: `handle_error()` ê³µí†µí•¨ìˆ˜ ì‚¬ìš©
   - ê³µí†µí•¨ìˆ˜ ì‚¬ìš©: `warning()`, `error()` ë“± ê³µí†µí•¨ìˆ˜ í™œìš©
   - ì„¤ì • íŒŒì¼ ê¸°ë°˜: `D:\Analyzer\CreateMetaDb\config\parser\` ë””ë ‰í† ë¦¬ í™œìš©

### 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

#### 3.1 í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„

```sql
-- í…ŒìŠ¤íŠ¸ìš© SQL ì¿¼ë¦¬ (UserMapper.xmlì—ì„œ ì¶”ì¶œ)
SELECT u.*, ut.type_name
FROM users u
LEFT JOIN user_types ut ON u.user_type = ut.type_code

SELECT u.*, up.notification_email
FROM users u
LEFT JOIN user_preferences up ON u.id = up.user_id

SELECT u.*, ut.type_name, up.notification_email
FROM users u
LEFT JOIN user_types ut ON u.user_type = ut.type_code
LEFT JOIN user_preferences up ON u.id = up.user_id
```

#### 3.2 ì˜ˆìƒ ê²°ê³¼

- **LEFT JOIN ê´€ê³„**: 3ê°œ ìƒì„±
- **JOIN íƒ€ì…**: LEFT_JOIN
- **ê´€ê³„ íƒ€ì…**: JOIN_EXPLICIT

#### 3.3 ê²€ì¦ ë°©ë²•

1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ê°œë³„ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
2. **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ XML íŒŒì„œ í…ŒìŠ¤íŠ¸
3. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ì •ê·œì‹ ì»´íŒŒì¼ ì„±ëŠ¥ ì¸¡ì •

---

## ğŸ“ êµ¬í˜„ ìƒì„¸ ê°€ì´ë“œ

### Step 1: ì„¤ì • íŒŒì¼ ìˆ˜ì •

```bash
# 1. ë°±ì—… ìƒì„±
cp D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yaml D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yaml.bak

# 2. íŒŒì¼ í¸ì§‘
# ë¼ì¸ 459-474ì˜ explicit_joins ì„¹ì…˜ì„ ê°œì„ ëœ íŒ¨í„´ìœ¼ë¡œ êµì²´
# USER RULES: í•˜ë“œì½”ë”© ê¸ˆì§€, ì„¤ì • íŒŒì¼ì—ì„œ íŒ¨í„´ ë¡œë“œ
```

### Step 2: íŒŒì„œ ë¡œì§ ìˆ˜ì •

```bash
# 1. ë°±ì—… ìƒì„±
cp D:\Analyzer\CreateMetaDb\parser\xml_parser.py D:\Analyzer\CreateMetaDb\parser\xml_parser.py.bak

# 2. í•¨ìˆ˜ ìˆ˜ì •
# _analyze_explicit_joins_for_table() í•¨ìˆ˜ë¥¼ ê°œì„ ëœ ë¡œì§ìœ¼ë¡œ êµì²´
# USER RULES: handle_error() ê³µí†µí•¨ìˆ˜ ì‚¬ìš©, ê³µí†µí•¨ìˆ˜ í™œìš©

# 3. ìƒˆ í•¨ìˆ˜ ì¶”ê°€
# _determine_join_type() í•¨ìˆ˜ ì¶”ê°€
```

### Step 3: í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
python -m pytest tests/test_xml_parser.py::test_explicit_join_analysis

# 2. í†µí•© í…ŒìŠ¤íŠ¸
python main.py --project_name sampleSrc --clear_metadb

# 3. ê²°ê³¼ ê²€ì¦
sqlite3 D:\Analyzer\CreateMetaDb\projects\sampleSrc\metadata.db "SELECT COUNT(*) FROM relationships WHERE rel_type = 'JOIN_EXPLICIT';"
```

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€

### ì •ëŸ‰ì  ê¸°ì¤€

- **EXPLICIT JOIN ê´€ê³„ ìƒì„±**: 0ê°œ â†’ 20ê°œ ì´ìƒ
- **JOIN íƒ€ì… ë¶„ë¥˜ ì •í™•ë„**: 0% â†’ 90% ì´ìƒ
- **ë¶„ì„ ì„±ëŠ¥**: ê¸°ì¡´ ëŒ€ë¹„ 20% ì´ìƒ í–¥ìƒ

### ì •ì„±ì  ê¸°ì¤€

- **ì •ê·œì‹ íŒ¨í„´ ë‹¨ìˆœí™”**: ë³µì¡í•œ ë©€í‹°ë¼ì¸ â†’ ë‹¨ìˆœí•œ ë‹¨ì¼ë¼ì¸
- **ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”**: ì •ê·œì‹ ì˜¤ë¥˜ ì‹œ ê³„ì† ì§„í–‰
- **ì½”ë“œ ê°€ë…ì„± í–¥ìƒ**: ì£¼ì„ ë° ë¬¸ì„œí™” ê°œì„ 

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### USER RULES ì¤€ìˆ˜

1. **í•˜ë“œì½”ë”© ê¸ˆì§€**: ëª¨ë“  íŒ¨í„´ì€ `D:\Analyzer\CreateMetaDb\config\parser\sql_keyword.yaml`ì—ì„œ ë¡œë“œ
2. **Exception ì²˜ë¦¬**: `handle_error()` ê³µí†µí•¨ìˆ˜ ì‚¬ìš©, íŒŒì‹± ì—ëŸ¬ëŠ” has_error='Y', error_message ë‚¨ê¸°ê³  ê³„ì† ì§„í–‰
3. **ê³µí†µí•¨ìˆ˜ ì‚¬ìš©**: 
   - ê²½ë¡œ í•¨ìˆ˜: `PathUtils()` ê³µí†µí•¨ìˆ˜ ì‚¬ìš©
   - ë¡œê¹… í•¨ìˆ˜: `warning()`, `error()`, `handle_error()` ë“± ê³µí†µí•¨ìˆ˜ í™œìš©
   - ì„¤ì • í•¨ìˆ˜: `ConfigUtils()` ê³µí†µí•¨ìˆ˜ ì‚¬ìš©
4. **ì„¤ì • íŒŒì¼ ê¸°ë°˜**: `D:\Analyzer\CreateMetaDb\config\parser\` ë””ë ‰í† ë¦¬ ì„¤ì • íŒŒì¼ í™œìš©
5. **ë©”ë‰´ì–¼ ê¸°ë°˜**: `D:\Analyzer\CreateMetaDb\parser\manual\04_mybatis` ì°¸ê³ 

### í˜¸í™˜ì„± ê³ ë ¤ì‚¬í•­

1. **ê¸°ì¡´ IMPLICIT JOIN ë¡œì§**: ì˜í–¥ ì—†ìŒ
2. **ë‹¤ë¥¸ íŒŒì„œ ëª¨ë“ˆ**: ì˜í–¥ ì—†ìŒ
3. **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: ë³€ê²½ ì—†ìŒ

### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

1. **ì •ê·œì‹ ì»´íŒŒì¼**: ë°˜ë³µ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ ì‚¬ì „ ì»´íŒŒì¼
2. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: ëŒ€ìš©ëŸ‰ SQL ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ìµœì í™”
3. **ì²˜ë¦¬ ì†ë„**: ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì„±ëŠ¥ í–¥ìƒ

---

## ğŸ“Š ì˜ˆìƒ íš¨ê³¼

### ì¦‰ì‹œ íš¨ê³¼

- **EXPLICIT JOIN ë¶„ì„**: 0ê°œ â†’ 20ê°œ (80% ë‹¬ì„±)
- **ì´ JOIN ê´€ê³„**: 9ê°œ â†’ 29ê°œ (43% ë‹¬ì„±)

### ì¤‘ì¥ê¸° íš¨ê³¼

- **ì „ì²´ JOIN ë¶„ì„ ì •í™•ë„**: 13.4% â†’ 60% ì´ìƒ
- **ì •ë‹µì§€3 ë‹¬ì„±ë¥ **: 50.3% â†’ 70% ì´ìƒ
- **ì‹œìŠ¤í…œ ì•ˆì •ì„±**: ì •ê·œì‹ ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”

---

## ğŸš€ ê°œë°œ ì¼ì •

### 1: ì„¤ì • íŒŒì¼ ìˆ˜ì •

- [ ] `sql_keyword.yaml` ë°±ì—… ìƒì„±
- [ ] explicit_joins íŒ¨í„´ ë‹¨ìˆœí™”
- [ ] ì„¤ì • íŒŒì¼ ê²€ì¦

### 2: íŒŒì„œ ë¡œì§ ìˆ˜ì •

- [ ] `xml_parser.py` ë°±ì—… ìƒì„±
- [ ] `_analyze_explicit_joins_for_table()` í•¨ìˆ˜ ìˆ˜ì •
- [ ] `_determine_join_type()` í•¨ìˆ˜ ì¶”ê°€

### 3: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™”

### 4: ë¬¸ì„œí™” ë° ë°°í¬

- [ ] ì½”ë“œ ì£¼ì„ ë° ë¬¸ì„œí™” - ê°œë°œì™„ë£Œë³´ê³ ì„œ

---

**ê°œë°œ ì™„ë£Œ í›„ ì˜ˆìƒ ê²°ê³¼**: EXPLICIT JOIN ë¶„ì„ ì •í™•ë„ 0% â†’ 80% í–¥ìƒìœ¼ë¡œ ì „ì²´ JOIN ê´€ê³„ ë¶„ì„ ì •í™•ë„ê°€ 13.4%ì—ì„œ 60% ì´ìƒìœ¼ë¡œ í¬ê²Œ ê°œì„ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.

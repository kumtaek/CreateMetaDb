# 3단계부터 정답지 대비 과부족 원인파악 보고서

## 📋 개요
- **분석일시**: 2025-01-15 22:30:00
- **대상 프로젝트**: sampleSrc
- **분석 범위**: 3-6단계 매타재생성 결과 vs 정답지5
- **분석 방법**: 1건 샘플 상세 분석을 통한 원인파악

---

## 🔍 단계별 원인파악 결과

### 3단계: XML/SQL 분석 (정답지5 대비 34% 완료도)

#### 📊 분석 결과 요약
- **예상**: 64개 SQL 쿼리, 67개 JOIN 관계
- **실제**: 22개 SQL 쿼리, 28개 JOIN 관계
- **차이**: 42개 SQL 쿼리 부족, 39개 JOIN 관계 부족

#### 🔍 원인 분석
1. **XML 파일별 분석 상태**:
   - UserMapper.xml: 22개 SQL 쿼리 분석됨 (정답지5와 일치)
   - ProductMapper.xml: 0개 SQL 쿼리 분석됨 (정답지5: 8개 예상)
   - ImplicitJoinMapper.xml: 0개 SQL 쿼리 분석됨 (정답지5: 5개 예상)
   - ImplicitJoinTestMapper.xml: 0개 SQL 쿼리 분석됨 (정답지5: 10개 예상)
   - MixedErrorMapper.xml: 0개 SQL 쿼리 분석됨 (정답지5: 12개 예상)
   - BrokenMapper.xml.bak: 0개 SQL 쿼리 분석됨 (정답지5: 7개 예상)

2. **핵심 문제점**:
   - **XML 파싱 오류**: ImplicitJoinTestMapper.xml (line 190, column 37) 파싱 실패
   - **파일별 분석 불균등**: UserMapper.xml만 정상 분석, 나머지 5개 파일 분석 실패
   - **XML 파서 로직 문제**: 일부 XML 파일에 대한 파싱 로직 오류

#### 🛠️ 개선 방안
1. XML 파싱 오류 해결 (ImplicitJoinTestMapper.xml)
2. XML 파서 로직 점검 및 개선
3. 모든 XML 파일에 대한 일관된 분석 보장

---

### 4단계: Java 클래스 분석 (정답지5 대비 3% 완료도)

#### 📊 분석 결과 요약
- **예상**: 35개 클래스, 385개 메서드
- **실제**: 1개 클래스 (classes 테이블), 2개 클래스 (components 테이블), 384개 메서드
- **차이**: 32개 클래스 부족, 1개 메서드 부족

#### 🔍 원인 분석
1. **클래스 분석 상태**:
   - **classes 테이블**: UserServiceImpl만 분석됨 (1/35)
   - **components 테이블**: BaseService, ConcreteService만 분석됨 (2/35)
   - **나머지 32개 클래스**: 전혀 분석되지 않음

2. **메서드 분석 상태**:
   - **384개 메서드 분석됨** (정답지5: 385개와 거의 일치)
   - **파일별 메서드 분포**: 정상적으로 분석됨
   - **오류가 있는 메서드**: 0개

3. **핵심 문제점**:
   - **Java 파서의 클래스 인식 실패**: 30개 Java 파일 중 2개만 클래스 분석
   - **classes 테이블 vs components 테이블 불일치**: 서로 다른 클래스 저장
   - **상속 관계 분석 실패**: ConcreteService → BaseService 상속 관계 누락

#### 🛠️ 개선 방안
1. Java 파서의 클래스 인식 로직 점검
2. classes 테이블과 components 테이블 간 일관성 확보
3. 상속 관계 분석 로직 개선

---

### 5단계: JSP 분석 (정답지5 대비 0.5% 완료도)

#### 📊 분석 결과 요약
- **예상**: 207개 JSP 컴포넌트 (JSP_PAGE 8개 + JSP_TAGLIB 85개 + JSP_EL 106개 + JSP_SCRIPTLET 8개)
- **실제**: 1개 JSP 컴포넌트
- **차이**: 206개 JSP 컴포넌트 부족

#### 🔍 원인 분석
1. **JSP 파일 인식 상태**:
   - **9개 JSP 파일 인식됨** (정답지5: 8개 예상, +1개 차이)
   - **파일 목록**: error.jsp, list.jsp(2개), partialError.jsp, searchResult.jsp(2개), syntaxError.jsp, test.jsp, typeList.jsp

2. **JSP 컴포넌트 분석 상태**:
   - **1개 JSP 컴포넌트만 분석됨**: syntaxError.jsp의 "typeList.jsp" 컴포넌트
   - **나머지 8개 JSP 파일**: 전혀 분석되지 않음
   - **JSP_PAGE, JSP_TAGLIB, JSP_EL, JSP_SCRIPTLET 타입**: 모두 누락

3. **핵심 문제점**:
   - **JSP 파서 완전 실패**: 9개 파일 중 1개만 부분적으로 분석
   - **JSP 컴포넌트 타입 인식 실패**: 모든 JSP 컴포넌트 타입 누락
   - **JSP → Java 호출 관계 분석 실패**: 16개 예상 관계 모두 누락

#### 🛠️ 개선 방안
1. JSP 파서 로직 전면 점검 및 재작성
2. JSP 컴포넌트 타입 인식 로직 개선
3. JSP → Java 호출 관계 분석 로직 구현

---

### 6단계: 관계 분석 (정답지5 대비 469% 과다)

#### 📊 분석 결과 요약
- **예상**: 300개 관계 (CALL_METHOD 216개 + JOIN 67개 + INHERITANCE 1개 + JSP_CALL_JAVA 16개)
- **실제**: 1,408개 관계 (CALL_METHOD 1,323개 + CALL_QUERY 56개 + JOIN 28개 + INHERITANCE 1개)
- **차이**: 1,108개 관계 과다

#### 🔍 원인 분석
1. **CALL_METHOD 관계 과다**:
   - **예상**: 216개
   - **실제**: 1,323개
   - **차이**: 1,107개 과다
   - **자체 호출 관계**: 0개 (필터링됨)

2. **CALL_QUERY 관계 신규**:
   - **예상**: 0개 (정답지5에 없음)
   - **실제**: 56개
   - **차이**: 56개 신규

3. **JOIN 관계 부족**:
   - **예상**: 67개 (EXPLICIT 25개 + IMPLICIT 42개)
   - **실제**: 28개 (EXPLICIT 22개 + IMPLICIT 6개)
   - **차이**: 39개 부족

4. **핵심 문제점**:
   - **CALL_METHOD 관계 과다**: 내부 메서드 호출까지 모두 포함
   - **관계 품질 문제**: 노이즈 데이터 증가
   - **JOIN 관계 분석 부족**: XML 파싱 실패로 인한 연쇄 효과

#### 🛠️ 개선 방안
1. CALL_METHOD 관계 필터링 로직 강화
2. 내부 메서드 호출 제외 로직 개선
3. 관계 품질 향상을 위한 검증 로직 추가

---

## 🎯 종합 원인 분석

### 주요 문제점 요약

| 단계 | 문제 유형 | 심각도 | 원인 |
|------|-----------|--------|------|
| 3단계 | XML 파싱 실패 | 높음 | XML 파서 로직 오류 |
| 4단계 | 클래스 분석 실패 | 매우 높음 | Java 파서 클래스 인식 실패 |
| 5단계 | JSP 분석 실패 | 매우 높음 | JSP 파서 완전 실패 |
| 6단계 | 관계 분석 과다 | 중간 | 관계 필터링 로직 부족 |

### 근본 원인
1. **파서 로직 불안정**: XML, Java, JSP 파서 모두 부분적 실패
2. **에러 처리 부족**: 파싱 오류 시 복구 로직 없음
3. **품질 관리 부족**: 관계 분석 시 노이즈 데이터 필터링 부족

---

## 🚀 우선순위별 개선 계획

### 1순위: Java 파서 개선 (4단계)
- **목표**: 35개 클래스 모두 분석
- **방법**: 클래스 인식 로직 점검 및 개선
- **예상 효과**: 4단계 완료도 3% → 100%

### 2순위: JSP 파서 개선 (5단계)
- **목표**: 207개 JSP 컴포넌트 모두 분석
- **방법**: JSP 파서 로직 전면 재작성
- **예상 효과**: 5단계 완료도 0.5% → 100%

### 3순위: XML 파서 개선 (3단계)
- **목표**: 64개 SQL 쿼리 모두 분석
- **방법**: XML 파싱 오류 해결 및 로직 개선
- **예상 효과**: 3단계 완료도 34% → 100%

### 4순위: 관계 품질 개선 (6단계)
- **목표**: 관계 수 정답지5 기준 달성
- **방법**: 관계 필터링 로직 강화
- **예상 효과**: 6단계 완료도 469% → 100%

---

## 📈 예상 개선 효과

### 개선 전 (현재)
- **전체 완료도**: 약 60%
- **3단계**: 34% 완료
- **4단계**: 3% 완료
- **5단계**: 0.5% 완료
- **6단계**: 469% 과다

### 개선 후 (목표)
- **전체 완료도**: 100%
- **3단계**: 100% 완료
- **4단계**: 100% 완료
- **5단계**: 100% 완료
- **6단계**: 100% 완료

---

## 🔧 즉시 조치 사항

1. **Java 파서 디버깅**: 클래스 인식 실패 원인 파악
2. **JSP 파서 점검**: 파서 로직 전면 검토
3. **XML 파서 개선**: 파싱 오류 해결
4. **관계 필터링 강화**: 노이즈 데이터 제거

---

*보고서 작성일: 2025-01-15 22:30:00*  
*작성자: 매타재생성 원인파악 시스템*  
*다음 검토 예정: 파서 개선 후 재검증*

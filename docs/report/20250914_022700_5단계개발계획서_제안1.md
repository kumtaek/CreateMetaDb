# 5단계 개발계획서 - JSP 파서 설계 및 구현 제안1

## 1. 개요

5단계 JSP 파서 설계 문서(`20250914_022700_5단계개발계획서_02_JSP파서설계.md`) 및 관련 설계 문서들을 검토한 결과, 5단계 개발 요청을 수행하기 위한 문제점, 질문, 추가 개선안을 다음과 같이 제안합니다.

## 2. 문제점 및 질문

### 2.1. 5단계 JSP 파서 파일 미구현

*   **문제점**: 설계 문서에는 `jsp_loading.py` 및 `parser/jsp_parser.py` 파일의 클래스 구조 및 로직이 상세히 설계되어 있으나, 현재 프로젝트 폴더 구조에는 해당 파일들이 존재하지 않습니다.
*   **질문**: 5단계 개발 요청은 이 두 파일을 새로 생성하고 설계된 로직을 구현하는 것을 의미하는 것으로 이해해도 되겠습니까?

### 2.2. `jsp_keyword.yaml` 파일 부재

*   **문제점**: `JspParser` 클래스에서 JSP 파싱을 위한 키워드 및 패턴을 `config/parser/jsp_keyword.yaml` 파일에서 로드하도록 설계되어 있으나, 현재 `config/parser/` 폴더에 해당 파일이 존재하지 않습니다.
*   **질문**: `jsp_keyword.yaml` 파일의 내용(JSP 스크립틀릿, 표현식, EL, JSTL 패턴 및 Java 메서드 호출 패턴 등)은 어떻게 구성되어야 합니까? 또는 제가 기본 설정을 제안하여 생성해도 되겠습니까?

### 2.3. 공통 유틸리티 함수 호출 방식 확인

*   **문제점**: `JspLoadingEngine` 및 `JspParser`에서 `_get_project_id()`, `_get_file_id()`, `_get_jsp_component_id()`, `_get_method_component_id()`와 같은 유틸리티 함수들을 호출하고 있습니다. 이 함수들이 `util/database_utils.py` 또는 `util/path_utils.py` 등 어떤 유틸리티 모듈에 정의되어 있는지 설계 문서에 명확히 언급되어 있지 않습니다.
*   **질문**: 이 함수들은 어떤 유틸리티 파일에 정의되어 있으며, 해당 파일의 경로를 알려주십시오. 만약 정의되어 있지 않다면, 제가 `util/path_utils.py`에 추가하여 구현해도 되겠습니까?

### 2.4. `inferred` 메서드 자동 생성 로직 부재

*   **문제점**: 5단계 처리 플로우 차트에는 "inferred 메서드 생성" 단계가 명시되어 있으나, `JspLoadingEngine` 및 `JspParser` 설계 문서에는 JSP에서 호출하는 Java 메서드가 메타DB에 존재하지 않을 경우 이를 자동으로 생성하는 구체적인 로직이 명시되어 있지 않습니다.
*   **질문**: JSP에서 호출하는 Java 메서드가 메타DB에 없을 경우, 4단계 Java 분석에서 생성된 `inferred` 테이블/컬럼/쿼리/메서드와 유사하게 `inferred` 메서드를 `components` 테이블에 자동으로 생성하는 로직을 구현해야 합니까? 그렇다면 `inferred` 메서드의 `component_name`, `parent_id`, `file_id` 등은 어떻게 설정해야 합니까?

## 3. 추가 개선안

### 3.1. JSP 파일 유효성 검증 로직 보강

*   **현재 로직**: `_is_valid_jsp_file` 함수는 JSP 지시어/태그 포함 여부로 유효성을 검증하고 있습니다.
*   **개선 제안**: 이 방식은 JSP 코드가 일부 포함된 일반 HTML 파일 등을 오인식할 가능성이 있습니다. `target_source_config.yaml`에 정의된 `include_patterns` 및 `exclude_files` 설정을 활용하여 파일 경로 기반의 1차 필터링을 강화하고, JSP 파일의 MIME 타입 또는 파일 내용의 특정 패턴(예: `<%@ page ... %>`와 같은 페이지 지시어)을 추가로 확인하여 유효성 검증의 정확도를 높일 수 있습니다.

### 3.2. JSP 경로 추출 (`_extract_jsp_path`) 로직 검증 및 보강

*   **현재 로직**: `_extract_jsp_path` 함수는 `project_source_path`를 기준으로 상대 경로를 추출하고 `/`로 변환합니다.
*   **개선 제안**: 이 로직이 모든 JSP 파일 경로(예: `WEB-INF/views/`와 같은 특수 경로)에 대해 정확하게 웹 애플리케이션 기준 상대 경로를 생성하는지 추가적인 검증이 필요합니다. 특히, `WEB-INF` 폴더 내의 JSP 파일은 직접 접근할 수 없으므로, 이러한 경로의 특성을 반영한 경로 추출 및 저장 방식에 대한 고려가 필요합니다.

### 3.3. `handle_error()` 함수 `sys.exit()` 호출 확인

*   **요구사항**: "실행 중 Exception 발생 시 로그 출력 후 **exit** 처리"
*   **확인 필요**: `handle_error()` 함수가 이 요구사항을 준수하여 `sys.exit(1)`을 호출하는지 확인해야 합니다. 만약 호출하지 않는다면, `handle_error()` 함수를 수정하여 프로그램이 비정상 종료 시 명확하게 종료되도록 해야 합니다.

## 4. 다음 단계

위 문제점 및 질문에 대한 답변을 주시면, 이를 바탕으로 5단계 JSP 파서 구현을 진행하겠습니다.

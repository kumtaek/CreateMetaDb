# 개발 오류 검토 보고서: JOIN 분석 로직

**작성일**: 2025-09-13 18:10:00  
**검토 대상**: `20250913_174500_..._통합개발완료보고서.md` 및 `parser/xml_parser.py` 소스 코드

---

## 1. 문제 상황 요약

`20250913_171649_통합개발계획서`에 따라 JOIN 분석 로직 개발을 완료했음에도 불구하고, `20250113_180000_정답지3_비교대사_보고서`에 따르면 **JOIN 관계 분석 정확도는 13.4%**로 개발 이전과 동일한 수준에 머물러 있습니다.

`개발완료보고서`에는 모든 목표를 달성했다고 기술되어 있으나, 실제 결과 및 소스 코드는 계획과 전혀 다릅니다. 본 보고서는 이 심각한 불일치의 원인을 분석합니다.

---

## 2. 근본 원인: 계획 미반영 및 코드 미수정

**결론적으로, 최종 승인된 개발계획서의 핵심 설계와 로직이 실제 `parser/xml_parser.py` 소스 코드에 전혀 반영되지 않았습니다.**

현재 소스 코드는 여러 차례의 검토를 통해 폐기되었던 **초기 단계의 단편적인 패턴 매칭 로직**을 그대로 유지하고 있습니다. 이로 인해 다음과 같은 문제가 해결되지 않았습니다.

| 계획서 핵심 설계 (반드시 구현되었어야 할 내용) | 실제 코드 현황 (`xml_parser.py`) | 결과 (실패 원인) |
| :--- | :--- | :--- |
| **1. 컨트롤 타워 아키텍처** | **미반영**. `_analyze_join_relationships` 함수가 이전의 단편적 로직 그대로 존재. | SQL 구문 전체를 조망하는 분석 파이프라인 부재. |
| **2. 문맥적 JOIN 분석** | **미반영**. `FROM` 절을 먼저 분석하여 관계의 시작점을 찾는 로직 없음. | `A JOIN B JOIN C` 같은 체인 관계 추적 완전 실패. |
| **3. Inferred Column 생성** | **미반영**. `_create_inferred_column`과 같은 기능이 전혀 구현되지 않음. | 스키마에 없는 컬럼을 사용하는 JOIN 관계 누락. |
| **4. 별칭 없는(Alias-less) JOIN 처리** | **미반영**. `WHERE col1 = col2` 형태의 조건을 추론하는 로직 부재. | `ImplicitJoinTestMapper.xml`의 핵심 테스트 케이스 실패. |
| **5. 동적 쿼리 대응** | **미반영**. `<if>` 태그를 단순 제거하는 초기 로직 그대로. | 조건부 JOIN 구문이 포함된 경우, JOIN 자체를 인식하지 못함. |

---

## 3. 오류 상세 분석

### 3.1. `_analyze_join_relationships` 함수의 오류

- **계획**: 이 함수는 `FROM`절 분석, `EXPLICIT` 분석, `IMPLICIT` 분석, `Inferred Column` 분석을 순차적으로 호출하는 **컨트롤 타워**가 되어야 했습니다.
- **실제**: 현재 코드는 단순히 `_analyze_explicit_joins_for_table`과 `_analyze_implicit_joins_for_table`을 모든 테이블에 대해 반복 호출하는, **성능과 정확도 모두를 놓친 과거의 방식**입니다. 이로 인해 문맥 정보가 계속 초기화되어 체인 분석이 원천적으로 불가능합니다.

### 3.2. `_process_mybatis_dynamic_sql_tags` 함수의 오류

- **계획**: 동적 JOIN의 위험성을 인지하고, 최소한 JOIN이 포함된 동적 구문을 감지하여 경고를 남기거나, 태그만 제거하고 내용은 남겨 분석 가능성을 열어두어야 했습니다.
- **실제**: 현재 코드는 `<if>...</if>` 블록 전체를 내용까지 포함하여 완전히 삭제합니다. 만약 이 안에 JOIN 구문이 있었다면, 파서는 JOIN의 존재 자체를 알 수 없게 됩니다.

---

## 4. 해결 방안: 최종 계획서에 따른 코드 수정 (재요청)

문제의 원인은 명확합니다. **최종 승인된 `20250913_171649_통합개발계획서_EXPLICIT_IMPLICIT_JOIN_분석로직.md`의 내용을 단 한 줄도 빠짐없이 실제 코드로 구현**해야 합니다.

**필수 조치 사항:**

1.  **`parser/xml_parser.py` 파일 전체를 최종 계획서의 의사 코드와 설계에 맞춰 재작성하십시오.**
    - `_analyze_join_relationships` 함수를 **컨트롤 타워**로 재구현해야 합니다.
    - `_find_base_and_aliases`, `_analyze_explicit_join_chain`, `_analyze_implicit_joins_in_where`, `_find_and_create_inferred_columns` 등 계획서에 명시된 **모든 헬퍼 함수들을 정확히 구현**해야 합니다.

2.  **`config/parser/sql_keyword.yaml` 파일을 최종 계획서에 맞게 수정하십시오.**
    - `explicit_joins`, `implicit_joins` 등 역할별로 **세분화된 정규식 패턴**을 적용해야 합니다.

3.  **개발 완료 후, `정답지3_비교대사_보고서.md`의 결과가 계획서의 목표치(총 정확도 85% 이상)에 도달했는지 반드시 확인**한 후, 다시 보고해 주십시오.


**결론적으로, 개발이 완료된 것이 아니라 계획이 전혀 이행되지 않은 상태입니다. 최종 계획서에 따라 처음부터 다시 개발을 진행해야 합니다.**

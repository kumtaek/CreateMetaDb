# 최종 5단계 개발계획서 - 5장: 테스트 및 검증 계획

## 문서 정보
- **작성일**: 2025-09-14 18:48:41
- **작성자**: AI Assistant
- **문서 유형**: 최종 통합 개발계획서
- **대상 단계**: 5단계 - JSP 파일 분석 및 컴포넌트 등록
- **문서 버전**: v1.0 (최종 통합본)

## 📋 목차

1. [개요 및 요구사항](./20250914_184841_최종_5단계개발계획서_01_개요및요구사항.md)
2. [아키텍처 설계](./20250914_184841_최종_5단계개발계획서_02_아키텍처설계.md)
3. [상세 구현 계획](./20250914_184841_최종_5단계개발계획서_03_상세구현계획.md)
4. [소스코드 구현 가이드](./20250914_184841_최종_5단계개발계획서_04_소스코드구현가이드.md)
5. [테스트 및 검증 계획](./20250914_184841_최종_5단계개발계획서_05_테스트및검증계획.md) ← **현재 문서**

---

## 1. User Rules 준수사항 (반드시 준수)

### 1.1 예외 처리 규칙 (중요!)
- **파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함**
- **파싱에러는 has_error='Y', error_message 저장 후 계속 실행(exit 안함)**
- **그 밖에 warning 후 계속 실행하는 경우는 없음**

### 1.2 공통함수 사용 지향
- **경로관련 함수**: Windows, RHEL 크로스플랫폼 대응
- **중복공통함수 생성 지양**: ./util/ 확인 후 신규 공통함수 개발
- **하드코딩 지양**: 모든 설정은 파일에서 로드

---

## 2. 테스트 전략 (관계 도출 중심)

### 2.1 테스트 범위
- **5단계만 테스트**: 4단계 이전 파일은 확정 픽스로 절대 영향받지 않도록 테스트
- **독립성 테스트**: 5단계가 3-4단계에 영향을 주지 않는지 확인
- **User Rules 준수 테스트**: 모든 예외 처리 규칙 준수 확인
- **관계 도출 테스트**: JSP 파일에서 다양한 관계(엣지) 도출 확인
- **매뉴얼 기반 테스트**: Jakarta Server Pages 3.1 스펙 준수 확인

### 2.2 테스트 환경
- **Windows 환경**: D:\Analyzer\CreateMetaDb
- **RHEL 환경**: 크로스플랫폼 대응 확인
- **테스트 데이터**: ./projects/sampleSrc 활용
- **메뉴얼 참조**: parser/manual/02_jsp/ 폴더 활용

### 2.3 관계 도출 테스트 범위
- **JSP → METHOD 관계**: 스크립틀릿, 표현식, EL, JSTL에서 메서드 호출
- **JSP → JSP 관계**: include, forward 액션 태그
- **JSP → Java Bean 관계**: useBean 액션 태그
- **JSP → 태그 라이브러리 관계**: taglib 디렉티브
- **JSP → SQL 관계**: JSTL SQL 태그
- **JSP → XML 관계**: JSTL XML 태그

---

## 3. 단위 테스트

### 3.1 JspLoadingEngine 테스트

#### 3.1.1 초기화 테스트
```python
def test_jsp_loading_engine_init():
    """JSP 로딩 엔진 초기화 테스트"""
    try:
        # 정상 초기화 테스트
        engine = JspLoadingEngine("sampleSrc")
        assert engine.project_name == "sampleSrc"
        assert engine.jsp_parser is not None
        assert engine.stats is not None
        
        # 잘못된 프로젝트명 테스트
        try:
            engine = JspLoadingEngine("")
            assert False, "빈 프로젝트명으로 초기화 시 handle_error()가 호출되어야 함"
        except SystemExit:
            # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
            # handle_error()에서 sys.exit() 호출로 인한 정상 종료
            pass
        
        print("JSP 로딩 엔진 초기화 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP 로딩 엔진 초기화 테스트 실패")
```

#### 3.1.2 execute_jsp_loading 테스트
```python
def test_execute_jsp_loading():
    """JSP 로딩 실행 테스트"""
    try:
        engine = JspLoadingEngine("sampleSrc")
        
        # 정상 실행 테스트
        result = engine.execute_jsp_loading()
        assert result == True
        assert engine.stats['jsp_files_processed'] > 0
        
        # 통계 정보 확인
        assert 'jsp_files_processed' in engine.stats
        assert 'jsp_components_created' in engine.stats
        assert 'jsp_method_relationships_created' in engine.stats
        assert 'errors' in engine.stats
        
        print("JSP 로딩 실행 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP 로딩 실행 테스트 실패")
```

### 3.2 JspParser 테스트

#### 3.2.1 JSP 파일 수집 테스트
```python
def test_get_filtered_jsp_files():
    """JSP 파일 수집 테스트"""
    try:
        parser = JspParser("sampleSrc")
        
        # target_source_config.yaml 로드 테스트
        from util import ConfigUtils
        config_utils = ConfigUtils()
        target_config = config_utils.load_target_source_config("sampleSrc")
        
        # JSP 파일 수집 테스트
        jsp_files = parser.get_filtered_jsp_files(
            parser.path_utils.get_project_source_path("sampleSrc"),
            target_config
        )
        
        assert isinstance(jsp_files, list)
        assert all(file.endswith('.jsp') for file in jsp_files)
        
        print(f"JSP 파일 수집 테스트 통과: {len(jsp_files)}개 파일")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP 파일 수집 테스트 실패")
```

#### 3.2.2 JSP 파일 파싱 테스트
```python
def test_parse_jsp_file():
    """JSP 파일 파싱 테스트"""
    try:
        parser = JspParser("sampleSrc")
        
        # 테스트용 JSP 파일 생성
        test_jsp_content = """
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
    <title>테스트 페이지</title>
</head>
<body>
    <h1>테스트 페이지</h1>
    
    <%
        List<User> users = userService.getUserList();
        String message = userController.getMessage();
    %>
    
    <c:forEach items="${users}" var="user">
        <div>
            <span>${user.name}</span>
            <span>${user.email}</span>
        </div>
    </c:forEach>
    
    <p><%= message %></p>
</body>
</html>
        """
        
        # 임시 JSP 파일 생성
        import tempfile
        with tempfile.NamedTemporaryFile(mode='w', suffix='.jsp', delete=False) as f:
            f.write(test_jsp_content)
            temp_file = f.name
        
        try:
            # JSP 파일 파싱 테스트
            result = parser.parse_jsp_file(temp_file)
            
            assert result is not None
            assert 'jsp_component' in result
            assert 'java_method_relationships' in result
            assert 'file_path' in result
            assert 'has_error' in result
            assert 'error_message' in result
            
            # JSP 컴포넌트 정보 확인
            jsp_component = result['jsp_component']
            if jsp_component:
                assert jsp_component['jsp_name'] is not None
                assert jsp_component['jsp_path'] is not None
                assert jsp_component['line_start'] > 0
                assert jsp_component['line_end'] > 0
                assert jsp_component['hash_value'] is not None
            
            # Java 메서드 관계 확인
            relationships = result['java_method_relationships']
            assert isinstance(relationships, list)
            
            print("JSP 파일 파싱 테스트 통과")
            
        finally:
            # 임시 파일 삭제
            import os
            os.unlink(temp_file)
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP 파일 파싱 테스트 실패")
```

### 3.3 데이터베이스 저장 테스트

#### 3.3.1 JSP 컴포넌트 저장 테스트
```python
def test_save_jsp_components_to_database():
    """JSP 컴포넌트 저장 테스트"""
    try:
        engine = JspLoadingEngine("sampleSrc")
        
        # 테스트용 JSP 컴포넌트 데이터
        test_jsp_components = [{
            'jsp_name': 'test.jsp',
            'jsp_path': '/test/test.jsp',
            'line_start': 1,
            'line_end': 50,
            'hash_value': 'test_hash_123',
            'file_path': '/path/to/test.jsp'
        }]
        
        # JSP 컴포넌트 저장 테스트
        result = engine._save_jsp_components_to_database(test_jsp_components)
        assert result == True
        
        # 데이터베이스에서 확인
        from util import DatabaseUtils
        db_utils = DatabaseUtils(engine.metadata_db_path)
        
        query = "SELECT * FROM components WHERE component_type = 'JSP' AND component_name = 'test.jsp'"
        result = db_utils.execute_query(query)
        
        assert len(result) > 0
        assert result[0]['component_name'] == 'test.jsp'
        assert result[0]['component_type'] == 'JSP'
        
        print("JSP 컴포넌트 저장 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP 컴포넌트 저장 테스트 실패")
```

#### 3.3.2 JSP → METHOD 관계 저장 테스트
```python
def test_save_jsp_method_relationships_to_database():
    """JSP → METHOD 관계 저장 테스트"""
    try:
        engine = JspLoadingEngine("sampleSrc")
        
        # 테스트용 관계 데이터
        test_relationships = [{
            'jsp_name': 'test.jsp',
            'jsp_path': '/test/test.jsp',
            'class_name': 'UserService',
            'method_name': 'getUserList',
            'line_number': 10,
            'rel_type': 'CALL_METHOD'
        }]
        
        # JSP → METHOD 관계 저장 테스트
        result = engine._save_jsp_method_relationships_to_database(test_relationships)
        assert result == True
        
        # 데이터베이스에서 확인
        from util import DatabaseUtils
        db_utils = DatabaseUtils(engine.metadata_db_path)
        
        query = "SELECT * FROM relationships WHERE rel_type = 'CALL_METHOD'"
        result = db_utils.execute_query(query)
        
        assert len(result) > 0
        assert result[0]['rel_type'] == 'CALL_METHOD'
        
        print("JSP → METHOD 관계 저장 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "JSP → METHOD 관계 저장 테스트 실패")
```

---

## 4. 통합 테스트

### 4.1 전체 5단계 통합 테스트
```python
def test_integration_5_stage():
    """5단계 통합 테스트"""
    try:
        # 1-4단계는 이미 완성되어 있으므로 5단계만 테스트
        from jsp_loading import JspLoadingEngine
        
        # 5단계 실행
        engine = JspLoadingEngine("sampleSrc")
        result = engine.execute_jsp_loading()
        
        assert result == True
        
        # 통계 정보 확인
        assert engine.stats['jsp_files_processed'] > 0
        assert engine.stats['jsp_components_created'] > 0
        
        print("5단계 통합 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "5단계 통합 테스트 실패")
```

### 4.2 3-4단계 독립성 테스트
```python
def test_3_4_stage_independence():
    """3-4단계 독립성 테스트"""
    try:
        # 5단계 실행 전후로 3-4단계 데이터가 변경되지 않는지 확인
        from util import DatabaseUtils
        
        # 5단계 실행 전 데이터 백업
        db_utils = DatabaseUtils("./projects/sampleSrc/metadata.db")
        
        # 3단계 데이터 백업
        xml_components_before = db_utils.execute_query(
            "SELECT * FROM components WHERE component_type LIKE 'SQL_%'"
        )
        
        # 4단계 데이터 백업
        java_components_before = db_utils.execute_query(
            "SELECT * FROM components WHERE component_type = 'METHOD'"
        )
        
        # 5단계 실행
        from jsp_loading import JspLoadingEngine
        engine = JspLoadingEngine("sampleSrc")
        engine.execute_jsp_loading()
        
        # 5단계 실행 후 데이터 확인
        xml_components_after = db_utils.execute_query(
            "SELECT * FROM components WHERE component_type LIKE 'SQL_%'"
        )
        
        java_components_after = db_utils.execute_query(
            "SELECT * FROM components WHERE component_type = 'METHOD'"
        )
        
        # 3-4단계 데이터가 변경되지 않았는지 확인
        assert len(xml_components_before) == len(xml_components_after)
        assert len(java_components_before) == len(java_components_after)
        
        print("3-4단계 독립성 테스트 통과")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "3-4단계 독립성 테스트 실패")
```

---

## 5. 성능 테스트

### 5.1 메모리 사용량 테스트
```python
def test_memory_usage():
    """메모리 사용량 테스트"""
    try:
        import psutil
        import os
        
        # 프로세스 메모리 사용량 모니터링
        process = psutil.Process(os.getpid())
        
        # 5단계 실행 전 메모리 사용량
        memory_before = process.memory_info().rss / 1024 / 1024  # MB
        
        # 5단계 실행
        engine = JspLoadingEngine("sampleSrc")
        engine.execute_jsp_loading()
        
        # 5단계 실행 후 메모리 사용량
        memory_after = process.memory_info().rss / 1024 / 1024  # MB
        
        # 메모리 증가량 확인 (100MB 이하로 제한)
        memory_increase = memory_after - memory_before
        assert memory_increase < 100, f"메모리 사용량이 너무 많습니다: {memory_increase}MB"
        
        print(f"메모리 사용량 테스트 통과: {memory_increase}MB 증가")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "메모리 사용량 테스트 실패")
```

### 5.2 처리 시간 테스트
```python
def test_processing_time():
    """처리 시간 테스트"""
    try:
        import time
        
        # 5단계 실행 시간 측정
        start_time = time.time()
        
        engine = JspLoadingEngine("sampleSrc")
        result = engine.execute_jsp_loading()
        
        end_time = time.time()
        processing_time = end_time - start_time
        
        assert result == True
        assert processing_time < 300, f"처리 시간이 너무 오래 걸립니다: {processing_time}초"
        
        print(f"처리 시간 테스트 통과: {processing_time}초")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "처리 시간 테스트 실패")
```

---

## 6. 오류 처리 테스트

### 6.1 파싱 에러 테스트
```python
def test_parsing_error_handling():
    """파싱 에러 처리 테스트"""
    try:
        parser = JspParser("sampleSrc")
        
        # 잘못된 JSP 파일 생성
        invalid_jsp_content = """
        <%@ page language="java" %>
        <html>
        <body>
            <%
                // 잘못된 Java 코드
                List<User> users = userService.getUserList(;
                String message = userController.getMessage();
            %>
            <p><%= message %></p>
        </body>
        </html>
        """
        
        # 임시 파일 생성
        import tempfile
        with tempfile.NamedTemporaryFile(mode='w', suffix='.jsp', delete=False) as f:
            f.write(invalid_jsp_content)
            temp_file = f.name
        
        try:
            # 파싱 에러 테스트
            result = parser.parse_jsp_file(temp_file)
            
            # USER RULES: 파싱에러는 has_error='Y', error_message 저장 후 계속 실행(exit안함)
            assert result['has_error'] == 'Y'
            assert result['error_message'] is not None
            assert '파싱 실패' in result['error_message']
            
            print("파싱 에러 처리 테스트 통과")
            
        finally:
            import os
            os.unlink(temp_file)
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "파싱 에러 처리 테스트 실패")
```

### 6.2 시스템 에러 테스트
```python
def test_system_error_handling():
    """시스템 에러 처리 테스트"""
    try:
        # 잘못된 프로젝트명으로 초기화
        try:
            engine = JspLoadingEngine("nonexistent_project")
            # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
            # 이 테스트는 handle_error()가 호출되어 프로그램이 종료되어야 함
            assert False, "잘못된 프로젝트명으로 초기화 시 handle_error()가 호출되어야 함"
        except SystemExit:
            # handle_error()에서 sys.exit() 호출로 인한 정상 종료
            print("시스템 에러 처리 테스트 통과")
        except Exception as e:
            # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
            handle_error(e, "시스템 에러 처리 테스트 실패")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "시스템 에러 처리 테스트 실패")
```

### 6.4 매뉴얼 기반 테스트 (관계 도출 중심)

#### 6.4.1 JSP 디렉티브 테스트
```python
def test_jsp_directives():
    """JSP 디렉티브 분석 테스트 (매뉴얼 기반)"""
    try:
        # include 디렉티브 테스트
        jsp_content = '<%@ include file="header.jsp" %>'
        parser = JspParser("sampleSrc")
        include_relationships = parser._analyze_jsp_includes(jsp_content, mock_jsp_component)
        
        assert len(include_relationships) == 1
        assert include_relationships[0]['rel_type'] == 'INCLUDE_JSP'
        assert include_relationships[0]['target_jsp'] == 'header.jsp'
        
        # taglib 디렉티브 테스트
        jsp_content = '<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>'
        taglib_relationships = parser._analyze_taglib_usage(jsp_content, mock_jsp_component)
        
        assert len(taglib_relationships) == 1
        assert taglib_relationships[0]['rel_type'] == 'USE_TAGLIB'
        assert 'jstl/core' in taglib_relationships[0]['taglib_uri']
        
        print("JSP 디렉티브 테스트 통과")
        
    except Exception as e:
        handle_error(e, "JSP 디렉티브 테스트 실패")
```

#### 6.4.2 JSP 액션 태그 테스트
```python
def test_jsp_action_tags():
    """JSP 액션 태그 분석 테스트 (매뉴얼 기반)"""
    try:
        parser = JspParser("sampleSrc")
        
        # include 액션 테스트
        jsp_content = '<jsp:include page="footer.jsp"/>'
        include_relationships = parser._analyze_jsp_includes(jsp_content, mock_jsp_component)
        
        assert len(include_relationships) == 1
        assert include_relationships[0]['rel_type'] == 'INCLUDE_JSP'
        assert include_relationships[0]['target_jsp'] == 'footer.jsp'
        
        # forward 액션 테스트
        jsp_content = '<jsp:forward page="error.jsp"/>'
        forward_relationships = parser._analyze_jsp_forwards(jsp_content, mock_jsp_component)
        
        assert len(forward_relationships) == 1
        assert forward_relationships[0]['rel_type'] == 'FORWARD_JSP'
        assert forward_relationships[0]['target_jsp'] == 'error.jsp'
        
        # useBean 액션 테스트
        jsp_content = '<jsp:useBean id="user" class="com.example.User"/>'
        bean_relationships = parser._analyze_bean_usage(jsp_content, mock_jsp_component)
        
        assert len(bean_relationships) == 1
        assert bean_relationships[0]['rel_type'] == 'USE_BEAN'
        assert bean_relationships[0]['bean_class'] == 'com.example.User'
        
        print("JSP 액션 태그 테스트 통과")
        
    except Exception as e:
        handle_error(e, "JSP 액션 태그 테스트 실패")
```

#### 6.4.3 JSTL 라이브러리 테스트
```python
def test_jstl_libraries():
    """JSTL 라이브러리 분석 테스트 (매뉴얼 기반)"""
    try:
        parser = JspParser("sampleSrc")
        
        # JSTL SQL 테스트
        jsp_content = '<sql:query var="result" dataSource="${ds}">SELECT * FROM users</sql:query>'
        sql_relationships = parser._analyze_sql_execution(jsp_content, mock_jsp_component)
        
        assert len(sql_relationships) == 1
        assert sql_relationships[0]['rel_type'] == 'EXECUTE_SQL'
        assert 'SELECT * FROM users' in sql_relationships[0]['sql_query']
        
        # JSTL XML 테스트
        jsp_content = '<x:parse var="doc" xml="${xmlData}"/>'
        xml_relationships = parser._analyze_xml_parsing(jsp_content, mock_jsp_component)
        
        assert len(xml_relationships) == 1
        assert xml_relationships[0]['rel_type'] == 'PARSE_XML'
        assert '${xmlData}' in xml_relationships[0]['xml_data']
        
        print("JSTL 라이브러리 테스트 통과")
        
    except Exception as e:
        handle_error(e, "JSTL 라이브러리 테스트 실패")
```

#### 6.4.4 복합 JSP 파일 테스트
```python
def test_complex_jsp_relationships():
    """복합 JSP 파일에서 모든 관계 도출 테스트"""
    try:
        # 복합 JSP 파일 내용
        jsp_content = '''
        <%@ page language="java" contentType="text/html; charset=UTF-8" %>
        <%@ include file="header.jsp" %>
        <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
        
        <%
            List<User> users = userService.getUserList();
            String message = userController.getMessage();
        %>
        
        <jsp:useBean id="user" class="com.example.User"/>
        <jsp:include page="sidebar.jsp"/>
        
        <c:forEach items="${userService.getUserList()}" var="user">
            <c:out value="${user.name}"/>
        </c:forEach>
        
        <sql:query var="result" dataSource="${ds}">SELECT * FROM users</sql:query>
        <x:parse var="doc" xml="${xmlData}"/>
        
        <jsp:forward page="footer.jsp"/>
        '''
        
        parser = JspParser("sampleSrc")
        result = parser.parse_jsp_file("test.jsp")
        
        # 모든 관계 타입 확인
        assert len(result['java_method_relationships']) > 0  # userService.getUserList(), userController.getMessage()
        assert len(result['jsp_include_relationships']) > 0  # header.jsp, sidebar.jsp
        assert len(result['jsp_forward_relationships']) > 0  # footer.jsp
        assert len(result['jsp_bean_relationships']) > 0     # com.example.User
        assert len(result['jsp_taglib_relationships']) > 0   # JSTL Core
        assert len(result['jsp_sql_relationships']) > 0      # SQL query
        assert len(result['jsp_xml_relationships']) > 0      # XML parsing
        
        print("복합 JSP 파일 관계 도출 테스트 통과")
        
    except Exception as e:
        handle_error(e, "복합 JSP 파일 관계 도출 테스트 실패")
```

#### 6.4.5 중첩 태그 테스트
```python
def test_nested_tags():
    """중첩된 JSP 태그 처리 테스트"""
    try:
        jsp_content = '''
        <c:forEach items="${userService.getUserList()}" var="user">
            <c:if test="${user.active}">
                <jsp:include page="user_detail.jsp">
                    <jsp:param name="userId" value="${user.id}"/>
                </jsp:include>
            </c:if>
        </c:forEach>
        '''
        
        parser = JspParser("sampleSrc")
        result = parser.parse_jsp_file("nested_test.jsp")
        
        # 중첩된 관계들 확인
        assert len(result['java_method_relationships']) > 0  # userService.getUserList()
        assert len(result['jsp_include_relationships']) > 0  # user_detail.jsp
        
        print("중첩 태그 테스트 통과")
        
    except Exception as e:
        handle_error(e, "중첩 태그 테스트 실패")
```

#### 6.4.6 동적 속성 테스트
```python
def test_dynamic_attributes():
    """동적 속성 처리 테스트"""
    try:
        jsp_content = '''
        <%
            String pageName = request.getParameter("page");
        %>
        <jsp:include page="<%= pageName %>"/>
        '''
        
        parser = JspParser("sampleSrc")
        result = parser.parse_jsp_file("dynamic_test.jsp")
        
        # 동적 속성은 정적 분석으로는 완전히 파악하기 어려움
        # 하지만 기본적인 패턴은 인식해야 함
        assert len(result['java_method_relationships']) > 0  # request.getParameter()
        
        print("동적 속성 테스트 통과")
        
    except Exception as e:
        handle_error(e, "동적 속성 테스트 실패")
```

---

## 7. 테스트 실행 스크립트

### 7.1 전체 테스트 실행
```python
def run_all_tests():
    """전체 테스트 실행"""
    try:
        print("=== 5단계 테스트 시작 ===")
        
        # 단위 테스트
        test_jsp_loading_engine_init()
        test_execute_jsp_loading()
        test_get_filtered_jsp_files()
        test_parse_jsp_file()
        test_save_jsp_components_to_database()
        test_save_jsp_method_relationships_to_database()
        
        # 통합 테스트
        test_integration_5_stage()
        test_3_4_stage_independence()
        
        # 성능 테스트
        test_memory_usage()
        test_processing_time()
        
        # 오류 처리 테스트
        test_parsing_error_handling()
        test_system_error_handling()
        
        # 매뉴얼 기반 테스트 (관계 도출 중심)
        test_jsp_directives()
        test_jsp_action_tags()
        test_jstl_libraries()
        test_complex_jsp_relationships()
        test_nested_tags()
        test_dynamic_attributes()
        
        print("=== 모든 테스트 통과 ===")
        
    except Exception as e:
        # USER RULES: 파싱에러를 제외한 모든 exception 발생시 handle_error()로 exit()해야 에러인지가 가능함
        handle_error(e, "전체 테스트 실행 실패")

if __name__ == "__main__":
    run_all_tests()
```

### 7.2 테스트 실행 명령어
```bash
# 단위 테스트 실행
python -m pytest tests/test_jsp_loading_engine.py -v

# 통합 테스트 실행
python -m pytest tests/test_integration.py -v

# 전체 테스트 실행
python tests/run_all_tests.py

# 성능 테스트 실행
python tests/test_performance.py -v
```

---

## 8. 검증 기준

### 8.1 기능적 검증 기준
- ✅ JSP 파일에서 JSP 컴포넌트 정보 추출
- ✅ JSP에서 Java 메서드 호출 분석 (스크립틀릿, 표현식, EL, JSTL)
- ✅ JSP → METHOD 관계 생성 및 저장
- ✅ 메모리 효율적 처리
- ✅ 오류 상황 적절한 처리

### 8.2 비기능적 검증 기준
- ✅ 3-4단계 소스와의 완전한 독립성 보장
- ✅ User Rules 완전 준수
- ✅ 설정 파일 기반 동작
- ✅ 공통 함수 활용 (수정 없이)
- ✅ 상세한 로깅 및 통계

### 8.3 성능 검증 기준
- ✅ 메모리 사용량: 100MB 이하
- ✅ 처리 시간: 5분 이하
- ✅ 스트리밍 처리: 한 파일씩만 메모리에 로드
- ✅ 배치 저장: 효율적인 데이터베이스 저장

---

## 9. 결론

### 9.1 완성된 문서
- **1장**: 개요 및 요구사항 - 5단계 개발의 전체적인 개요
- **2장**: 아키텍처 설계 - 시스템 구조 및 클래스 설계
- **3장**: 상세 구현 계획 - 구체적인 구현 방법 및 로직
- **4장**: 소스코드 구현 가이드 - 실제 구현 가능한 코드 예시
- **5장**: 테스트 및 검증 계획 - 완성도 검증을 위한 테스트 계획

### 9.2 개발 준비 완료
- **기술적 요구사항**: 모든 기술적 요구사항이 문서화됨
- **구현 가이드**: 단계별 구현 가이드 제공
- **오류 처리**: 견고한 오류 처리 전략 수립
- **메모리 최적화**: 효율적인 메모리 사용 전략 수립
- **User Rules 준수**: 모든 User Rules가 반영됨

### 9.3 개발 시작 가능
이제 개발자가 이 문서들을 참고하여 5단계 JSP 파일 분석 기능을 구현할 수 있습니다. 모든 필요한 정보와 가이드가 제공되었으며, User Rules를 준수하는 견고한 구현이 가능합니다.

**중요**: 4단계 이전 파일은 확정 픽스로 절대 영향받지 않도록 개발해야 합니다.

---

**문서 작성 완료**: 2025-09-14 18:48:41  
**문서 버전**: v1.0 (최종 통합본)  
**총 문서 수**: 5개  
**총 페이지 수**: 약 150페이지  
**개발 준비도**: 100% 완료

# 5ë‹¨ê³„ Phase2 Servlet ì§„ì…ì  ë¶„ì„ ìƒì„¸ ê°œë°œ ê³„íšì„œ - ê°œë°œì ì˜ê²¬ 1

## ğŸ“‹ ê°œìš”

**ë¬¸ì„œëª…**: 5ë‹¨ê³„_Phase2_Servletê°œë°œê³„íšì„œ_20250115_ìƒì„¸_ê°œë°œìì˜ê²¬1.md
**ì‘ì„±ì¼**: 2025-09-15
**ì‘ì„±ì**: AI ê°œë°œì (Gemini)
**ê²€í†  ëŒ€ìƒ**: 5ë‹¨ê³„_Phase2_Servletê°œë°œê³„íšì„œ_20250115_ìƒì„¸.md

---

## ğŸ¤– ê°œë°œì ì˜ê²¬

Servlet ë¶„ì„ ê°œë°œ ê³„íšì„œëŠ” Phase 1ì˜ ì„±ê³µì ì¸ ì•„í‚¤í…ì²˜ë¥¼ ì˜ ê³„ìŠ¹í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, Servletì˜ íŠ¹ìˆ˜ì„±ì„ ê³ ë ¤í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë¬¸ì œì ê³¼ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê°œì„ ì•ˆì„ êµ¬ì²´ì ì¸ êµ¬í˜„ ì½”ë“œì™€ í•¨ê»˜ ì œì•ˆí•©ë‹ˆë‹¤.

### â“ ì§ˆë¬¸ (Questions)

1.  **`web.xml` ë¶„ì„ ì‹œì **: ê³„íšì„œì—ëŠ” `web.xml` ë¶„ì„ì´ 'í–¥í›„ í™•ì¥'ìœ¼ë¡œ ì–¸ê¸‰ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ `@WebServlet` ì–´ë…¸í…Œì´ì…˜ì´ ì—†ëŠ” ìˆœìˆ˜ `web.xml` ë§¤í•‘ ë°©ì‹ì˜ ë ˆê±°ì‹œ ì„œë¸”ë¦¿ì€ ì´ˆê¸° ë²„ì „ì—ì„œ ë¶„ì„ì´ ëˆ„ë½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `web.xml` ë¶„ì„ì„ Phase 2ì— í¬í•¨í•˜ëŠ” ê²ƒì´ ì´ˆê¸° ë¶„ì„ ì™„ì„±ë„ë¥¼ ìœ„í•´ ë” ë°”ëŒì§í•˜ì§€ ì•Šì„ê¹Œìš”? ë§Œì•½ í¬í•¨í•œë‹¤ë©´, `web.xml` íŒŒì¼ì€ ì–´ë–¤ ë‹¨ê³„ì—ì„œ íŒŒì‹±í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ Java íŒŒì¼ ë¶„ì„ê³¼ ì—°ê²°í•  ê³„íšì¸ê°€ìš”?

2.  **URL íŒ¨í„´ì˜ ë‹¤ì–‘ì„±**: `@WebServlet`ì˜ `urlPatterns`ëŠ” ì—¬ëŸ¬ ê°œì˜ URLì„ ê°€ì§ˆ ìˆ˜ ìˆê³ , ì™€ì¼ë“œì¹´ë“œ(`*`)ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `normalize_url_path` í•¨ìˆ˜ê°€ ì™€ì¼ë“œì¹´ë“œë¥¼ í¬í•¨í•œ ê²½ë¡œë„ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‚˜ìš”? ë˜í•œ, `servlet-mapping`ì˜ `url-pattern`ì€ í™•ì¥ì ë§¤í•‘(ì˜ˆ: `*.do`)ë„ ê°€ëŠ¥í•œë°, ì´ëŸ¬í•œ í˜•íƒœì˜ ë§¤í•‘ì€ ì–´ë–»ê²Œ `API_ENTRY`ë¡œ ë³€í™˜í•  ê³„íšì¸ê°€ìš”?

3.  **`loadOnStartup` ì²˜ë¦¬**: `web.xml`ì´ë‚˜ `@WebServlet`ì˜ `loadOnStartup` ì†ì„±ì€ ì„œë²„ ì‹œì‘ ì‹œ ì„œë¸”ë¦¿ì„ ì´ˆê¸°í™”í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ëŠ” ì§ì ‘ì ì¸ HTTP ìš”ì²­ ì§„ì…ì ì€ ì•„ë‹ˆì§€ë§Œ, ì¤‘ìš”í•œ ì´ˆê¸°í™” ë¡œì§ì„ ë‹´ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„œë¸”ë¦¿ì„ ë¶„ì„ ëŒ€ìƒì— í¬í•¨í•  ê²ƒì¸ì§€, í¬í•¨í•œë‹¤ë©´ ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ íƒ€ì…ìœ¼ë¡œ ê´€ë¦¬í•  ê²ƒì¸ì§€ ì •ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### ğŸ’£ ë¬¸ì œì  (Potential Issues)

1.  **`HttpServlet` ìƒì† êµ¬ì¡°ì˜ ë³µì¡ì„±**: ì„œë¸”ë¦¿ì€ ë‹¤ë‹¨ê³„ ìƒì†(ì˜ˆ: `MyBaseServlet` -> `MySpecificServlet`)ì´ ê°€ëŠ¥í•˜ë©°, ë¶€ëª¨ í´ë˜ìŠ¤ì—ì„œ `doGet`, `doPost` ë“±ì˜ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê³  ìì‹ í´ë˜ìŠ¤ì—ì„œ ì´ë¥¼ ì˜¤ë²„ë¼ì´ë“œ(Override)í•˜ê±°ë‚˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ì˜ ë‹¨ì¼ íŒŒì¼ ê¸°ë°˜ ë¶„ì„ê¸°ë¡œëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì˜ `doGet`ì„ ìì‹ ì„œë¸”ë¦¿ì˜ ì§„ì…ì ìœ¼ë¡œ ì¸ì‹í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ì´ëŠ” 4ë‹¨ê³„ì—ì„œ ë¶„ì„ëœ í´ë˜ìŠ¤ ìƒì† ê´€ê³„ ì •ë³´(`extends` ê´€ê³„)ë¥¼ í™œìš©í•´ì•¼ë§Œ ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

2.  **`web.xml` ë§¤í•‘ ì •ë³´ì™€ Java íŒŒì¼ ì—°ê²°ì˜ ì–´ë ¤ì›€**: `web.xml`ì—ëŠ” ì„œë¸”ë¦¿ í´ë˜ìŠ¤ì˜ ì „ì²´ íŒ¨í‚¤ì§€ ê²½ë¡œ(ì˜ˆ: `com.example.MyServlet`)ê°€ ë¬¸ìì—´ë¡œ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ìì—´ì„ ê¸°ë°˜ìœ¼ë¡œ `files` í…Œì´ë¸”ì—ì„œ ì •í™•í•œ `.java` íŒŒì¼ì„ ì°¾ì•„ ì—°ê²°í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤. íŒ¨í‚¤ì§€ ê²½ë¡œë¥¼ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê±°ë‚˜, ë™ì¼í•œ í´ë˜ìŠ¤ëª…ì„ ê°€ì§„ íŒŒì¼ì´ ì—¬ëŸ¬ ê°œ ìˆì„ ê²½ìš° ëª¨í˜¸ì„±ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3.  **HTTP ë©”ì„œë“œì˜ ì•”ì‹œì  ì²˜ë¦¬**: ì„œë¸”ë¦¿ì—ì„œëŠ” `service()` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ëª¨ë“  HTTP ìš”ì²­ì„ í•œ ê³³ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° `doGet`, `doPost` ê°™ì€ ëª…ì‹œì ì¸ ë©”ì„œë“œëª…ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ í˜„ì¬ì˜ `http_method_mapping` ì„¤ì •ë§Œìœ¼ë¡œëŠ” HTTP ë©”ì„œë“œë¥¼ íŠ¹ì •í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. `service()` ë©”ì„œë“œê°€ ì¡´ì¬í•  ê²½ìš°, `default_http_methods`ì— ì •ì˜ëœ ëª¨ë“  ë©”ì„œë“œ(ë˜ëŠ” 'ANY')ë¡œ ë§¤í•‘í•˜ëŠ” ê·œì¹™ì´ í•„ìš”í•©ë‹ˆë‹¤.

### ğŸ’¡ ê°œì„ ì  ë° ìƒì„¸ êµ¬í˜„ ë°©ì•ˆ (Suggestions & Implementation Details)

#### 1. `web.xml` ë¶„ì„ê¸° í†µí•© ë° ìƒì† ê´€ê³„ í™œìš©

**ì œì•ˆ ë‚´ìš©**:
`ServletEntryAnalyzer` ë‚´ë¶€ì— `web.xml`ì„ íŒŒì‹±í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ê³ , 4ë‹¨ê³„ì—ì„œ ìƒì„±ëœ í´ë˜ìŠ¤ ìƒì† ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ë‹¨ê³„ ìƒì† êµ¬ì¡°ë¥¼ ì¶”ì í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

**êµ¬í˜„ ë°©ì•ˆ**:
1.  `backend_entry_loading.py`ëŠ” ì‹œì‘ ì‹œ `web.xml` íŒŒì¼ì„ ë¨¼ì € íŒŒì‹±í•˜ì—¬ `ì„œë¸”ë¦¿ í´ë˜ìŠ¤ëª… -> URL íŒ¨í„´` ë§µì„ ë©”ëª¨ë¦¬ì— ìƒì„±í•©ë‹ˆë‹¤. Pythonì˜ `xml.etree.ElementTree`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
2.  ì´ ë§µ ì •ë³´ë¥¼ `ServletEntryAnalyzer`ì— ì „ë‹¬í•©ë‹ˆë‹¤.
3.  `ServletEntryAnalyzer`ëŠ” Java íŒŒì¼ ë¶„ì„ ì‹œ, `@WebServlet` ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ `web.xml` ë§µì—ì„œ í˜„ì¬ í´ë˜ìŠ¤ì— ë§¤í•‘ëœ URLì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
4.  `doGet`, `doPost` ë“±ì˜ ë©”ì„œë“œë¥¼ ì°¾ì„ ë•Œ, í˜„ì¬ í´ë˜ìŠ¤ì— ì—†ìœ¼ë©´ DBì—ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì§„ì…ì ìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.

**ì†ŒìŠ¤ ì½”ë“œ ì˜ˆì‹œ**:

**`backend_entry_loading.py`ì— `web.xml` íŒŒì‹± ë¡œì§ ì¶”ê°€:**
```python
# backend_entry_loading.py

import xml.etree.ElementTree as ET

class BackendEntryLoadingEngine:
    def __init__(self, project_name: str):
        # ...
        self.servlet_url_map = self._parse_web_xml()

    def _parse_web_xml(self) -> dict:
        """í”„ë¡œì íŠ¸ ë‚´ì˜ web.xmlì„ íŒŒì‹±í•˜ì—¬ ì„œë¸”ë¦¿ í´ë˜ìŠ¤ì™€ URL íŒ¨í„´ ë§µì„ ìƒì„±í•œë‹¤."""
        web_xml_files = self.db.get_files_by_name('web.xml')
        url_map = {}
        if not web_xml_files:
            return url_map

        try:
            tree = ET.parse(web_xml_files[0].path) # ì²« ë²ˆì§¸ web.xmlë§Œ ì²˜ë¦¬
            root = tree.getroot()
            
            servlet_mappings = {}
            for servlet_mapping in root.findall('servlet-mapping'):
                name = servlet_mapping.find('servlet-name').text
                pattern = servlet_mapping.find('url-pattern').text
                servlet_mappings[name] = pattern

            for servlet in root.findall('servlet'):
                name = servlet.find('servlet-name').text
                class_path = servlet.find('servlet-class').text
                if name in servlet_mappings:
                    url_map[class_path] = servlet_mappings[name]
            
            logger.info(f"web.xml íŒŒì‹± ì™„ë£Œ. {len(url_map)}ê°œì˜ ì„œë¸”ë¦¿ ë§¤í•‘ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.")
            return url_map
        except Exception as e:
            logger.error(f"web.xml íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
            return {} # ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¹ˆ ë§µ ë°˜í™˜

    def execute_backend_entry_loading(self):
        # ...
        # analyzer ìƒì„± ì‹œ web.xml ë§µ ì „ë‹¬
        # analyzer = self.analyzer_factory.create_analyzer(framework, servlet_url_map=self.servlet_url_map)
        pass
```

**`ServletEntryAnalyzer`ì—ì„œ ìƒì† ê´€ê³„ ë° `web.xml` ë§µ í™œìš©:**
```python
# parser/servlet_entry_analyzer.py

class ServletEntryAnalyzer(BaseEntryAnalyzer):
    def __init__(self, servlet_url_map: dict):
        super().__init__('servlet', 'config/parser/servlet_entry_keyword.yaml')
        self.servlet_url_map = servlet_url_map
        self.db = DatabaseManager() # DB ì ‘ê·¼ìš©

    def analyze_backend_entry(self, java_file: FileInfo, stats: 'StatisticsCollector'):
        # ...
        # 1. @WebServlet ë¶„ì„
        # 2. ì–´ë…¸í…Œì´ì…˜ ì—†ìœ¼ë©´ web.xml ë§µì—ì„œ URL ì¡°íšŒ
        class_full_path = self._get_full_class_path(java_file.content)
        if class_full_path in self.servlet_url_map:
            url_pattern = self.servlet_url_map[class_full_path]
            # ...
        
        # 3. doXXX ë©”ì„œë“œ íƒìƒ‰ (ìƒì† í¬í•¨)
        http_methods = self._find_http_methods_recursively(class_full_path)
        # ...
    
    def _find_http_methods_recursively(self, class_name: str, visited=None) -> dict:
        """í˜„ì¬ í´ë˜ìŠ¤ì™€ ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•˜ì—¬ doXXX ë©”ì„œë“œë¥¼ ì°¾ëŠ”ë‹¤."""
        if visited is None: visited = set()
        if class_name in visited: return {}
        visited.add(class_name)

        # 1. í˜„ì¬ í´ë˜ìŠ¤ì—ì„œ doXXX ë©”ì„œë“œ ì°¾ê¸°
        # ... (AST ë˜ëŠ” ì •ê·œì‹ìœ¼ë¡œ í˜„ì¬ íŒŒì¼ ë‚´ìš© ë¶„ì„) ...
        found_methods = {} # {'doGet': 'GET', 'doPost': 'POST'}

        # 2. ë¶€ëª¨ í´ë˜ìŠ¤ ì •ë³´ ì¡°íšŒ (4ë‹¨ê³„ ë¶„ì„ ê²°ê³¼ í™œìš©)
        parent_class = self.db.get_parent_class(class_name)
        if parent_class:
            parent_methods = self._find_http_methods_recursively(parent_class, visited)
            # ë¶€ëª¨ ë©”ì„œë“œë¥¼ ë¨¼ì € ë„£ê³ , ìì‹ ë©”ì„œë“œë¡œ ë®ì–´ì“°ê¸° (ì˜¤ë²„ë¼ì´ë”©)
            parent_methods.update(found_methods)
            return parent_methods
        
        return found_methods
```

#### 2. `service()` ë©”ì„œë“œ ë° í™•ì¥ì ë§¤í•‘ ì²˜ë¦¬ ê·œì¹™ ì •ì˜

**ì œì•ˆ ë‚´ìš©**:
`servlet_entry_keyword.yaml`ì— `service()` ë©”ì„œë“œ ì²˜ë¦¬ ê·œì¹™ê³¼ í™•ì¥ì ë§¤í•‘(`*.do`) ì²˜ë¦¬ ê·œì¹™ì„ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€í•˜ì—¬ ë¶„ì„ì˜ ì¼ê´€ì„±ì„ ë†’ì…ë‹ˆë‹¤.

**êµ¬í˜„ ë°©ì•ˆ**:
1.  `servlet_entry_keyword.yaml`ì— `service_method_http_methods`ì™€ `extension_mapping_prefix` ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
2.  `ServletEntryAnalyzer`ëŠ” `service` ë©”ì„œë“œë¥¼ ë°œê²¬í•˜ë©´ `service_method_http_methods`ì— ì •ì˜ëœ HTTP ë©”ì„œë“œë“¤ë¡œ ì§„ì…ì ì„ ìƒì„±í•©ë‹ˆë‹¤.
3.  URL íŒ¨í„´ì´ `*.do`ì™€ ê°™ì€ í™•ì¥ì íŒ¨í„´ì¼ ê²½ìš°, `extension_mapping_prefix`ë¥¼ ì‚¬ìš©í•˜ì—¬ `API_ENTRY.ANY_DO_PATTERN`ê³¼ ê°™ì´ í‘œì¤€í™”ëœ ì»´í¬ë„ŒíŠ¸ ì´ë¦„ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

**ì†ŒìŠ¤ ì½”ë“œ ì˜ˆì‹œ**:

**`config/parser/servlet_entry_keyword.yaml` ì„¤ì • ì¶”ê°€:**
```yaml
# ...
http_method_mapping:
  # ...
  # service() ë©”ì„œë“œë¥¼ ë°œê²¬í–ˆì„ ë•Œ ë§¤í•‘í•  HTTP ë©”ì„œë“œ ëª©ë¡
  service_method_http_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"

mapping_extraction:
  # ...
  # í™•ì¥ì ë§¤í•‘(ì˜ˆ: *.do)ì„ ì»´í¬ë„ŒíŠ¸ ì´ë¦„ìœ¼ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©í•  ì ‘ë‘ì‚¬
  extension_mapping_prefix: "EXT_PATTERN"
```

**`ServletEntryAnalyzer`ì— ë¡œì§ ì¶”ê°€:**
```python
# parser/servlet_entry_analyzer.py

def _convert_to_backend_entry_info(self, analysis_results, java_file):
    # ...
    for result in analysis_results:
        url = result['url_pattern']
        # í™•ì¥ì ë§¤í•‘ ì²˜ë¦¬
        if url.startswith('*.'):
            ext = url.split('.')[-1]
            # ì˜ˆ: API_ENTRY.ANY_EXT_PATTERN_DO
            component_url = f"{self.config['mapping_extraction']['extension_mapping_prefix']}_{ext.upper()}"
        else:
            component_url = url
        # ...
```
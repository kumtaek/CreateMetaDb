# SourceAnalyzer ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ì˜ì„œ v4.0

## ë¬¸ì„œ ëª©ì 

ì´ ë¬¸ì„œëŠ” SourceAnalyzer ì‹œìŠ¤í…œì˜ **í†µí•© ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°**ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.  
**ì£¼ìš” ë³€ê²½ì‚¬í•­**: Java SQL ì²˜ë¦¬ ê¸°ëŠ¥ ì¶”ê°€, SqlContent.db ë³„ë„ ê´€ë¦¬, ê³µí†µ SQL íŒŒì„œ ì ìš©  
**ëŒ€ìƒ ë…ì**: ê°œë°œì, DBA, ì‹œìŠ¤í…œ ì•„í‚¤í…íŠ¸  

## ê°œìš”

SourceAnalyzer ì‹œìŠ¤í…œì˜ ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ì˜ì„œ v4.0ì…ë‹ˆë‹¤. Java StringBuilder SQL ì¶”ì¶œ, SQL ì••ì¶• ì €ì¥, ê³µí†µ SQL ì¡°ì¸ ë¶„ì„ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

## ìŠ¤í‚¤ë§ˆ ë²„ì „

- **ë²„ì „**: v4.0 (Java SQL ì²˜ë¦¬ ë° ê³µí†µ SQL íŒŒì„œ ì ìš©)
- **ì£¼ìš” ë³€ê²½**: Java SQL ì»´í¬ë„ŒíŠ¸ ì§€ì›, SqlContent.db ë³„ë„ ê´€ë¦¬
- **ì‹œê°„ëŒ€**: í•œêµ­ ì‹œê°„ëŒ€(KST) ì ìš© (UTC+9)
- **ìµœì¢… ìˆ˜ì •**: 2025-01-18

## ERD (Entity Relationship Diagram)

```mermaid
erDiagram
    projects {
        int project_id
        string project_name
        string project_path
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
        int total_files
    }

    files {
        int file_id
        int project_id
        string file_path
        string file_name
        string file_type
        string frameworks
        char has_error
        text error_message
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
        int line_count
        int file_size
    }

    tables {
        int table_id
        int project_id
        int component_id
        string table_name
        string table_owner
        text table_comments
        char has_error
        text error_message
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
    }

    columns {
        int column_id
        int table_id
        int component_id
        string column_name
        string data_type
        int data_length
        char nullable
        text column_comments
        int position_pk
        text data_default
        string owner
        char has_error
        text error_message
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
    }

    classes {
        int class_id
        int project_id
        int file_id
        string class_name
        int parent_class_id
        int line_start
        int line_end
        char has_error
        text error_message
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
    }

    components {
        int component_id
        int project_id
        int file_id
        string component_name
        string component_type
        int parent_id
        string layer
        int line_start
        int line_end
        char has_error
        text error_message
        string hash_value
        datetime created_at
        datetime updated_at
        char del_yn
    }

    relationships {
        int relationship_id
        int src_id
        int dst_id
        string rel_type
        float confidence
        char has_error
        text error_message
        datetime created_at
        datetime updated_at
        char del_yn
    }

    projects ||--o{ files : contains
    projects ||--o{ tables : owns
    projects ||--o{ classes : contains
    projects ||--o{ components : has
    
    files ||--o{ classes : defines
    files ||--o{ components : contains
    
    tables ||--o{ columns : has
    tables ||--o{ components : represents
    
    columns ||--o{ components : represents
    
    classes ||--o{ classes : inherits
    
    components ||--o{ relationships : source
    components ||--o{ relationships : target
```

## í…Œì´ë¸” ìƒì„¸ ì •ì˜

**ì´ í…Œì´ë¸” ìˆ˜**: 7ê°œ (projects, files, classes, components, tables, columns, relationships)

### 1. projects (í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„°)

í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…          | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…          |
| ------------ | ------------ | ------------------------------------- | ----------- |
| project_id   | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | í”„ë¡œì íŠ¸ ê³ ìœ  ID  |
| project_name | VARCHAR(100) | NOT NULL                              | í”„ë¡œì íŠ¸ëª…       |
| project_path | VARCHAR(500) | NOT NULL                              | í”„ë¡œì íŠ¸ ê²½ë¡œ     |
| hash_value   | VARCHAR(64)  |                                       | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’  |
| created_at   | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ        |
| updated_at   | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ        |
| del_yn       | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N) |
| total_files  | INTEGER      | DEFAULT 0                             | í”„ë¡œì íŠ¸ ë‚´ ì´ íŒŒì¼ ìˆ˜ |

### 2. files (íŒŒì¼ ì¸ë±ìŠ¤)

ë¶„ì„ ëŒ€ìƒ íŒŒì¼ë“¤ì˜ ìµœì†Œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…           | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…                          |
| ------------- | ------------ | ------------------------------------- | --------------------------- |
| file_id       | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | íŒŒì¼ ê³ ìœ  ID                    |
| project_id    | INTEGER      | NOT NULL, FK                          | í”„ë¡œì íŠ¸ ID                     |
| file_path     | VARCHAR(500) | NOT NULL                              | ìƒëŒ€ê²½ë¡œ                        |
| file_name     | VARCHAR(200) | NOT NULL                              | íŒŒì¼ëª…                         |
| file_type     | VARCHAR(20)  | NOT NULL                              | íŒŒì¼ íƒ€ì… (java, jsp, sql, xml, js, html ë“±) |
| **frameworks** | **VARCHAR(100)** |                                   | **í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒ (jquery, axios, fetch, xhr)** |
| has_error     | CHAR(1)      | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N)                 |
| error_message | TEXT         |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€                      |
| hash_value    | VARCHAR(64)  | NOT NULL                              | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’                  |
| created_at    | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ                        |
| updated_at    | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ                        |
| del_yn        | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N)                 |
| line_count    | INTEGER      |                                       | ë¼ì¸ ìˆ˜                        |
| file_size     | INTEGER      |                                       | íŒŒì¼ í¬ê¸° (ë°”ì´íŠ¸)                |

**frameworks í•„ë“œ ìƒì„¸:**
- **ëŒ€ìƒ íŒŒì¼**: JSP, JSX, Vue, TS, TSX, JS, HTML íŒŒì¼
- **ì €ì¥ í˜•ì‹**: ì½¤ë§ˆ êµ¬ë¶„ ë¬¸ìì—´ (ì˜ˆ: 'jquery, axios, fetch')
- **ì¤‘ë³µ ì œê±°**: ê°™ì€ í”„ë ˆì„ì›Œí¬ëŠ” í•œ ë²ˆë§Œ ì €ì¥
- **ì •ë ¬**: ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì €ì¥
- **ì†Œë¬¸ì ë³€í™˜**: ì¼ê´€ì„±ì„ ìœ„í•´ ëª¨ë‘ ì†Œë¬¸ìë¡œ ì €ì¥

**frameworks ì˜ˆì‹œ ë°ì´í„°:**
```sql
-- UserList.jsx: Axiosì™€ Fetch ì‚¬ìš©
frameworks = 'axios, fetch'

-- OrderForm.jsp: jQuery ì‚¬ìš©  
frameworks = 'jquery'

-- ApiClient.js: ëª¨ë“  ë°©ì‹ ì‚¬ìš©
frameworks = 'axios, fetch, jquery, xhr'

-- Dashboard.html: jQueryì™€ Fetch ì‚¬ìš©
frameworks = 'fetch, jquery'
```

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `project_id` â†’ `projects.project_id`

### 3. classes (í´ë˜ìŠ¤ ì •ë³´)

í´ë˜ìŠ¤ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…             | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…              |
| --------------- | ------------ | ------------------------------------- | --------------- |
| class_id        | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | í´ë˜ìŠ¤ ê³ ìœ  ID       |
| project_id      | INTEGER      | NOT NULL, FK                          | í”„ë¡œì íŠ¸ ID         |
| file_id         | INTEGER      | NOT NULL, FK                          | íŒŒì¼ ID           |
| class_name      | VARCHAR(200) | NOT NULL                              | í´ë˜ìŠ¤ëª…            |
| parent_class_id | INTEGER      | FK                                    | ìƒì†/êµ¬í˜„ ë¶€ëª¨ í´ë˜ìŠ¤ ID |
| line_start      | INTEGER      |                                       | ì‹œì‘ ë¼ì¸           |
| line_end        | INTEGER      |                                       | ì¢…ë£Œ ë¼ì¸           |
| has_error       | CHAR(1)      | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N)     |
| error_message   | TEXT         |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€          |
| hash_value      | VARCHAR(64)  |                                       | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’      |
| created_at      | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ            |
| updated_at      | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ            |
| del_yn          | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N)     |

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `project_id` â†’ `projects.project_id`
- `file_id` â†’ `files.file_id`
- `parent_class_id` â†’ `classes.class_id` (ìƒì†/êµ¬í˜„ ë¶€ëª¨ í´ë˜ìŠ¤ ì°¸ì¡°)

### 4. components (ì½”ë“œ êµ¬ì„± ìš”ì†Œ - í†µí•©)

í´ë˜ìŠ¤, ë©”ì„œë“œ, API í˜¸ì¶œ ë“±ì˜ ëª¨ë“  êµ¬ì„±ìš”ì†Œë¥¼ ì €ì¥í•˜ëŠ” í—ˆë¸Œ í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…            | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…                                                                                              |
| -------------- | ------------ | ------------------------------------- | ----------------------------------------------------------------------------------------------- |
| component_id   | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | êµ¬ì„±ìš”ì†Œ ê³ ìœ  ID                                                                                      |
| project_id     | INTEGER      | NOT NULL, FK                          | í”„ë¡œì íŠ¸ ID                                                                                         |
| file_id        | INTEGER      | NOT NULL, FK                          | **íŒŒì¼ ID - ì»´í¬ë„ŒíŠ¸ë³„ ì„¤ì • ì›ì¹™ ì ìš©**                                                                                           |
| component_name | VARCHAR(200) | NOT NULL                              | êµ¬ì„±ìš”ì†Œëª…                                                                                           |
| component_type | VARCHAR(20)  | NOT NULL                              | êµ¬ì„±ìš”ì†Œ íƒ€ì… (METHOD, SQL_SELECT, SQL_INSERT, SQL_UPDATE, SQL_DELETE, TABLE, COLUMN, API_URL). **Java/XML ëª¨ë‘ì—ì„œ SQL_* íƒ€ì… ìƒì„± ê°€ëŠ¥**. JSP/JSX/Vue ë“± í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ì€ files í…Œì´ë¸”ì—ë§Œ ì €ì¥ |
| parent_id      | INTEGER      |                                       | ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ID (COLUMNì¼ë•ŒëŠ” TABLEì˜ component_id, METHODì¼ë•ŒëŠ” classesì˜ class_id)                                                                              |
| layer          | VARCHAR(30)  |                                       | ê³„ì¸µ (controller, service, mapper, model, dao, view, jsp, xml, db)                                |
| line_start     | INTEGER      |                                       | ì‹œì‘ ë¼ì¸                                                                                           |
| line_end       | INTEGER      |                                       | ì¢…ë£Œ ë¼ì¸                                                                                           |
| has_error      | CHAR(1)      | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N)                                                                                     |
| error_message  | TEXT         |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€                                                                                          |
| hash_value     | VARCHAR(64)  |                                       | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’                                                                                      |
| created_at     | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ                                                                                            |
| updated_at     | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ                                                                                            |
| del_yn         | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N)                                                                                     |
| api_url        | VARCHAR(500) |                                       | API URL (API_URL íƒ€ì…ì¼ ë•Œ)                                                                        |
| call_method    | VARCHAR(10)  |                                       | HTTP ë©”ì„œë“œ (GET, POST, PUT, DELETE)                                                               |
| class_name     | VARCHAR(200) |                                       | í´ë˜ìŠ¤ëª… (ë°±ì—”ë“œ ë©”ì„œë“œ ì—°ê²° ì‹œ)                                                                      |
| method_name    | VARCHAR(200) |                                       | ë©”ì„œë“œëª… (ë°±ì—”ë“œ ë©”ì„œë“œ ì—°ê²° ì‹œ)                                                                      |

#### **file_id ì„¤ì • ì›ì¹™**

ê° ì»´í¬ë„ŒíŠ¸ íƒ€ì…ë³„ë¡œ file_id ì„¤ì • ì›ì¹™ì´ ë‹¤ë¦…ë‹ˆë‹¤:

##### **1. API_URL ì»´í¬ë„ŒíŠ¸**
- **ì´ˆê¸° ìƒì„±**: ë°±ì—”ë“œ Java íŒŒì¼ì˜ file_id
- **ë§¤ì¹­ ì„±ê³µ**: í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ì˜ file_idë¡œ ê°±ì‹ 
- **ë§¤ì¹­ ì‹¤íŒ¨**: ë¶„ë¦¬ëœ ë‘ ê°œì˜ API_URL (ê°ê° ë‹¤ë¥¸ file_id)

```python
# 1ë‹¨ê³„: ë°±ì—”ë“œì—ì„œ ìƒì„±
API_URL.file_id = java_file_id

# 2ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ë§¤ì¹­ ì„±ê³µ
ê¸°ì¡´_API_URL.file_id = frontend_file_idë¡œ ê°±ì‹ 

# 3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ë§¤ì¹­ ì‹¤íŒ¨  
ìƒˆë¡œìš´_API_URL.file_id = frontend_file_id  # í”„ë¡ íŠ¸ì—”ë“œ ê²ƒ
ê¸°ì¡´_API_URL.file_id = java_file_id        # ë°±ì—”ë“œ ê²ƒ ìœ ì§€
```

##### **2. TABLE ì»´í¬ë„ŒíŠ¸**
- **ì›ì¹™**: ALL_TABLES.csv íŒŒì¼ì˜ file_id ì‚¬ìš©
- **êµ¬í˜„**: ë™ì  ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€)

```python
# ë™ì  file_id ì¡°íšŒ
all_tables_file_id = get_file_id_by_name('ALL_TABLES.csv')
TABLE_component.file_id = all_tables_file_id
```

##### **3. COLUMN ì»´í¬ë„ŒíŠ¸**  
- **ì›ì¹™**: ALL_TAB_COLUMNS.csv íŒŒì¼ì˜ file_id ì‚¬ìš©
- **êµ¬í˜„**: ë™ì  ì¡°íšŒ (í•˜ë“œì½”ë”© ê¸ˆì§€)

```python
# ë™ì  file_id ì¡°íšŒ
all_columns_file_id = get_file_id_by_name('ALL_TAB_COLUMNS.csv')
COLUMN_component.file_id = all_columns_file_id
```

##### **4. METHOD/SQL_* ì»´í¬ë„ŒíŠ¸**
- **ì›ì¹™**: ì‹¤ì œ ì†ŒìŠ¤ íŒŒì¼ì˜ file_id ì‚¬ìš© (Java, XML ë“±)
- **ì¶”ë¡ ëœ ì»´í¬ë„ŒíŠ¸**: ì›ë³¸ ì†ŒìŠ¤ íŒŒì¼ file_id ìœ ì§€

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `project_id` â†’ `projects.project_id`
- `file_id` â†’ `files.file_id`

**ì¸ë±ìŠ¤:**
- `ix_components_01`: (component_name, file_id, project_id) - UNIQUE

### 5. tables (ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì •ë³´)

ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…            | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…          |
| -------------- | ------------ | ------------------------------------- | ----------- |
| table_id       | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | í…Œì´ë¸” ê³ ìœ  ID   |
| project_id     | INTEGER      | NOT NULL, FK                          | í”„ë¡œì íŠ¸ ID     |
| component_id   | INTEGER      | FK                                    | êµ¬ì„±ìš”ì†Œ ID     |
| table_name     | VARCHAR(100) | NOT NULL                              | í…Œì´ë¸”ëª…        |
| table_owner    | VARCHAR(50)  | NOT NULL                              | í…Œì´ë¸” ì†Œìœ ì     |
| table_comments | TEXT         |                                       | í…Œì´ë¸” ì½”ë©˜íŠ¸     |
| has_error      | CHAR(1)      | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N) |
| error_message  | TEXT         |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€      |
| hash_value     | VARCHAR(64)  |                                       | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’  |
| created_at     | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ        |
| updated_at     | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ        |
| del_yn         | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N) |

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `project_id` â†’ `projects.project_id`
- `component_id` â†’ `components.component_id`

### 6. columns (ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´)

ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…             | ë°ì´í„°íƒ€ì…        | ì œì•½ì¡°ê±´                                  | ì„¤ëª…                   |
| --------------- | ------------ | ------------------------------------- | -------------------- |
| column_id       | INTEGER      | PRIMARY KEY, AUTOINCREMENT            | ì»¬ëŸ¼ ê³ ìœ  ID             |
| table_id        | INTEGER      | NOT NULL, FK                          | í…Œì´ë¸” ID               |
| component_id    | INTEGER      | FK                                    | ì»´í¬ë„ŒíŠ¸ ID (COLUMN íƒ€ì…) |
| column_name     | VARCHAR(100) | NOT NULL                              | ì»¬ëŸ¼ëª…                  |
| data_type       | VARCHAR(50)  |                                       | ë°ì´í„° íƒ€ì…               |
| data_length     | INTEGER      |                                       | ë°ì´í„° ê¸¸ì´               |
| nullable        | CHAR(1)      | DEFAULT 'Y'                           | NULL í—ˆìš© ì—¬ë¶€           |
| column_comments | TEXT         |                                       | ì»¬ëŸ¼ ì½”ë©˜íŠ¸               |
| position_pk     | INTEGER      |                                       | PK ìˆœë²ˆ (nullì´ë©´ PK ì•„ë‹˜) |
| data_default    | TEXT         |                                       | ê¸°ë³¸ê°’                  |
| owner           | VARCHAR(50)  |                                       | ì†Œìœ ì                  |
| has_error       | CHAR(1)      | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N)          |
| error_message   | TEXT         |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€               |
| hash_value      | VARCHAR(64)  |                                       | ë³€ê²½ ê°ì§€ìš© í•´ì‹œê°’           |
| created_at      | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ                 |
| updated_at      | DATETIME     | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ                 |
| del_yn          | CHAR(1)      | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N)          |

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `table_id` â†’ `tables.table_id`
- `component_id` â†’ `components.component_id`

### 7. relationships (í†µí•© ê´€ê³„ ì •ë³´)

ëª¨ë“  ê´€ê³„ë¥¼ í†µí•© ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª…             | ë°ì´í„°íƒ€ì…       | ì œì•½ì¡°ê±´                                  | ì„¤ëª…                                                                                            |
| --------------- | ----------- | ------------------------------------- | --------------------------------------------------------------------------------------------- |
| relationship_id | INTEGER     | PRIMARY KEY, AUTOINCREMENT            | ê´€ê³„ ê³ ìœ  ID                                                                                      |
| src_id          | INTEGER     | NOT NULL, FK                          | ì†ŒìŠ¤ ID (component_id, table_id, column_id ë“±)                                                   |
| dst_id          | INTEGER     | NOT NULL, FK                          | ëŒ€ìƒ ID (component_id, table_id, column_id ë“±)                                                   |
| rel_type        | VARCHAR(30) | NOT NULL                              | ê´€ê³„ íƒ€ì… (CALL_METHOD, CALL_QUERY, USE_TABLE, INHERITANCE, JOIN_EXPLICIT, JOIN_IMPLICIT) |
| confidence      | FLOAT       | DEFAULT 1.0                           | ì‹ ë¢°ë„                                                                                           |
| has_error       | CHAR(1)     | DEFAULT 'N'                           | ì˜¤ë¥˜ ì—¬ë¶€ (Y/N)                                                                                   |
| error_message   | TEXT        |                                       | ì˜¤ë¥˜ ë©”ì‹œì§€                                                                                        |
| created_at      | DATETIME    | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ                                                                                          |
| updated_at      | DATETIME    | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ                                                                                          |
| del_yn          | CHAR(1)     | DEFAULT 'N'                           | ì‚­ì œ ì—¬ë¶€ (Y/N)                                                                                   |

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `src_id` â†’ `components.component_id` (ëª¨ë“  ê´€ê³„ì˜ ì†ŒìŠ¤)
- `dst_id` â†’ `components.component_id` (ëª¨ë“  ê´€ê³„ì˜ ëŒ€ìƒ)

## Layer ë¶„ë¥˜ ì‹œìŠ¤í…œ

### Layer ë¶„ë¥˜ ê¸°ì¤€

ì‹œìŠ¤í…œì˜ ì•„í‚¤í…ì²˜ë¥¼ ëª…í™•íˆ íŒŒì•…í•˜ê¸° ìœ„í•´ ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ë ˆì´ì–´ë³„ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤.

#### Layer ë¶„ë¥˜ ë§¤í•‘

| ì»´í¬ë„ŒíŠ¸ íƒ€ì… | Layer | ì„¤ëª… | ì˜ˆì‹œ |
|---------------|-------|------|------|
| **FRONTEND** | FRONTEND | í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ | JSP, JSX, Vue íŒŒì¼ |
| **API_URL** | API_ENTRY | API ì—”ë“œí¬ì¸íŠ¸ | /api/users:GET, /api/orders:POST |
| **METHOD** | CONTROLLER | HTTP ìš”ì²­ ì²˜ë¦¬ | UserController, OrderServlet |
| **METHOD** | SERVICE | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | UserService, OrderManager |
| **METHOD** | REPOSITORY | ë°ì´í„° ì ‘ê·¼ | UserMapper, OrderDAO |
| **METHOD** | MODEL | ë°ì´í„° ëª¨ë¸ | UserEntity, OrderVO |
| **METHOD** | UTIL | ìœ í‹¸ë¦¬í‹° | DateUtil, StringHelper |
| **SQL_*** | QUERY | SQL ì¿¼ë¦¬ | SQL_SELECT, SQL_INSERT |
| **QUERY** | QUERY | ì¶”ë¡ ëœ ì¿¼ë¦¬ | INFERRED ì¿¼ë¦¬ |
| **TABLE** | TABLE | ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” | USERS, ORDERS |
| **COLUMN** | TABLE | í…Œì´ë¸” ì»¬ëŸ¼ | USER_ID, ORDER_DATE |

#### ë™ì  Layer ë¶„ë¥˜ íŒ¨í„´

METHOD ì»´í¬ë„ŒíŠ¸ëŠ” ë‹¤ìŒ íŒ¨í„´ìœ¼ë¡œ ë™ì  ë¶„ë¥˜ë©ë‹ˆë‹¤:

**CONTROLLER Layer**:
- suffixes: controller, ctrl, servlet
- keywords: controller, servlet, Servlet, @Controller
- folder_patterns: *controller*, *ctrl*, *web*, *api*, *servlet*

**SERVICE Layer**:
- suffixes: service, svc, manager, facade
- keywords: service, business, logic, manager, facade
- folder_patterns: *service*, *business*, *logic*, *manager*, *facade*

**REPOSITORY Layer**:
- suffixes: dao, repository, repo, mapper
- keywords: dao, repository, mapper, data
- folder_patterns: *dao*, *repository*, *mapper*, *data*

**MODEL Layer**:
- suffixes: entity, model, vo, dto, domain
- keywords: entity, model, vo, dto, domain, bean
- folder_patterns: *model*, *entity*, *vo*, *dto*, *domain*, *bean*, *enums*

**UTIL Layer**:
- suffixes: util, utils, helper, common
- keywords: util, helper, common, tool
- folder_patterns: *util*, *helper*, *common*, *tool*

#### Layer ë¶„ë¥˜ ìš°ì„ ìˆœìœ„

1. **í´ë” êµ¬ì¡° ìš°ì„ **: íŒŒì¼ ê²½ë¡œì˜ í´ë”ëª…ì´ ê°€ì¥ ì •í™•í•œ ë¶„ë¥˜ ê¸°ì¤€
2. **í´ë˜ìŠ¤ëª… í‚¤ì›Œë“œ**: í´ë˜ìŠ¤ëª…ì— í¬í•¨ëœ í‚¤ì›Œë“œë¡œ ë¶„ë¥˜
3. **í´ë˜ìŠ¤ëª… ì ‘ë¯¸ì‚¬**: í´ë˜ìŠ¤ëª… ëì˜ ì ‘ë¯¸ì‚¬ë¡œ ë¶„ë¥˜
4. **ê¸°ë³¸ê°’**: ë¶„ë¥˜ë˜ì§€ ì•Šì€ ê²½ìš° APPLICATION

### Layer ë¶„ë¥˜ êµ¬í˜„ ìƒì„¸

#### ê³µí†µ í•¨ìˆ˜: LayerClassificationUtils

Layer ë¶„ë¥˜ ë¡œì§ì€ `util/layer_classification_utils.py`ì˜ `LayerClassificationUtils` í´ë˜ìŠ¤ì—ì„œ ì¤‘ì•™ ê´€ë¦¬ë©ë‹ˆë‹¤.

**ì£¼ìš” ë©”ì„œë“œ**:
- `get_component_layer()`: ì»´í¬ë„ŒíŠ¸ íƒ€ì…ê³¼ íŒ¨í„´ì„ ê¸°ë°˜ìœ¼ë¡œ ë ˆì´ì–´ ê²°ì •
- `classify_component_by_patterns()`: íŒ¨í„´ ë§¤ì¹­ì„ í†µí•œ ë™ì  ë¶„ë¥˜
- `get_layer_classification_patterns()`: ì„¤ì • íŒŒì¼ì—ì„œ ë¶„ë¥˜ íŒ¨í„´ ë¡œë“œ

#### ì»´í¬ë„ŒíŠ¸ë³„ Layer ì„¤ì • ì§€ì 

**1. METHOD/CLASS ì»´í¬ë„ŒíŠ¸** (`java_loading.py`):
```python
# Layer ë¶„ë¥˜ë¥¼ ìœ„í•œ íŒŒì¼ ì •ë³´ ì¡°íšŒ
file_path, file_name = self._get_file_info_for_layer_classification(project_id, file_id)

# Layer ë¶„ë¥˜ ìˆ˜í–‰ (ê³µí†µí•¨ìˆ˜ ì‚¬ìš©)
layer = self.layer_classifier.get_component_layer(
    component_type='METHOD',
    component_name=method_name,
    file_path=file_path,
    file_name=file_name
)
```

**2. SQL_* ì»´í¬ë„ŒíŠ¸** (`xml_loading.py`):
```python
component_data = {
    'layer': 'QUERY',  # SQL ì»´í¬ë„ŒíŠ¸ëŠ” QUERY layer
    # ... ê¸°íƒ€ í•„ë“œ
}
```

**3. API_URL ì»´í¬ë„ŒíŠ¸** (`backend_entry_loading.py`):
```python
component_data = {
    'layer': 'API_ENTRY',  # API_URLì€ API_ENTRY layer
    # ... ê¸°íƒ€ í•„ë“œ
}
```

**4. TABLE/COLUMN ì»´í¬ë„ŒíŠ¸** (`file_loading.py`):
```python
component_data = {
    'layer': 'TABLE',  # TABLE/COLUMNì€ TABLE layer
    # ... ê¸°íƒ€ í•„ë“œ
}
```

#### ì„¤ì • íŒŒì¼: java_keyword.yaml

Layer ë¶„ë¥˜ íŒ¨í„´ì€ `config/parser/java_keyword.yaml`ì˜ `layer_classification` ì„¹ì…˜ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤:

```yaml
layer_classification:
  controller:
    suffixes: ["controller", "ctrl", "servlet"]
    keywords: ["controller", "servlet", "Servlet", "@Controller"]
    folder_patterns: ["*controller*", "*ctrl*", "*web*", "*api*", "*servlet*"]
  service:
    suffixes: ["service", "svc", "manager", "facade"]
    keywords: ["service", "business", "logic", "manager", "facade"]
    folder_patterns: ["*service*", "*business*", "*logic*", "*manager*", "*facade*"]
  # ... ê¸°íƒ€ ë ˆì´ì–´ íŒ¨í„´
```

#### Layer ë¶„ë¥˜ ì¥ì 

1. **ì•„í‚¤í…ì²˜ ëª…í™•í™”**: ê° ì»´í¬ë„ŒíŠ¸ì˜ ì—­í• ê³¼ ìœ„ì¹˜ë¥¼ ëª…í™•íˆ êµ¬ë¶„
2. **ì‹œê°ì  í‘œí˜„**: ë ˆì´ì–´ë³„ ìƒ‰ìƒ êµ¬ë¶„ìœ¼ë¡œ ë¦¬í¬íŠ¸ ê°€ë…ì„± í–¥ìƒ
3. **ê´€ê³„ ë¶„ì„**: ë ˆì´ì–´ê°„ í˜¸ì¶œ ê´€ê³„ë¥¼ í†µí•œ ì•„í‚¤í…ì²˜ íŒ¨í„´ ë¶„ì„
4. **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë ˆì´ì–´ íŒ¨í„´ì„ ì„¤ì • íŒŒì¼ì—ì„œ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
5. **ì¼ê´€ì„±**: ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ë™ì¼í•œ ë¶„ë¥˜ ê¸°ì¤€ ì ìš©

#### Layer ë¶„ë¥˜ ì²˜ë¦¬ í”Œë¡œìš°

```mermaid
flowchart TD
    A[ì»´í¬ë„ŒíŠ¸ ìƒì„±] --> B{ì»´í¬ë„ŒíŠ¸ íƒ€ì…}
    
    B -->|METHOD/CLASS| C[íŒŒì¼ ì •ë³´ ì¡°íšŒ]
    C --> D[LayerClassificationUtils í˜¸ì¶œ]
    D --> E[íŒ¨í„´ ë§¤ì¹­ ìˆ˜í–‰]
    E --> F{ë§¤ì¹­ ê²°ê³¼}
    F -->|ë§¤ì¹­ë¨| G[ë¶„ë¥˜ëœ Layer ì„¤ì •]
    F -->|ë§¤ì¹­ ì•ˆë¨| H[APPLICATION Layer]
    
    B -->|SQL_*| I[QUERY Layer]
    B -->|API_URL| J[API_ENTRY Layer]
    B -->|TABLE/COLUMN| K[TABLE Layer]
    
    G --> L[components í…Œì´ë¸” ì €ì¥]
    H --> L
    I --> L
    J --> L
    K --> L
    
    style A fill:#e3f2fd
    style D fill:#fff3e0
    style E fill:#ffcc80
    style L fill:#e8f5e8
```

## ë‹¨ìˆœí™”ëœ API í˜¸ì¶œ êµ¬ì¡°

### API_URL ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜¸ì¶œí•˜ëŠ” API ì •ë³´ë¥¼ components í…Œì´ë¸”ì— í†µí•©í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| component_type | API_URL | API_URL |
| component_name | API URLê³¼ HTTP ë©”ì„œë“œ ì¡°í•© | /api/user-profile:GET |
| file_id | í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ ID (JSP/JSX) | 201 (JSP íŒŒì¼ ID) |
| layer | API_ENTRY | API ì—”ë“œí¬ì¸íŠ¸ ë ˆì´ì–´ |

**í•µì‹¬ ê°œë…**:
- **í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ = ë°±ì—”ë“œ API ì§„ì…ì **: ë™ì¼í•œ URLì´ë¯€ë¡œ ì¤‘ë³µ ì €ì¥ ë¶ˆí•„ìš”
- **file_idë¡œ í”„ë¡ íŠ¸ íŒŒì¼ ì—°ê²°**: JSP/JSX íŒŒì¼ì—ì„œ í˜¸ì¶œí•˜ëŠ” APIì„ì„ ëª…ì‹œ
- **component_nameì— ëª¨ë“  ì •ë³´ í¬í•¨**: URL:HTTP_METHOD í˜•íƒœë¡œ ê³ ìœ  ì‹ë³„
- **layerë¡œ ì•„í‚¤í…ì²˜ êµ¬ë¶„**: API_ENTRY ë ˆì´ì–´ë¡œ ëª…í™•í•œ ì—­í•  ì •ì˜

### API í˜¸ì¶œ êµ¬ì¡° ë‹¤ì´ì–´ê·¸ë¨ (Layer í¬í•¨)

```mermaid
graph TD
    A[JSP/JSX íŒŒì¼<br/>FRONTEND Layer] --> B[API_URL ì»´í¬ë„ŒíŠ¸<br/>API_ENTRY Layer]
    B --> C[Controller METHOD<br/>CONTROLLER Layer]
    C --> D[Service METHOD<br/>SERVICE Layer]
    D --> E[Repository METHOD<br/>REPOSITORY Layer]
    E --> F[SQL_* ì»´í¬ë„ŒíŠ¸<br/>QUERY Layer]
    F --> G[TABLE ì»´í¬ë„ŒíŠ¸<br/>TABLE Layer]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#ffcc80
    style F fill:#ffcdd2
    style G fill:#f5f5f5
```

**Layerë³„ í˜¸ì¶œ ì²´ì¸ ì„¤ëª…**:
1. **FRONTEND Layer**: JSP/JSX/Vue í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼
2. **API_ENTRY Layer**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜¸ì¶œí•˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸ (/api/user-profile:GET)
3. **CONTROLLER Layer**: HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ
4. **SERVICE Layer**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ ë©”ì„œë“œ
5. **REPOSITORY Layer**: ë°ì´í„° ì ‘ê·¼ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” DAO/Mapper ë©”ì„œë“œ
6. **QUERY Layer**: ì‹¤ì œ SQL ì¿¼ë¦¬ (SQL_SELECT, SQL_INSERT ë“±)
7. **TABLE Layer**: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ë° ì»¬ëŸ¼

### ê´€ê³„ íƒ€ì… (6ê°€ì§€ í•µì‹¬ ê´€ê³„)

#### 1. ë©”ì„œë“œ í˜¸ì¶œ ê´€ê³„
- **CALL_METHOD**: ì»´í¬ë„ŒíŠ¸ì—ì„œ ë©”ì„œë“œë¡œì˜ í˜¸ì¶œ
  - ì‚¬ìš©: src_id = í˜¸ì¶œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸, dst_id = í˜¸ì¶œë°›ëŠ” METHOD
  - ì˜ˆì‹œ: API_URL â†’ METHOD, METHOD â†’ METHOD (Controller â†’ Service â†’ DAO)
  - êµ¬ë¶„: src_idì˜ component_typeìœ¼ë¡œ í˜¸ì¶œ ìœ í˜• íŒë‹¨

#### 2. ì¿¼ë¦¬ í˜¸ì¶œ ê´€ê³„
- **CALL_QUERY**: ë©”ì„œë“œì—ì„œ SQL ì¿¼ë¦¬ë¡œì˜ í˜¸ì¶œ
  - ì‚¬ìš©: src_id = METHOD ì»´í¬ë„ŒíŠ¸, dst_id = SQL_* ë˜ëŠ” QUERY ì»´í¬ë„ŒíŠ¸
  - ì˜ˆì‹œ: DAO ë©”ì„œë“œì—ì„œ SQL ì¿¼ë¦¬ í˜¸ì¶œ

#### 3. í…Œì´ë¸” ì‚¬ìš© ê´€ê³„
- **USE_TABLE**: SQL ì¿¼ë¦¬ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì‚¬ìš©
  - ì‚¬ìš©: src_id = SQL_* ë˜ëŠ” QUERY ì»´í¬ë„ŒíŠ¸, dst_id = TABLE ì»´í¬ë„ŒíŠ¸
  - ì˜ˆì‹œ: SELECT ì¿¼ë¦¬ì—ì„œ USERS í…Œì´ë¸” ì‚¬ìš©

#### 4. ìƒì† ê´€ê³„
- **INHERITANCE**: í´ë˜ìŠ¤ ìƒì† ê´€ê³„
  - ì‚¬ìš©: src_id = ìì‹ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸, dst_id = ë¶€ëª¨ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸
  - ì˜ˆì‹œ: UserController extends BaseController

#### 5. ëª…ì‹œì  ì¡°ì¸ ê´€ê³„
- **JOIN_EXPLICIT**: ëª…ì‹œì  ì¡°ì¸ ê´€ê³„
  - ì‚¬ìš©: src_id = SQL ì¿¼ë¦¬ ì»´í¬ë„ŒíŠ¸, dst_id = ì¡°ì¸ë˜ëŠ” í…Œì´ë¸” ì»´í¬ë„ŒíŠ¸
  - ì˜ˆì‹œ: SELECT * FROM A JOIN B ON A.id = B.id

#### 6. ì•”ì‹œì  ì¡°ì¸ ê´€ê³„
- **JOIN_IMPLICIT**: ì•”ì‹œì  ì¡°ì¸ ê´€ê³„
  - ì‚¬ìš©: src_id = SQL ì¿¼ë¦¬ ì»´í¬ë„ŒíŠ¸, dst_id = ì¡°ì¸ë˜ëŠ” í…Œì´ë¸” ì»´í¬ë„ŒíŠ¸
  - ì˜ˆì‹œ: SELECT * FROM A, B WHERE A.id = B.id

**ì™„ì „í•œ í˜¸ì¶œ ì²´ì¸ ì˜ˆì‹œ**:
```
JSP íŒŒì¼ (file_id) 
    â†“
API_URL (/api/user-profile:GET)
    â†“ CALL_METHOD
METHOD (getUserProfile)
    â†“ CALL_METHOD
METHOD (UserService.getUser)
    â†“ CALL_METHOD
METHOD (UserDAO.findById)
    â†“ CALL_QUERY
SQL_SELECT (SELECT * FROM users WHERE id = ?)
    â†“ USE_TABLE
TABLE (USERS)
```

**CallChain Report ì¿¼ë¦¬ êµ¬ì¡°**:
```sql
SELECT 
    ROW_NUMBER() OVER (ORDER BY jsp_file.file_name, api_url.component_name) as chain_id,
    jsp_file.file_name as jsp_file,
    api_url.component_name as api_url,
    class.class_name as class_name,
    method.component_name as method_name,
    xml_file.file_name as xml_file,
    sql.component_name as sql_name,
    sql.component_type as sql_type,
    GROUP_CONCAT(DISTINCT table.table_name) as related_tables
FROM files jsp_file
JOIN components api_url ON jsp_file.file_id = api_url.file_id
JOIN relationships r1 ON api_url.component_id = r1.src_id
JOIN components method ON r1.dst_id = method.component_id
JOIN classes class ON method.parent_id = class.class_id
JOIN relationships r2 ON method.component_id = r2.src_id
JOIN components sql ON r2.dst_id = sql.component_id
JOIN files xml_file ON sql.file_id = xml_file.file_id
LEFT JOIN relationships r3 ON sql.component_id = r3.src_id
LEFT JOIN tables table ON r3.dst_id = table.component_id
WHERE api_url.component_type = 'API_URL'
  AND r1.rel_type = 'CALL_METHOD'
  AND method.component_type = 'METHOD'
  AND r2.rel_type = 'CALL_QUERY'
  AND sql.component_type LIKE 'SQL_%'
  AND (r3.rel_type = 'USE_TABLE' OR r3.rel_type IS NULL)
GROUP BY jsp_file.file_name, api_url.component_name, class.class_name, 
         method.component_name, xml_file.file_name, sql.component_name, sql.component_type
```

**CallChain Report ê²°ê³¼ ì˜ˆì‹œ**:
| chain_id | jsp_file | api_url | class_name | method_name | xml_file | sql_name | sql_type | related_tables |
|----------|----------|---------|------------|-------------|----------|----------|----------|----------------|
| 1 | MicroserviceDashboard.jsp | /api/user-profile:GET | MicroserviceController | getUserProfile | UserMapper.xml | getUserById | SQL_SELECT | USERS, USER_PROFILES |
| 2 | UserList.jsp | /api/users:GET | UserController | getUsers | UserMapper.xml | getAllUsers | SQL_SELECT | USERS |

**ëª¨ë“  ê´€ê³„ íƒ€ì… ìš”ì•½**:
- **CALL_METHOD**: ë©”ì„œë“œ í˜¸ì¶œ ê´€ê³„ (API_URL â†’ METHOD, METHOD â†’ METHOD)
- **CALL_QUERY**: ì¿¼ë¦¬ í˜¸ì¶œ ê´€ê³„ (METHOD â†’ SQL_*/QUERY)
- **USE_TABLE**: í…Œì´ë¸” ì‚¬ìš© ê´€ê³„ (SQL_*/QUERY â†’ TABLE)
- **INHERITANCE**: í´ë˜ìŠ¤ ìƒì† ê´€ê³„ (ìì‹ í´ë˜ìŠ¤ â†’ ë¶€ëª¨ í´ë˜ìŠ¤)
- **JOIN_EXPLICIT**: ëª…ì‹œì  ì¡°ì¸ ê´€ê³„ (SQL â†’ ì¡°ì¸ í…Œì´ë¸”)
- **JOIN_IMPLICIT**: ì•”ì‹œì  ì¡°ì¸ ê´€ê³„ (SQL â†’ ì¡°ì¸ í…Œì´ë¸”)

### ë°ì´í„° ì˜ˆì‹œ

```sql
-- API_URL ì»´í¬ë„ŒíŠ¸ë“¤
INSERT INTO components VALUES 
(1001, 1, 201, '/api/user-profile:GET', 'API_URL', NULL, 'FRONTEND', 74, 85, 'N', NULL, 'hash123', '2024-01-01', '2024-01-01', 'N'),
(1002, 1, 201, '/api/order-details:GET', 'API_URL', NULL, 'FRONTEND', 98, 109, 'N', NULL, 'hash456', '2024-01-01', '2024-01-01', 'N');

-- API í˜¸ì¶œ ê´€ê³„
INSERT INTO relationships VALUES 
(1001, 2001, 'CALL_METHOD', 1.0, 'N', NULL, 'hash_rel1', '2024-01-01', '2024-01-01', 'N'),  -- API_URL â†’ METHOD
(1002, 2002, 'CALL_METHOD', 1.0, 'N', NULL, 'hash_rel2', '2024-01-01', '2024-01-01', 'N');  -- API_URL â†’ METHOD
```

**ì‹¤ì œ ë°ì´í„° êµ¬ì¡°**:
- **file_id: 201**: JSP íŒŒì¼ ID (í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼)
- **component_name**: '/api/user-profile:GET' (URL:HTTP_METHOD í˜•íƒœ)
- **component_type**: 'API_URL' (í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ)
- **rel_type**: 'CALL_METHOD' (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°±ì—”ë“œë¡œì˜ í˜¸ì¶œ)

## ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. ë‹¨ìˆœí™”ëœ êµ¬ì¡°
- **ì¤‘ë³µ ì œê±°**: í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ = ë°±ì—”ë“œ API ì§„ì…ì  (ë™ì¼í•œ URL)
- **ë‹¨ì¼ ì»´í¬ë„ŒíŠ¸**: API_URL í•˜ë‚˜ë¡œ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì—°ê²°
- **ëª…í™•í•œ ì—°ê²°**: file_idë¡œ í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ê³¼ API_URL ì—°ê²°

### 2. 6ê°€ì§€ í•µì‹¬ ê´€ê³„
- **CALL_METHOD**: ì»´í¬ë„ŒíŠ¸ â†’ METHOD (API_URL â†’ METHOD, METHOD â†’ METHOD)
- **CALL_QUERY**: METHOD â†’ SQL (ë©”ì„œë“œ â†’ ì¿¼ë¦¬)
- **USE_TABLE**: SQL â†’ TABLE (ì¿¼ë¦¬ â†’ í…Œì´ë¸”)
- **INHERITANCE**: í´ë˜ìŠ¤ ìƒì† ê´€ê³„
- **JOIN_EXPLICIT**: ëª…ì‹œì  ì¡°ì¸ ê´€ê³„
- **JOIN_IMPLICIT**: ì•”ì‹œì  ì¡°ì¸ ê´€ê³„

### 3. ì§ê´€ì ì¸ í˜¸ì¶œ ì²´ì¸
```
JSP íŒŒì¼ â†’ API_URL â†’ METHOD â†’ SQL â†’ TABLE
```

### 4. í™•ì¥ì„±
- **ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ íƒ€ì…**: components í…Œì´ë¸”ì— ìƒˆë¡œìš´ component_type ì¶”ê°€ ê°€ëŠ¥
- **ìœ ì—°í•œ ê´€ê³„**: relationships í…Œì´ë¸”ì—ì„œ ë‹¤ì–‘í•œ ê´€ê³„ íƒ€ì… ì§€ì›

## ì„±ëŠ¥ ìµœì í™” íŠ¹ì§•

1. **ë³€ê²½ ê°ì§€**: ëª¨ë“  í…Œì´ë¸”ì— hash_value ì»¬ëŸ¼ìœ¼ë¡œ ë³€ê²½ ê°ì§€
2. **ì†Œí”„íŠ¸ ì‚­ì œ**: del_yn ì»¬ëŸ¼ìœ¼ë¡œ ë…¼ë¦¬ì  ì‚­ì œ ì§€ì›
3. **ì˜¤ë¥˜ ì¶”ì **: has_error, error_messageë¡œ ì˜¤ë¥˜ ìƒíƒœ ê´€ë¦¬
4. **ì¸ë±ìŠ¤ ìµœì í™”**: ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ ì¡°í•©ì— ì¸ë±ìŠ¤ ìƒì„±
5. **ì¤‘ë³µ ë°©ì§€**: UNIQUE ì¸ë±ìŠ¤ë¡œ ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥

## ì‚¬ìš© ê°€ì´ë“œ

### ë°ì´í„° ì‚½ì… ìˆœì„œ
1. projects â†’ files â†’ components
2. tables (components ê¸°ë°˜)
3. columns (tables ê¸°ë°˜)
4. relationships (components ê¸°ë°˜)

### ì¡°íšŒ íŒ¨í„´
- **í”„ë¡œì íŠ¸ë³„ ë¶„ì„**: projects â†’ files â†’ components
- **íŒŒì¼ë³„ ë¶„ì„**: files â†’ components
- **API í˜¸ì¶œ ë¶„ì„**: components (component_type = 'API_URL')
- **í…Œì´ë¸”ë³„ ë¶„ì„**: tables â†’ columns
- **ì»´í¬ë„ŒíŠ¸ ê´€ê³„ ë¶„ì„**: relationships

ì´ ìŠ¤í‚¤ë§ˆëŠ” SourceAnalyzer ì‹œìŠ¤í…œì˜ í•µì‹¬ ë°ì´í„° êµ¬ì¡°ë¥¼ ì •ì˜í•˜ë©°, í”„ë¡œì íŠ¸ ë¶„ì„ ê²°ê³¼ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ—„ï¸ SqlContent.db (ë³„ë„ ë°ì´í„°ë² ì´ìŠ¤) - v4.0 ì‹ ê·œ ì¶”ê°€

### ê°œìš”

SQL ì¿¼ë¦¬ ë‚´ìš©ì„ gzip ì••ì¶•í•˜ì—¬ ë³„ë„ë¡œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì…ë‹ˆë‹¤.

- **ìœ„ì¹˜**: `./projects/{project_name}/SqlContent.db`
- **ëª©ì **: SQL ë‚´ìš© ì••ì¶• ì €ì¥ìœ¼ë¡œ ë©”íƒ€DB í¬ê¸° ìµœì í™”
- **ì••ì¶• ë°©ì‹**: gzip ì••ì¶• (BLOB í˜•íƒœ)
- **ì§€ì› ë²”ìœ„**: XML íŒŒì‹± ì¿¼ë¦¬ + Java StringBuilder ì¿¼ë¦¬

### ERD (SqlContent.db)

```mermaid
erDiagram
    projects {
        int project_id
        string project_name
        string project_path
        string created_at
        string updated_at
        string del_yn
    }

    sql_contents {
        int content_id
        int project_id
        int file_id
        int component_id
        string component_name
        blob sql_content_compressed
        string query_type
        string file_path
        string file_name
        int line_start
        int line_end
        string hash_value
        string error_message
        string created_at
        string updated_at
        string del_yn
    }

    projects ||--o{ sql_contents : "contains"
```

### sql_contents í…Œì´ë¸” ìƒì„¸

SQL ì¿¼ë¦¬ ë‚´ìš©ì„ ì••ì¶•í•˜ì—¬ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… | ë°ì´í„°íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|--------|------------|----------|------|
| content_id | INTEGER | PRIMARY KEY, AUTOINCREMENT | SQL ë‚´ìš© ê³ ìœ  ID |
| project_id | INTEGER | NOT NULL, FK | í”„ë¡œì íŠ¸ ID |
| file_id | INTEGER | | íŒŒì¼ ID (XML/Java íŒŒì¼) |
| component_id | INTEGER | | ì»´í¬ë„ŒíŠ¸ ID (SQL_* íƒ€ì…) |
| component_name | VARCHAR(200) | | ì»´í¬ë„ŒíŠ¸ëª… (ì¿¼ë¦¬ ID) |
| sql_content_compressed | BLOB | NOT NULL | **gzip ì••ì¶•ëœ SQL ë‚´ìš©** |
| query_type | VARCHAR(20) | NOT NULL | ì¿¼ë¦¬ íƒ€ì… (SQL_SELECT, SQL_INSERT, SQL_UPDATE, SQL_DELETE, QUERY) |
| file_path | VARCHAR(500) | | íŒŒì¼ ê²½ë¡œ (XML/Java) |
| file_name | VARCHAR(200) | | íŒŒì¼ëª… |
| line_start | INTEGER | | ì‹œì‘ ë¼ì¸ (XML=1, Java=ì‹¤ì œ ë¼ì¸) |
| line_end | INTEGER | | ì¢…ë£Œ ë¼ì¸ (XML=1, Java=ì‹¤ì œ ë¼ì¸) |
| hash_value | VARCHAR(64) | | SQL ë‚´ìš© í•´ì‹œê°’ |
| error_message | TEXT | | ì˜¤ë¥˜ ë©”ì‹œì§€ |
| created_at | DATETIME | DEFAULT (datetime('now', '+9 hours')) | ìƒì„±ì¼ì‹œ |
| updated_at | DATETIME | DEFAULT (datetime('now', '+9 hours')) | ìˆ˜ì •ì¼ì‹œ |
| del_yn | CHAR(1) | DEFAULT 'N' | ì‚­ì œ ì—¬ë¶€ (Y/N) |

**ì™¸ë˜í‚¤ ê´€ê³„:**
- `project_id` â†’ `projects.project_id`

### ì••ì¶• ì €ì¥ ë°©ì‹

```python
# ì••ì¶• ì €ì¥
import gzip
compressed_content = gzip.compress(sql_content.encode('utf-8'))

# ì••ì¶• í•´ì œ
decompressed_content = gzip.decompress(compressed_content).decode('utf-8')
```

---

## INFERRED ì¿¼ë¦¬ ì²˜ë¦¬ ê°œì„  ë°©ì•ˆ

### ë¬¸ì œì  ë° í•´ê²°ì±…

**ë°œê²¬ëœ ë¬¸ì œ**:
- Java íŒŒì„œê°€ `component_type = 'QUERY'`ë¡œë§Œ ê²€ìƒ‰í•˜ì—¬ XMLì—ì„œ ìƒì„±ëœ `SQL_*` íƒ€ì…ì„ ì°¾ì§€ ëª»í•¨
- ê²°ê³¼ì ìœ¼ë¡œ ëª¨ë“  ì¿¼ë¦¬ë¥¼ inferred queryë¡œ ì¤‘ë³µ ìƒì„±í•˜ì—¬ ë°ì´í„° ì¤‘ë³µ ë°œìƒ

**í•´ê²° ë°©ì•ˆ**:
1. **ì¿¼ë¦¬ ê²€ìƒ‰ ë¡œì§ ê°œì„ **: `SQL_*` íƒ€ì…ê³¼ `QUERY` íƒ€ì… ëª¨ë‘ ê²€ìƒ‰
2. **INFERRED ì¿¼ë¦¬ ì •ë³´ ë³´ê°•**: ìë°” í˜¸ì¶œ ìœ„ì¹˜ ì •ë³´ì™€ SQL ë‚´ìš© ì €ì¥
3. **í…Œì´ë¸” ê´€ê³„ ì—°ê²° ê°œì„ **: `SQL_*` íƒ€ì…ê³¼ `QUERY` íƒ€ì… ëª¨ë‘ ì²˜ë¦¬

### components í…Œì´ë¸” í™œìš©

**ì¿¼ë¦¬ ì»´í¬ë„ŒíŠ¸ íƒ€ì… (v4.0 ê°œì„ )**:
- `SQL_SELECT`: **XML/Java ëª¨ë‘ì—ì„œ** íŒŒì‹±ëœ SELECT ì¿¼ë¦¬
- `SQL_INSERT`: **XML/Java ëª¨ë‘ì—ì„œ** íŒŒì‹±ëœ INSERT ì¿¼ë¦¬  
- `SQL_UPDATE`: **XML/Java ëª¨ë‘ì—ì„œ** íŒŒì‹±ëœ UPDATE ì¿¼ë¦¬
- `SQL_DELETE`: **XML/Java ëª¨ë‘ì—ì„œ** íŒŒì‹±ëœ DELETE ì¿¼ë¦¬
- `QUERY`: Javaì—ì„œ ì¶”ë¡ ëœ INFERRED ì¿¼ë¦¬ (ì •í™•í•œ SQL íƒ€ì…ì„ ëª¨ë¦„)

**INFERRED ì¿¼ë¦¬ íŠ¹ì§•**:
- `component_type = 'QUERY'` (ì •í™•í•œ SQL íƒ€ì…ì„ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸)
- `line_start`, `line_end`: ìë°”ì—ì„œ ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹¤ì œ ë¼ì¸ ë²ˆí˜¸
- `file_id`: ìë°” íŒŒì¼ì˜ file_id (XML íŒŒì¼ì´ ì•„ë‹Œ ì‹¤ì œ í˜¸ì¶œ íŒŒì¼)

### sql_contents í…Œì´ë¸” í™œìš©

### Java SQL ì²˜ë¦¬ ê¸°ëŠ¥ (v4.0 ì‹ ê·œ)

**Javaì—ì„œ ì§€ì›í•˜ëŠ” SQL íŒ¨í„´**:
- âœ… **StringBuilder íŒ¨í„´**: `StringBuilder query = new StringBuilder(); query.append("SELECT ...")`
- âŒ **+ ì—°ì‚°ì íŒ¨í„´**: `String query = "SELECT " + "FROM users"` (ë¯¸ì§€ì›)
- âŒ **String.format íŒ¨í„´**: `String.format("SELECT * FROM %s", tableName)` (ë¯¸ì§€ì›)

**Java SQL ì»´í¬ë„ŒíŠ¸ íƒ€ì…**:
- âœ… **SQL_SELECT**: SELECT ì¿¼ë¦¬ (StringBuilderì—ì„œ ì¶”ì¶œ)
- âœ… **SQL_INSERT**: INSERT ì¿¼ë¦¬ (StringBuilderì—ì„œ ì¶”ì¶œ)  
- âœ… **SQL_UPDATE**: UPDATE ì¿¼ë¦¬ (StringBuilderì—ì„œ ì¶”ì¶œ)
- âœ… **SQL_DELETE**: DELETE ì¿¼ë¦¬ (StringBuilderì—ì„œ ì¶”ì¶œ)
- âŒ **SQL_MERGE**: MERGE ì¿¼ë¦¬ (ì•„ì§ ë¯¸ì§€ì›)

**ì••ì¶• ì €ì¥ ì²˜ë¦¬**:
- `SqlContentProcessor`ë¥¼ í†µí•œ gzip ì••ì¶• ì €ì¥
- `SqlContent.db`ì— ë³„ë„ ê´€ë¦¬
- XMLê³¼ Java ëª¨ë‘ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬

### sql_contents í…Œì´ë¸” í™œìš©

**XML/Java ê³µí†µ SQL ë‚´ìš© ì €ì¥**:
- `component_id`: SQL ì»´í¬ë„ŒíŠ¸ì˜ component_id
- `sql_content_compressed`: gzip ì••ì¶•ëœ SQL ë‚´ìš© (XML íŒŒì‹± ê²°ê³¼ ë˜ëŠ” Java StringBuilder ì¶”ì¶œ ê²°ê³¼)
- `query_type`: ì •í™•í•œ SQL íƒ€ì… (SQL_SELECT, SQL_INSERT, SQL_UPDATE, SQL_DELETE)
- `file_path`: ì›ë³¸ íŒŒì¼ ê²½ë¡œ (XML ë˜ëŠ” Java)
- `line_start/line_end`: ì‹¤ì œ ë¼ì¸ ë²ˆí˜¸ (Javaì˜ ê²½ìš° StringBuilder ìœ„ì¹˜)
- `START_LINE`, `END_LINE`: ìë°” íŒŒì¼ì—ì„œ SQLì´ í¬í•¨ëœ ë¼ì¸ ë²”ìœ„

### relationships í…Œì´ë¸” í™œìš©

**CALL_QUERY ê´€ê³„**:
- `src_id`: Java METHODì˜ component_id
- `dst_id`: SQL ì¿¼ë¦¬ì˜ component_id (SQL_* ë˜ëŠ” QUERY íƒ€ì…)
- `rel_type = 'CALL_QUERY'`

**USE_TABLE ê´€ê³„**:
- `src_id`: SQL ì¿¼ë¦¬ì˜ component_id (SQL_* ë˜ëŠ” QUERY íƒ€ì… ëª¨ë‘ ì²˜ë¦¬)
- `dst_id`: TABLEì˜ component_id
- `rel_type = 'USE_TABLE'`

### ê°œì„  íš¨ê³¼

1. **ì¤‘ë³µ ë°©ì§€**: XMLì—ì„œ ìƒì„±ëœ `SQL_*` íƒ€ì…ì„ ì •ìƒì ìœ¼ë¡œ í™œìš©
2. **ì •í™•í•œ ì¶”ì **: ëŠì–´ì§„ ì¿¼ë¦¬ì˜ ì •í™•í•œ ìë°” í˜¸ì¶œ ìœ„ì¹˜ íŒŒì•…
3. **ê°œë°œ íš¨ìœ¨ì„±**: ëˆ„ë½ëœ XML ì¿¼ë¦¬ ì •ì˜ë¥¼ ì‰½ê²Œ ì°¾ì•„ ìˆ˜ì • ê°€ëŠ¥
4. **ë¬¸ì„œí™”**: ìë™ìœ¼ë¡œ ì¿¼ë¦¬ í˜¸ì¶œ ê´€ê³„ ë¬¸ì„œí™”
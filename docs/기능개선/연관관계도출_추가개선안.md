# 연관관계 도출 집중 - 추가 개선 제안

## 1. 🎯 핵심 철학 및 접근 방식 강화

제공해주신 개선안의 방향성에 깊이 공감하며, "완벽한 파싱보다 연결고리 찾기"라는 핵심 철학을 더욱 강화하기 위한 접근 방식을 제안합니다.

### 1.1. 점진적 상세화와 **양방향 분석 (Bidirectional Analysis)**

- **단방향의 한계**: 현재 `프론트 → DB` 방향으로만 분석하면, 중간에 고리가 끊겼을 때 전체 체인을 놓치게 됩니다.
- **양방향 분석 도입**: `DB → 프론트` 방향으로의 역추적 분석을 병행합니다.
    - **(예시)** `USER` 테이블을 사용하는 `QUERY`를 찾고, 해당 `QUERY`를 호출하는 `XML`과 `METHOD`를 역으로 찾아냅니다.
- **교차 검증**: 양방향 분석 결과를 교차 검증하여, 양쪽에서 모두 발견된 연결은 신뢰도를 대폭 상향하고, 한쪽에서만 발견된 연결은 "검토 필요" 항목으로 분류합니다.

### 1.2. **규칙(Rule)과 추론(Inference)의 조화**

정교한 파서 대신, 가볍고 빠른 **규칙 기반의 패턴 매칭**과 **추론**을 적극적으로 활용하고, 각 연결의 신뢰도를 명확히 구분합니다.

- **신뢰도 등급화**: 모든 연관관계를 3가지 등급으로 분류하고 신뢰도 점수를 차등 부여합니다.
    - **🥇 명시적 연결 (Confidence: 0.9 ~ 1.0)**: 어노테이션(`@RequestMapping`, `@Table`), XML 설정 등 코드에 명시된 가장 확실한 연결.
    - **🥈 관례적 연결 (Confidence: 0.7 ~ 0.8)**: `UserMapper.java` → `UserMapper.xml`처럼, 프레임워크나 프로젝트의 일반적인 명명 규칙에 기반한 연결.
    - **🥉 추론적 연결 (Confidence: 0.4 ~ 0.6)**: 메소드명(`findUserById`)과 쿼리 ID(`findUser`)의 유사성, 혹은 코드 내 문자열 리터럴(`"SELECT * FROM USER"`)을 직접 분석하는 등, 추론에 기반한 연결.

### 1.3. **불확실성의 시각화 (Visualization of Uncertainty)**

분석 리포트(다이어그램)에서 신뢰도 수준을 직관적으로 보여줍니다.

- **실선 (Solid Line)**: 명시적 연결 (신뢰도 높음)
- **파선 (Dashed Line)**: 관례적 연결 (신뢰도 중간)
- **점선 (Dotted Line)**: 추론적 연결 (신뢰도 낮음, 검토 필요)

이를 통해 사용자는 어떤 연결고리가 확실하고 어떤 부분을 더 주의 깊게 봐야 하는지 즉시 파악할 수 있습니다.

## 2. 🔧 기존 개선안에 대한 추가/보완 제안

기존에 제안된 5가지 우선순위별 개선 방안에 아래 아이디어를 추가하여 완성도를 높일 수 있습니다.

### **[1순위 보완] API_URL → METHOD 매핑**

- **서버 설정 파일 분석**: `web.xml`의 `<servlet-mapping>`이나 Spring의 `WebMvcConfigurer` 등에서 정의된 전역 라우팅 규칙을 분석하여 매핑 정확도를 높입니다.

### **[3순위 보완] JPA Entity / Java → TABLE 매핑**

- **문자열 리터럴 기반 SQL 분석**: `em.createQuery("SELECT u FROM User u")` 와 같이 Java 코드 내에 하드코딩된 JPQL/SQL 문자열을 직접 분석하여 테이블 및 컬럼 정보를 추출합니다. 이는 동적 쿼리 분석의 초기 단계가 될 수 있습니다.
- **동적 SQL 처리 방안**: MyBatis의 `<if>`, `<foreach>` 등 동적 SQL 내에 등장하는 **모든 테이블과 컬럼을 일단 모두 관계가 있는 것으로 간주**하고, '조건부 관계' 또는 '추론적 연결'로 표시하여 분석에서 누락되지 않도록 합니다.

### **[5순위 보완] 체인 연결 검증 및 신뢰도 점수 시스템**

- **체인 신뢰도 계산 방식**: 전체 체인의 신뢰도는 각 연결고리 신뢰도 점수의 **평균이 아닌 곱셈**으로 계산합니다.
    - `(예시)` `A → B (0.9) → C (0.8) → D (0.5)` 체인의 전체 신뢰도는 `0.9 * 0.8 * 0.5 = 0.36` 입니다.
    - 이는 중간에 약한 고리(낮은 신뢰도)가 하나라도 있으면 전체 체인의 신뢰도가 크게 하락함을 명확히 보여줍니다.

## 3. 🚀 신규 도입 제안

### **6순위: 양방향 분석 및 교차 검증 시스템**

- **DB-First 분석기 구현**: `DB 스키마(TABLE, COLUMN) → QUERY → XML → METHOD → API_URL → 프론트 파일` 순서로 역추적하는 분석기를 구현합니다.
- **교차 검증 로직**: 정방향 분석 결과와 역방향 분석 결과를 비교하여 일치/불일치 리포트를 생성합니다.
    - **(기대효과)** 누락된 연결고리 발견, 데드 코드(DB에는 있으나 아무도 사용하지 않는 쿼리/메소드) 식별에 용이합니다.

### **7순위: 사용자 피드백 루프 및 학습 기능**

- **관계 수정/확정 인터페이스**: 분석 리포트에서 사용자가 잘못된 '추론적 연결'을 끊거나, 끊어진 연결을 수동으로 이어줄 수 있는 기능을 제공합니다.
- **학습 데이터 활용**: 사용자가 확정한(confirmed) 연결 정보를 별도로 저장하고, 다음 분석 시에는 해당 연결에 최고 신뢰도(1.0)를 부여합니다. 이를 통해 분석을 반복할수록 시스템의 정확도가 점진적으로 향상됩니다.

## 4. 📝 결론

제안 드린 내용들은 **"연결고리 도출"** 이라는 핵심 목표에 더욱 집중하기 위한 구체적인 실행 방안입니다.

- **양방향 분석**으로 누락된 고리를 찾고,
- **신뢰도 점수**로 연결의 확실성을 판단하며,
- **사용자 피드백**으로 시스템이 스스로 똑똑해지게 만들 수 있습니다.

이를 통해 SourceAnalyzer는 단순한 코드 분석 도구를 넘어, 개발자가 시스템의 혈관과 같은 연관관계를 직관적으로 이해하고 탐색할 수 있는 강력한 **"시스템 내비게이션"** 으로 발전할 것입니다.

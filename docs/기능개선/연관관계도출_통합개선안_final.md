# 연관관계 도출 통합 개선안 (Final)

## 1. 📋 문서 개요

**목적**: SourceAnalyzer의 핵심 목표인 **연관관계 도출**에 집중하고, 파싱 정확도보다는 **연결고리 추적**에 모든 역량을 집중하기 위한 통합 개선 방안을 제시합니다.

**기존 문제**: 복잡한 파서 구현에 치중하여 핵심 목표인 연관관계 연결고리 도출이 부족했습니다.

**새로운 접근**: "완벽한 파싱보다 연결고리 찾기"를 최우선 철학으로 삼고, **양방향 분석**, **신뢰도 기반 추론**, **사용자 피드백**을 통해 분석의 완성도와 정확도를 점진적으로 향상시킵니다.

## 2. 🎯 핵심 목표 및 철학

### 2.1. 최종 목표: 완전한 연결고리 도출

```
프론트파일(JSP/JSX/Vue) → API_URL → CLASS/METHOD → XML → QUERY → TABLE → Column
```

이 **완전한 연결고리**를 정확하고 신뢰할 수 있게 도출하는 것이 이 개선안의 유일하고 최종적인 목표입니다.

### 2.2. 핵심 접근 철학

#### 1) 점진적 상세화와 **양방향 분석 (Bidirectional Analysis)**
- **단방향의 한계**: `프론트 → DB` 단방향 분석은 중간 고리가 끊기면 전체를 놓칩니다.
- **양방향 분석 도입**: `DB → 프론트` 역추적 분석을 병행하고, 두 결과를 **교차 검증**하여 신뢰도를 높이고 누락된 연결을 찾아냅니다.

#### 2) **규칙(Rule)과 추론(Inference)의 조화**
- **신뢰도 등급화**: 모든 연결을 '명시적', '관례적', '추론적' 3단계로 나누고 신뢰도 점수를 차등 부여합니다.
    - **🥇 명시적 (0.9-1.0)**: 코드에 명시된 가장 확실한 연결 (e.g., Annotation)
    - **🥈 관례적 (0.7-0.8)**: 명명 규칙 등 프로젝트의 관례에 기반한 연결 (e.g., `UserMapper.java` → `UserMapper.xml`)
    - **🥉 추론적 (0.4-0.6)**: 유사성, 문자열 리터럴 분석 등 추론에 기반한 연결

#### 3) **불확실성의 시각화 (Visualization of Uncertainty)**
- **직관적 표현**: 분석 다이어그램에서 신뢰도에 따라 **실선(명시적), 파선(관례적), 점선(추론적)**으로 다르게 표현하여 사용자가 연결의 확실성을 직관적으로 파악하게 합니다.

## 3. 🚨 현재 시스템의 핵심 문제점

1.  **API_URL → METHOD 매핑 로직 부재**: 프론트엔드와 백엔드의 연결고리 단절. (최우선 해결 과제)
2.  **Java → XML 연결고리 부재**: MyBatis Mapper 인터페이스와 XML 파일 간의 매핑 추적 불가.
3.  **JPA Entity → TABLE 매핑 부재**: `@Table` 어노테이션과 실제 DB 테이블 연결 불가.
4.  **프론트엔드 API 호출 패턴 분석 부족**: Vue/React/JSP의 다양한 API 호출 방식 분석 미흡.
5.  **연관관계 도출 정확도 부족**: 추론(inferred) 컴포넌트에 과도하게 의존하여 신뢰도 하락.

## 4. 🎯 우선순위별 통합 개선 방안

### **1순위: API_URL → METHOD 매핑 강화**
- **Spring Controller 어노테이션 분석**: `@RestController`, `@RequestMapping`, `@GetMapping` 등을 분석하여 URL 패턴과 메소드를 1:1 매핑합니다.
- **URL 패턴 정규화 및 매칭**: `/api/users/{id}` 같은 Path Variable을 정규식으로 처리하는 매칭 알고리즘을 구현합니다.
- **[보완] 서버 설정 파일 분석**: `web.xml`의 `<servlet-mapping>` 등 전역 라우팅 규칙을 추가 분석하여 매핑 정확도를 높입니다.

### **2순위: Java → XML 연결고리 구현**
- **MyBatis Mapper 인터페이스 분석**: `@Mapper` 어노테이션과 인터페이스 메소드명을 분석합니다.
- **Java 메소드 ↔ XML SQL ID 연결**: `UserMapper.java`의 `getUserById()` 메소드와 `UserMapper.xml`의 `<select id="getUserById">`를 **관례적 연결**로 매핑합니다.

### **3순위: JPA Entity → TABLE 매핑 구현**
- **JPA Entity 어노테이션 분석**: `@Entity`, `@Table`, `@Column`을 분석하여 클래스와 테이블, 필드와 컬럼을 **명시적 연결**로 매핑합니다.
- **JPA Repository → TABLE 연결**: `UserRepository`가 `User` Entity를 다루고, `User` Entity가 `USERS` 테이블에 매핑됨을 연결합니다.
- **[보완] 문자열 리터럴 기반 SQL 분석**: `em.createQuery("SELECT u FROM User u")` 와 같이 Java 코드 내 하드코딩된 JPQL/SQL을 직접 분석하여 테이블 정보를 **추론적 연결**로 추출합니다.
- **[보완] 동적 SQL 처리**: MyBatis의 동적 SQL 내에 등장하는 모든 테이블/컬럼을 '조건부 관계' 또는 '추론적 연결'로 우선 포함시켜 분석에서 누락되지 않도록 합니다.

### **4순위: 프론트엔드 API 호출 패턴 강화**
- **프레임워크별 분석기 구현**: Vue(`axios`), React(`fetch`, `axios`), JSP(`$.ajax`) 등 프레임워크별 API 호출 패턴 분석기를 구현하여 API URL과 HTTP 메소드를 추출합니다.

### **5순위: 체인 연결 검증 및 신뢰도 시스템**
- **연결고리 무결성 검증**: `프론트 → DB` 각 단계별 연결 상태를 확인하고, 끊어진 고리를 감지하여 리포트합니다.
- **[보완] 체인 신뢰도 계산**: 전체 체인의 신뢰도는 각 연결고리 신뢰도의 **곱셈**으로 계산 (`0.9 * 0.8 * 0.5 = 0.36`)하여 약한 고리의 영향을 명확히 반영합니다.

### **6순위: [신규] 양방향 분석 및 교차 검증 시스템**
- **DB-First 분석기 구현**: `DB 스키마 → QUERY → XML → METHOD → API_URL → 프론트 파일` 순서로 역추적하는 분석기를 구현합니다.
- **교차 검증 로직**: 정방향과 역방향 분석 결과를 비교하여 일치/불일치 리포트를 생성하고, 데드 코드(사용되지 않는 API/쿼리) 식별에 활용합니다.

### **7순위: [신규] 사용자 피드백 루프 및 학습 기능**
- **관계 수정/확정 인터페이스**: 리포트에서 사용자가 잘못된 연결을 수정하거나 끊어진 연결을 수동으로 확정할 수 있는 기능을 제공합니다.
- **학습 데이터 활용**: 사용자가 확정한 연결 정보를 다음 분석 시 최고 신뢰도(1.0)로 반영하여, 분석을 거듭할수록 시스템 정확도가 향상되게 합니다.

## 5. 🔧 구현 세부 방안 (요약)

- **분석기 구조**: 연관관계 도출 전용 `RelationshipAnalyzer` 클래스를 중심으로 각 순위별 분석기를 모듈화하여 구현합니다.
- **설정 확장**: `relationship_patterns.yaml`에 프레임워크별 어노테이션, API 호출 패턴 등 규칙을 정의하여 확장성을 확보합니다.
- **DB 스키마 확장**: `relationship_mappings`와 `connection_chains` 테이블을 추가하여 분석된 연관관계와 신뢰도, 전체 체인 정보를 체계적으로 관리합니다.
- **리포트 확장**: `RelationshipReportGenerator`를 통해 연결고리 분석, 끊어진 체인, 신뢰도 현황 등 다양한 관점의 리포트를 생성합니다.

## 6. 📊 기대 효과

1.  **연결고리 완성도 향상**: 추론에 의존했던 불완전한 연결을 명시적/관례적 매핑 기반의 정확한 연결로 전환합니다.
2.  **연관관계 신뢰도 향상**: 모든 연결에 신뢰도 점수를 부여하여 분석 결과의 명확성을 제공합니다.
3.  **개발자 생산성 향상**: 수동으로 파악해야 했던 시스템의 종단 간(End-to-End) 흐름을 자동화된 리포트로 제공합니다.
4.  **시스템 이해도 향상**: 전체 시스템의 구조와 데이터 흐름을 명확하게 파악하여 유지보수 및 신규 개발의 효율성을 극대화합니다.

## 7. 🚀 구현 로드맵 (통합)

- **Phase 1 (1-2주)**: API_URL → METHOD 매핑 (1순위)
- **Phase 2 (2-3주)**: Java → XML/DB 연결 (2, 3순위)
- **Phase 3 (1-2주)**: 프론트엔드 API 호출 강화 (4순위)
- **Phase 4 (2-3주)**: 체인 검증, 신뢰도 시스템 및 양방향 분석 (5, 6순위)
- **Phase 5 (1-2주)**: 사용자 피드백 및 리포트 고도화 (7순위)

## 8. 📝 결론

**핵심은 복잡한 파서가 아닌, 단순하고 정확한 연결 매핑에 집중하는 것입니다.**

본 통합 개선안은 `프론트파일 → API_URL → CLASS/METHOD → XML → QUERY → TABLE → Column` 연결고리를 **정확하고 신뢰할 수 있게** 도출하는 것을 최우선 목표로 삼습니다. 이를 통해 SourceAnalyzer는 개발자가 시스템의 전체 구조를 명확하게 파악하고 탐색할 수 있는 **강력한 "시스템 내비게이션"**으로 거듭날 것입니다.

---
**문서 버전**: 2.0 (Final)

# 리포트 생성 개발계획서 검토 보고서

## 1. CallChainReport 생성 개발계획서

### 1.1. 문제점

- **누락된 연계 경로**: 현재 설계된 데이터 조회 쿼리는 'Class -> Method -> XML -> Query -> Table' 경로만 분석합니다. 개발 목표인 'JSP -> Class'로 이어지는 시작 부분이 누락되어, JSP 파일로부터 시작되는 전체 호출 체인을 추적할 수 없습니다.
- **비효율적인 데이터 조회**: `_get_call_chain_data` 함수에서 사용하는 `GROUP_CONCAT`은 대량의 데이터 처리 시 성능 저하를 유발하고, SQLite의 문자열 길이 제한에 도달할 수 있습니다.
- **하드코딩된 필터 옵션**: `_get_filter_options` 함수 내에 쿼리 유형(`query_types`)이 Python 리스트로 하드코딩되어 있습니다. 향후 새로운 쿼리 유형이 추가될 경우, 코드 수정이 불가피하여 유지보수성이 떨어집니다.
- **클라이언트 사이드 필터링의 한계**: 모든 연계 체인 데이터를 한 번에 로드하여 클라이언트(브라우저)에서 필터링하는 방식은 데이터 양이 많아질 경우 심각한 성능 저하와 메모리 문제를 야기할 수 있습니다.
- **불완전한 통계 정보**: 통계 조회 쿼리가 `JOIN_%` 형태의 관계만 집계하고 있어, `FK` 등 다른 중요한 관계 정보를 놓칠 수 있습니다. 통계 정보가 전체적인 데이터 관계를 충분히 반영하지 못합니다.

### 1.2. 개선점

- **전체 연계 경로 추적 쿼리 수정**: JSP 파일에서 시작하여 클래스를 호출하는 관계(`CALL_CLASS`)를 포함하도록 데이터 조회 쿼리를 수정해야 합니다. `files` 테이블과 `relationships` 테이블을 조인하여 JSP로부터 시작되는 완전한 호출 체인을 구성해야 합니다.
- **데이터 조회 방식 개선**: `GROUP_CONCAT` 사용을 지양하고, 기본 연계 정보 조회 후 각 쿼리에 연결된 테이블 정보를 별도로 조회하여 애플리케이션 레벨에서 데이터를 조합하는 방식으로 변경하여 성능을 개선하고 제약을 피해야 합니다.
- **동적 필터 옵션 생성**: 하드코딩된 쿼리 유형 리스트를 제거하고, `components` 테이블에서 `component_type`이 'SQL_%' 또는 'QUERY'인 데이터를 동적으로 조회하여 필터 옵션을 생성하도록 변경해야 합니다.
- **서버 사이드 필터링 도입**: 대용량 데이터 처리를 위해 필터 조건이 변경될 때마다 서버(데이터베이스)에 해당 조건으로 데이터를 다시 조회하여 결과를 반환하는 서버 사이드 필터링 및 페이지네이션 기능 도입을 권장합니다.
- **통계 정보 상세화**: 통계 조회 시 `JOIN_EXPLICIT`, `JOIN_IMPLICIT`, `FK` 등 관계 유형별로 상세한 통계를 제공하도록 쿼리를 수정하여 리포트의 정보 가치를 높여야 합니다.

## 2. ERD Report 생성 개발계획서

### 2.1. 문제점

- **N+1 쿼리 문제**: `_get_tables_data` 함수에서 테이블 목록을 조회한 후, 각 테이블의 컬럼 정보를 얻기 위해 루프 내에서 반복적으로 쿼리를 실행합니다. 이는 테이블 수만큼 불필요한 쿼리를 발생시켜 심각한 성능 저하를 유발합니다.
- **오프라인 환경 미지원**: HTML 템플릿에서 Mermaid.js 라이브러리를 CDN(`https://cdn.jsdelivr.net...`)을 통해 로드하고 있습니다. 이는 폐쇄망과 같은 오프라인 환경에서의 동작을 불가능하게 만듭니다.
- **부정확한 Mermaid 문법 사용**:
    - PK(Primary Key) 컬럼을 표시하는 로직이 Mermaid 최신 문법을 따르지 않고, 실제 생성 코드에서는 PK 구분이 누락되어 있습니다.
    - `JOIN`, `FK` 등 다양한 관계 유형을 모두 동일한 형태의 관계선(`||--o{`)으로 표현하여, 관계의 성격을 시각적으로 구분할 수 없습니다.
- **과도한 데이터 타입 단순화**: `_normalize_data_type` 함수가 `VARCHAR`, `CHAR`, `TEXT` 등 다양한 문자열 타입을 모두 'string'으로 변환하여, `VARCHAR(100)`과 같은 길이 정보가 소실됩니다.
- **사용성 부족한 UI**: 다이어그램 확대/축소 기능만 있고, 확대된 상태에서 다이어그램을 이동시키는 '패닝(Panning)' 기능이 없어 대용량 ERD 탐색이 매우 불편합니다.

### 2.2. 개선점

- **쿼리 최적화**: N+1 문제를 해결하기 위해, 프로젝트에 속한 모든 테이블과 컬럼 정보를 단일 쿼리로 한 번에 조회한 후, 애플리케이션에서 데이터를 가공하여 테이블별로 그룹화하도록 로직을 변경해야 합니다.
- **라이브러리 로컬화**: 외부 CDN 의존성을 제거하고, Mermaid.js 파일을 프로젝트 내부에 포함시켜 상대 경로로 로드하도록 수정해야 합니다. 이는 오프라인 환경 지원을 위해 필수적입니다.
- **Mermaid 문법 수정 및 개선**:
    - 컬럼 옆에 'PK' 키워드를 추가하는 등 Mermaid의 정확한 PK 정의 문법을 사용하여 기본 키를 명확히 표현해야 합니다.
    - `FK` 관계는 실선, `JOIN`으로 추론된 관계는 점선으로 표현하는 등 관계 유형에 따라 다른 선 스타일과 레이블을 적용하여 ERD의 가독성을 높여야 합니다.
- **데이터 타입 정보 보존**: 데이터 타입을 정규화할 때 `VARCHAR(100)`처럼 길이 정보를 유지하도록 개선하고, 상세 정보 테이블에는 정규화되지 않은 원본 데이터 타입을 표시해야 합니다.
- **UI 기능 개선**: 다이어그램의 사용성 향상을 위해, 마우스 드래그를 통해 확대된 다이어그램을 상하좌우로 움직일 수 있는 패닝(Panning) 기능을 JavaScript 코드에 추가해야 합니다.

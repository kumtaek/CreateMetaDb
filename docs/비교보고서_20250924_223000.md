# 메타디비 비교보고서

**생성일시**: 2025-09-24 22:30:00
**분석대상**: projects/sampleSrc 폴더
**비교기준**: 메타디비예상데이터정답지_20250924_191537 vs 실제생성결과

## 1. 전체 결과 비교

### 1.1 컴포넌트 총계 비교

| 구분 | 정답지 예상 | 실제 결과 | 차이 | 비율 |
|------|------------|----------|------|------|
| **전체 컴포넌트** | 328개 | 751개 | +423개 | +129.0% |

### 1.2 컴포넌트 타입별 상세 비교

| 컴포넌트타입 | 정답지 예상 | 실제 결과 | 차이 | 분석 |
|-------------|------------|----------|------|------|
| METHOD | 198개 | 238개 | +40개 | 실제가 더 많이 추출됨 |
| SQL_SELECT | 35개 | 104개 | +69개 | **대폭 증가** - 더 많은 쿼리 발견 |
| SQL_INSERT | 8개 | 5개 | -3개 | 정답지보다 적게 발견 |
| SQL_UPDATE | 12개 | 22개 | +10개 | 실제가 더 많이 발견 |
| SQL_DELETE | 6개 | 6개 | ±0개 | **정확히 일치** |
| SQL_MERGE | 0개 | 6개 | +6개 | **예상 외 발견** - MERGE 쿼리 존재 |
| API_URL | 14개 | 282개 | +268개 | **대폭 증가** - JSP/JS 파일에서 추출 |
| TABLE | 6개 | 31개 | +25개 | 훨씬 많은 테이블 발견 |
| COLUMN | 49개 | 37개 | -12개 | 정답지보다 적게 발견 |
| JSP | 없음 | 13개 | +13개 | **새로운 타입** - JSP 컴포넌트 |
| QUERY | 없음 | 7개 | +7개 | **새로운 타입** - INFERRED 쿼리 |

### 1.3 관계 총계 비교

| 구분 | 정답지 예상 | 실제 결과 | 차이 | 비율 |
|------|------------|----------|------|------|
| **전체 관계** | 202개 | 3,234개 | +3,032개 | +1,501% |

### 1.4 관계 타입별 상세 비교

| 관계타입 | 정답지 예상 | 실제 결과 | 차이 | 분석 |
|---------|------------|----------|------|------|
| CALL_METHOD | 45개 | 3,087개 | +3,042개 | **폭발적 증가** - 임시 METHOD 컴포넌트 효과 |
| CALL_QUERY | 66개 | 7개 | -59개 | **대폭 감소** - 쿼리 호출 관계 미발견 |
| USE_TABLE | 71개 | 139개 | +68개 | 실제가 더 많이 발견 |
| JOIN_EXPLICIT | 12개 | 1개 | -11개 | **대폭 감소** - 명시적 조인 미발견 |
| JOIN_IMPLICIT | 8개 | 0개 | -8개 | **전혀 발견 안됨** - 암시적 조인 미처리 |
| JOIN_MERGEON | 0개 | 0개 | ±0개 | 일치 (둘 다 없음) |

## 2. 주요 차이점 분석

### 2.1 **긍정적 차이점 (실제 > 예상)**

#### 2.1.1 METHOD 컴포넌트 성공 (238개 vs 198개)
- **임시 METHOD 컴포넌트 생성 전략 성공**
- SQL 관련 메소드들이 정상적으로 METHOD 컴포넌트로 생성됨
- CALL_METHOD 관계 생성의 기반 마련

#### 2.1.2 SQL_SELECT 대폭 증가 (104개 vs 35개)
- **MyBatis XML 파싱 강화 효과**
- 동적 쿼리 및 복잡한 쿼리 패턴 더 많이 발견
- 실제 프로젝트의 복잡성이 예상보다 높음

#### 2.1.3 API_URL 폭발적 증가 (282개 vs 14개)
- **JSP/JS 파일 파싱 강화**
- AJAX 호출, form action, 내부 링크 등 다양한 API 호출 발견
- 프론트엔드 분석 능력 대폭 향상

#### 2.1.4 SQL_MERGE 예상 외 발견 (6개 vs 0개)
- 정답지에서는 MERGE 쿼리가 없다고 했지만 실제로 6개 발견
- **실제 분석이 더 정확함**

#### 2.1.5 CALL_METHOD 관계 폭발적 증가 (3,087개 vs 45개)
- **임시 METHOD 컴포넌트 전략의 핵심 성과**
- 메소드 간 호출 관계가 대폭 증가
- 전체 시스템의 메소드 호출 체인 분석 가능

### 2.2 **부정적 차이점 (실제 < 예상)**

#### 2.2.1 CALL_QUERY 관계 대폭 감소 (7개 vs 66개)
- **가장 심각한 문제점**
- Java 메소드와 SQL 쿼리 간 연결 관계가 제대로 생성되지 않음
- MyBatis XML-Java 연결, JPA Repository 연결 미흡

#### 2.2.2 JOIN 관계 처리 실패
- **JOIN_EXPLICIT**: 1개 vs 12개 (91.7% 감소)
- **JOIN_IMPLICIT**: 0개 vs 8개 (100% 실패)
- SQL 쿼리 내의 조인 관계 분석 로직 보완 필요

#### 2.2.3 SQL_INSERT 미발견 (5개 vs 8개)
- INSERT 쿼리 패턴 인식 미흡
- 동적 INSERT 쿼리 처리 개선 필요

#### 2.2.4 COLUMN 발견 부족 (37개 vs 49개)
- 테이블 컬럼 추출 로직 보완 필요
- SQL 쿼리에서 사용된 컬럼 인식 개선 필요

### 2.3 **테이블 분석 결과**

#### 2.3.1 테이블 수 증가 (31개 vs 6개)
- **실제가 5배 더 많은 테이블 발견**
- 정답지에서 예상한 주요 테이블 외에 많은 보조 테이블들 발견

#### 2.3.2 주요 테이블 사용 현황
| 테이블명 | 실제 사용횟수 | 정답지 예상 | 분석 |
|---------|--------------|------------|------|
| USERS | 41회 | 25회 | 더 많은 사용처 발견 |
| PRODUCTS | 25회 | 20회 | 예상보다 많음 |
| ORDERS | 10회 | 10회 | **정확히 일치** |
| CATEGORIES | 5회 | 5회 | **정확히 일치** |

## 3. 정확도 평가

### 3.1 **어느 쪽이 맞는가?**

#### 3.1.1 **실제 결과가 더 정확한 부분**
1. **SQL_MERGE 발견**: 정답지는 0개였지만 실제로 6개 존재
2. **API_URL 대량 발견**: JSP/JS 파일에서 실제로 많은 API 호출 존재
3. **TABLE 수량**: 실제 프로젝트가 더 복잡한 테이블 구조를 가짐
4. **METHOD 컴포넌트**: 임시 생성 전략으로 관계 분석 기반 확보

#### 3.1.2 **정답지가 더 정확한 부분**
1. **CALL_QUERY 관계**: 실제 66개 관계가 있어야 하는데 7개만 발견
2. **JOIN 관계**: 명시적/암시적 조인 관계 처리 실패
3. **SQL_INSERT 패턴**: 정답지의 8개가 더 정확할 가능성

#### 3.1.3 **판단 근거**
- **정답지는 수작업 직접 분석**으로 정밀도가 높음
- **실제 결과는 자동화 분석**으로 범위가 넓지만 일부 패턴 누락
- **실제 결과의 SQL_MERGE 발견**은 정답지의 오류를 증명

### 3.2 **성능 평가**

| 평가항목 | 점수 | 설명 |
|---------|------|------|
| **컴포넌트 추출** | 85/100 | METHOD, SQL_SELECT 등 대부분 성공 |
| **관계 생성** | 65/100 | CALL_METHOD는 성공, CALL_QUERY는 실패 |
| **SQL 분석** | 70/100 | SELECT는 성공, JOIN은 실패 |
| **전체 성능** | **73/100** | **양호 수준** |

## 4. 개선 방안

### 4.1 **즉시 개선 필요**

#### 4.1.1 CALL_QUERY 관계 생성 강화
```python
# java_parser.py의 get_mybatis_query_call() 메소드 강화
# JPA Repository 어노테이션 분석 개선
# @Query, @Modifying 어노테이션 파싱 강화
```

#### 4.1.2 JOIN 관계 분석 로직 추가
```python
# sql_parser.py에 JOIN 패턴 분석 로직 추가
# WHERE 절 암시적 조인 패턴 인식
# INNER/LEFT/RIGHT JOIN 명시적 조인 분석
```

#### 4.1.3 INSERT/UPDATE 쿼리 패턴 개선
```python
# MyBatis XML의 동적 INSERT/UPDATE 쿼리 처리
# <if>, <choose>, <foreach> 태그 내부 쿼리 추출
```

### 4.2 **장기 개선 계획**

#### 4.2.1 컬럼 추출 강화
- SQL 쿼리의 SELECT, WHERE, SET 절에서 컬럼명 추출 개선
- 테이블별 컬럼 매핑 정확도 향상

#### 4.2.2 오류 케이스 처리 개선
- 문법 오류 파일에 대한 부분 분석 능력 향상
- has_error='Y' 케이스에 대한 복구 시도

## 5. 결론

### 5.1 **주요 성과**
1. **임시 METHOD 컴포넌트 생성 전략 대성공**: CALL_METHOD 관계 3,087개 생성
2. **SQL 쿼리 추출 능력 향상**: SQL_SELECT 104개로 3배 증가
3. **프론트엔드 분석 강화**: API_URL 282개로 20배 증가
4. **전체 분석 범위 대폭 확장**: 컴포넌트 751개, 관계 3,234개

### 5.2 **주요 문제점**
1. **CALL_QUERY 관계 생성 실패**: 가장 중요한 메소드-쿼리 연결 미흡
2. **JOIN 관계 분석 부재**: SQL 조인 관계 분석 로직 필요
3. **일부 SQL 패턴 누락**: INSERT, 컬럼 추출 정확도 개선 필요

### 5.3 **종합 평가**
- **전체 성능**: 73/100 (양호)
- **성공 요인**: 임시 METHOD 전략, SQL 추출 강화, 범위 확장
- **개선 필요**: CALL_QUERY 관계, JOIN 분석, SQL 패턴 보완

### 5.4 **권장사항**
1. **CALL_QUERY 관계 생성 로직 최우선 개선**
2. **JOIN 관계 분석 로직 추가 개발**
3. **SQL 패턴 인식 정확도 향상**
4. **정답지와 실제 결과의 교차 검증 지속**

이번 비교 분석을 통해 쿼리분석개선 프로젝트의 성과와 한계를 명확히 파악할 수 있었으며, 향후 개선 방향을 구체적으로 제시할 수 있었습니다.
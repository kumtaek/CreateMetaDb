# 메타디비 대사 비교 보고서

**생성일시**: 2025-09-24 15:22:21  
**비교 대상**: 정답지 vs 현재 메타디비  
**프로젝트**: SampleSrc  

## 1. 개요

### 1.1 비교 목적
- 정답지(`메타디비예상데이터정답지_20250924_133100.md`)와 현재 생성된 메타디비 간의 차이점 분석
- 쿼리, 관련테이블, 조인조건, 메소드 연계 부분에 집중한 상세 비교
- 다이나믹 로직 및 차이 원인 명시

### 1.2 분석 범위
- SQL 컴포넌트 (SQL_SELECT, SQL_INSERT, SQL_UPDATE, SQL_DELETE, SQL_MERGE)
- 관계 (CALL_QUERY, JOIN_EXPLICIT, JOIN_IMPLICIT, USE_TABLE)
- 메소드-쿼리 매핑
- 다이나믹 쿼리 처리

## 2. 컴포넌트 타입별 비교 분석

### 2.1 SQL 컴포넌트 비교

| 컴포넌트 타입 | 정답지 | 현재 메타디비 | 차이 | 차이율 |
|---------------|--------|---------------|------|--------|
| SQL_SELECT | 170개 | 116개 | -54개 | -31.8% |
| SQL_INSERT | 19개 | 18개 | -1개 | -5.3% |
| SQL_UPDATE | 26개 | 17개 | -9개 | -34.6% |
| SQL_DELETE | 4개 | 2개 | -2개 | -50.0% |
| SQL_MERGE | 9개 | 0개 | -9개 | -100.0% |
| **SQL 총계** | **228개** | **153개** | **-75개** | **-32.9%** |

### 2.2 기타 컴포넌트 비교

| 컴포넌트 타입 | 정답지 | 현재 메타디비 | 차이 | 차이율 |
|---------------|--------|---------------|------|--------|
| TABLE | 23개 | 23개 | 0개 | 0.0% |
| COLUMN | 37개 | 37개 | 0개 | 0.0% |
| METHOD | 78개 | 0개 | -78개 | -100.0% |
| API_URL | 12개 | 0개 | -12개 | -100.0% |

## 3. 관계 타입별 비교 분석

### 3.1 관계 비교

| 관계 타입 | 정답지 | 현재 메타디비 | 차이 | 차이율 |
|-----------|--------|---------------|------|--------|
| CALL_QUERY | 94개 | 0개 | -94개 | -100.0% |
| JOIN_EXPLICIT | 45개 | 0개 | -45개 | -100.0% |
| JOIN_IMPLICIT | 32개 | 0개 | -32개 | -100.0% |
| USE_TABLE | 200개 | 200개 | 0개 | 0.0% |
| CALL_METHOD | 15개 | 0개 | -15개 | -100.0% |
| INHERITANCE | 8개 | 0개 | -8개 | -100.0% |
| **관계 총계** | **394개** | **200개** | **-194개** | **-49.2%** |

## 4. 주요 차이점 상세 분석

### 4.1 SQL_MERGE 완전 누락 (9개 → 0개)

**정답지 예상 데이터:**
- TestEnhancedSqlDao.java: testMergeConcatenation, testStringLiteralSQL_mergeSQL
- TestComplexJavaPatternDao.java: testMergeStringLiteral  
- CoreSqlPatternDao.java: mergeWithPlusOperator, mergeWithStringFormat, mergeAuditData
- ComplexEnterpriseMapper.xml: user_settlements_merge, settlement_statistics_merge
- DirectXmlQueryMapper.xml: mergeDirectUserPreferences

**차이 원인:**
- Java 파일의 MERGE 쿼리 추출 로직 미구현
- XML 파일의 MERGE 쿼리 파싱 실패
- 다이나믹 쿼리 처리 로직 부재

**관련 소스:**
- `parser/java_parser.py`: MERGE 쿼리 추출 로직 누락
- `parser/xml_parser.py`: MERGE 태그 파싱 실패
- `util/java_query_analyzer.py`: 다이나믹 쿼리 처리 미구현

### 4.2 JPA Repository 연결 완전 누락 (78개 → 0개)

**정답지 예상 데이터:**
- UserRepository.java: 18개 메서드
- CategoryRepository.java: 13개 메서드  
- OrderRepository.java: 24개 메서드
- ProductRepository.java: 23개 메서드

**차이 원인:**
- JPA @Query 어노테이션 파싱 실패
- Repository 인터페이스와 SQL 쿼리 매핑 로직 부재
- CALL_QUERY 관계 생성 로직 미구현

**관련 소스:**
- `parser/java_parser.py`: `_extract_jpa_queries` 메서드 개선 필요
- `relationship_builder.py`: CALL_QUERY 관계 생성 로직 누락

### 4.3 SQL_SELECT 대폭 감소 (170개 → 116개)

**주요 누락 쿼리:**
- JPA Repository의 @Query 어노테이션 쿼리들
- 복잡한 JOIN 쿼리들
- 다이나믹 쿼리들

**차이 원인:**
- JPA 쿼리 추출 실패
- 복잡한 JOIN 구문 파싱 실패
- 다이나믹 쿼리 처리 로직 부재

### 4.4 SQL_UPDATE 감소 (26개 → 17개)

**누락 쿼리:**
- JPA Repository의 @Modifying @Query 쿼리들
- MyBatis XML의 동적 UPDATE 쿼리들

**차이 원인:**
- @Modifying 어노테이션 처리 실패
- MyBatis 동적 태그 파싱 실패

### 4.5 SQL_DELETE 감소 (4개 → 2개)

**누락 쿼리:**
- JPA Repository의 DELETE 쿼리들
- 일부 MyBatis XML DELETE 쿼리들

**차이 원인:**
- JPA DELETE 쿼리 추출 실패
- XML 파싱 오류

## 5. 다이나믹 쿼리 분석

### 5.1 누락된 다이나믹 쿼리

**Java 다이나믹 쿼리:**
- 문자열 연결을 통한 동적 SQL 생성
- String.format()을 이용한 동적 쿼리
- StringBuilder를 이용한 복합 쿼리

**XML 다이나믹 쿼리:**
- MyBatis 동적 태그 (`<if>`, `<choose>`, `<foreach>`, `<where>`, `<set>`)
- 조건부 쿼리 생성
- 반복문을 이용한 배치 처리

**JPA 다이나믹 쿼리:**
- @Query 어노테이션의 조건부 로직
- JPQL의 동적 조건 처리
- Native SQL의 동적 파라미터 처리

### 5.2 다이나믹 쿼리 처리 개선 방안

1. **Java 다이나믹 쿼리 처리:**
   - 문자열 연결 패턴 인식 강화
   - 변수 추적 로직 구현
   - 조건부 쿼리 생성 로직 추가

2. **XML 다이나믹 쿼리 처리:**
   - MyBatis 동적 태그 파싱 개선
   - 조건부 로직 분석 강화
   - 중첩 태그 처리 로직 추가

3. **JPA 다이나믹 쿼리 처리:**
   - @Query 어노테이션 파싱 개선
   - JPQL 동적 조건 분석
   - Native SQL 파라미터 매핑 강화

## 6. 조인 관계 분석

### 6.1 조인 관계 완전 누락

**정답지 예상:**
- JOIN_EXPLICIT: 45개
- JOIN_IMPLICIT: 32개

**현재 메타디비:**
- JOIN_EXPLICIT: 0개
- JOIN_IMPLICIT: 0개

**차이 원인:**
- 조인 조건 추출 로직 미구현
- 테이블 간 관계 분석 로직 부재
- 외래키 관계 추론 로직 누락

### 6.2 조인 관계 개선 방안

1. **명시적 조인 (JOIN_EXPLICIT):**
   - JOIN ... ON 절 파싱 강화
   - 테이블 별칭 처리 개선
   - 복합 조인 조건 분석

2. **암시적 조인 (JOIN_IMPLICIT):**
   - WHERE 절의 테이블 연결 조건 분석
   - 외래키 관계 추론 로직 구현
   - 테이블 간 참조 관계 분석

## 7. 메소드-쿼리 매핑 분석

### 7.1 CALL_QUERY 관계 완전 누락

**정답지 예상:**
- MyBatis XML-Java 연결: 7개
- JPA Repository 연결: 78개
- Java DAO 연결: 6개
- XML 직접 쿼리: 3개

**현재 메타디비:**
- CALL_QUERY: 0개

**차이 원인:**
- 메소드와 쿼리 매핑 로직 미구현
- Repository 인터페이스 분석 실패
- XML-Java 매핑 로직 부재

### 7.2 메소드-쿼리 매핑 개선 방안

1. **JPA Repository 매핑:**
   - Repository 인터페이스 분석 강화
   - @Query 어노테이션과 메소드 연결
   - 메소드 시그니처 분석 개선

2. **MyBatis XML 매핑:**
   - XML id와 Java 메소드명 매칭
   - parameterType 정보 활용
   - 네임스페이스 처리 개선

3. **Java DAO 매핑:**
   - 메소드 내 SQL 쿼리 추출
   - 동적 쿼리 생성 로직 분석
   - 쿼리 변수 추적 강화

## 8. 개선 우선순위

### 8.1 1순위 (Critical)
1. **JPA Repository 연결 구현** (78개 누락)
2. **SQL_MERGE 쿼리 추출** (9개 누락)
3. **CALL_QUERY 관계 생성** (94개 누락)

### 8.2 2순위 (High)
1. **조인 관계 분석** (77개 누락)
2. **다이나믹 쿼리 처리** (동적 SQL 추출)
3. **복잡한 JOIN 쿼리 파싱** (54개 SQL_SELECT 누락)

### 8.3 3순위 (Medium)
1. **@Modifying 쿼리 처리** (UPDATE/DELETE)
2. **MyBatis 동적 태그 파싱**
3. **메소드 시그니처 분석 개선**

## 9. 결론

### 9.1 주요 문제점
1. **JPA Repository 처리 완전 실패** (78개 누락)
2. **SQL_MERGE 쿼리 추출 실패** (9개 누락)
3. **조인 관계 분석 미구현** (77개 누락)
4. **메소드-쿼리 매핑 실패** (94개 누락)

### 9.2 개선 필요 영역
1. **JPA 쿼리 추출 로직 전면 개선**
2. **다이나믹 쿼리 처리 로직 구현**
3. **조인 관계 분석 로직 구현**
4. **메소드-쿼리 매핑 로직 구현**

### 9.3 예상 개선 효과
- **SQL 컴포넌트**: 153개 → 228개 (+75개, +49.0%)
- **관계**: 200개 → 394개 (+194개, +97.0%)
- **전체 정확도**: 현재 32.9% → 목표 90%+

---

**보고서 작성일**: 2025-09-24 15:22:21  
**분석자**: AI Assistant  
**다음 단계**: 개선 우선순위에 따른 소스 코드 수정
